/*
 Copyright 2022 Glance Networks, Inc.
*/
var GLANCE_LOGGER=!0,GlanceLogger={sanitize:function(a){return a.replace(/[\r\n]/g," ").replace("<","&lt;")},_log:function(a,...c){!window.console||!window.console[a]||window.GLANCE_COBROWSE&&window.GLANCE_COBROWSE.disableLogging||(c=c.map(d=>{if("object"===typeof d)try{d=JSON.stringify(d)}catch(e){console.error(e),d="unable to convert object to string"}return"string"===typeof d?GlanceLogger.sanitize(d):d}),window.console[a](...c))},log:function(...a){GlanceLogger._log("log",...a)},error:function(...a){GlanceLogger._log("error",
...a)}},LOG_DIFFS=!1,LOG_DIFFDET=!1,LOG_DRAW=!1,LOG_PRES=!0,LOG_CBSTATE=!1,LOG_IFRAME=!1,LOG_SCROLL=!1,LOG_EVENTS=!1,LOG_LOADER=!1,LOG_UI=!1,LOG_FOCUS=!1,LOG_XDOM=!0,LOG_C3P=!1,LOG_PDF=!1,LOG_STYLES=!1,LOG_GEST=!1,LOG_MSG=!1,LOG_RES=!0,LOG_RC=!1,LOG_SD=!1,LOG_VID=!0,LOG_MASK=!1,LOG_DOC=!1,LOG_XLS=!1,LOG_SS=!1,debuglog=GLANCE_LOGGER?function(...a){GlanceLogger.log("DEBUG:",...a)}:function(){},diffslog=GLANCE_LOGGER&&LOG_DIFFS?function(...a){GlanceLogger.log("DIFFS:",...a)}:function(){},diffdetlog=
GLANCE_LOGGER&&LOG_DIFFDET?function(...a){GlanceLogger.log("DIFFDET:",...a)}:function(){},drawlog=GLANCE_LOGGER&&LOG_DRAW?function(...a){GlanceLogger.log("DRAW:",...a)}:function(){},preslog=LOG_PRES?function(...a){GlanceLogger.log("PRES:",...a)}:function(){},cbstatelog=GLANCE_LOGGER&&LOG_CBSTATE?function(...a){GlanceLogger.log("CBSTATE:",...a)}:function(){},iframelog=GLANCE_LOGGER&&LOG_IFRAME?function(...a){GlanceLogger.log("IFRAME:",...a)}:function(){},scrolllog=GLANCE_LOGGER&&LOG_SCROLL?function(...a){GlanceLogger.log("SCROLL:",
...a)}:function(){},eventslog=GLANCE_LOGGER&&LOG_EVENTS?function(...a){GlanceLogger.log("EVENTS:",...a)}:function(){},loaderlog=GLANCE_LOGGER&&LOG_LOADER?function(...a){GlanceLogger.log("LOADER:",...a)}:function(){},uilog=GLANCE_LOGGER&&LOG_UI?function(...a){GlanceLogger.log("UI:",...a)}:function(){},focuslog=GLANCE_LOGGER&&LOG_FOCUS?function(...a){GlanceLogger.log("FOCUS:",...a)}:function(){},xdomlog=LOG_XDOM?function(...a){GlanceLogger.log("XDOM:",...a)}:function(){},c3plog=GLANCE_LOGGER&&LOG_C3P?
function(...a){GlanceLogger.log("C3P:",...a)}:function(){},pdflog=GLANCE_LOGGER&&LOG_PDF?function(...a){GlanceLogger.log("PDF:",...a)}:function(){},stylelog=GLANCE_LOGGER&&LOG_STYLES?function(...a){GlanceLogger.log("STYLES:",...a)}:function(){},gestlog=GLANCE_LOGGER&&LOG_GEST?function(...a){GlanceLogger.log("GEST:",...a)}:function(){},msglog=GLANCE_LOGGER&&LOG_MSG?function(...a){GlanceLogger.log("MSG:",...a)}:function(){},reslog=GLANCE_LOGGER&&LOG_RES?function(...a){GlanceLogger.log("RES:",...a)}:
function(){},rclog=GLANCE_LOGGER&&LOG_RC?function(...a){GlanceLogger.log("RC:",...a)}:function(){},sdlog=GLANCE_LOGGER&&LOG_SD?function(...a){GlanceLogger.log("SD:",...a)}:function(){},vidlog=LOG_VID?function(...a){GlanceLogger.log("VID:",...a)}:function(){},masklog=GLANCE_LOGGER&&LOG_MASK?function(...a){GlanceLogger.log("MASK:",...a)}:function(){},doclog=GLANCE_LOGGER&&LOG_DOC?function(...a){GlanceLogger.log("DOC:",...a)}:function(){},sslog=GLANCE_LOGGER&&LOG_SS?function(...a){GlanceLogger.log("SS:",
...a)}:function(){},assert=GLANCE_LOGGER?function(a){if(!a)if(window.console&&window.console.error)GlanceLogger.error("ASSERT");else throw Error("ASSERT");}:function(){};function consolelog(...a){GlanceLogger.log("GLANCE:",...a)}function errorlog(...a){GlanceLogger.error("GLANCE:",...a)};/*
 Copyright (c) 2022 Glance Networks, Inc.
*/
var GLANCE=GLANCE||{};GLANCE.Lib=GLANCE.Lib||{};GLANCE.VERSION="6.3.1.0";GLANCE.PATCH="";window.GLANCE=window.GLANCE||{};window.GLANCE.VERSION=GLANCE.VERSION;window.GLANCE.PATCH=GLANCE.PATCH;window.GLANCE.Lib=window.GLANCE.Lib||{};GLANCE.Lib.KEYTYPE={RANDOM:"GLANCE_KEYTYPE_RANDOM"};GLANCE.Lib.KEYTYPE={RANDOM:"GLANCE_KEYTYPE_RANDOM"};
GLANCE.Lib.MESSAGES={GLANCE_INVOKE_MSG:"glance_invoke",GLANCE_SCREENSHARE:"glance_screenshare",GLANCE_SCREENSHAREPREVIEW:"glance_screensharepreview",GLANCE_VISITOR_SCREENSHAREPREVIEW:"glance_visitor_screensharepreview",GLANCE_AGENTVIDEO:"glance_agentvideo",GLANCE_VIDEOPREVIEW:"glance_videopreview"};GLANCE.Lib.Const={GID:"data-gid",GCID:"data-gcid",SDID:"data-sdid"};GLANCE.Lib.scriptId=function(a){return("glance_"+a).toLowerCase()};
GLANCE.Lib.CallFlags={None:0,Reconnect:1,Reverse:2,Declined:4,Rcrequested:8,Closing:16,Beta:32,MultipleGuestsOk:64,Anonymous:128,Showback:256,GuestNameRequired:512,GuestEmailRequired:1024,GuestPhoneRequired:2048,GuestNameHidden:4096,GuestEmailHidden:8192,GuestPhoneHidden:16384,GuestInfo:32256,Encrypt:32768,ForceAjax:65536,Persist:131072,PresenceStart:262144,StagingSession:524288,HDAgentVideoEnabled:2097152};
GLANCE.Lib.IntVersion=function(){var a=GLANCE.VERSION.split(".");return 1E6*parseInt(a[0])+1E3*parseInt(a[1])+parseInt(a[2])}();GLANCE.Lib.VideoJoinURL=function(a,c){c=c||"clip";return`https://${URL.toString().includes("[native code]")?(new URL(a)).hostname:GLANCE.Lib.GElement.nativeInstance("URL",a).hostname}/viv/VideoPlayer.html?offer=${a}&scaling=${c}&noendpage=1&guestid={guestid}&conntype={role}`};
GLANCE.Lib.Browser=function(){var a=navigator.userAgent.toLowerCase(),c=navigator.platform.toLowerCase(),d=a.match(/(edge)[\s\/:]([\w\d\.]+)?/)||a.match(/(opera|ie|firefox|chrome|crios|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||a.match(/(rv):([\w\d\.]+)/)||[null,"unknown",0];"crios"===d[1]?d[1]="chrome":"rv"===d[1]&&(d[1]="ie");a={extend:Function.prototype.extend,name:"version"==d[1]?d[3]:d[1],version:"ie"==d[1]&&document.documentMode||parseFloat("opera"==d[1]&&d[4]?d[4]:
d[2]),Platform:{name:a.match(/ip(?:ad|od|hone)/)||c.match(/mac/)&&"undefined"!==typeof navigator.standalone?"ios":(a.match(/(?:webos|android)/)||c.match(/mac|win|linux/)||["other"])[0]},Features:{xpath:!!document.evaluate,air:!!window.runtime,query:!!document.querySelector,json:!!window.JSON},Plugins:{},isMobileDevice:function(){return"ios"==this.Platform.name||"android"==this.Platform.name}};document.documentMode&&window.XDomainRequest?(a.name="ie",a.version=document.documentMode):window.navigator&&
navigator.appVersion&&-1!=navigator.appVersion.indexOf("MSIE 7.")&&(a.name="ie",a.version="7");a[a.name]=!0;a[a.name+parseInt(a.version,10)]=!0;a.Platform[a.Platform.name]=!0;return a}();GLANCE.Lib.getIframe=function(a,c){c=c||document;return GLANCE.Lib.GElement.nativeMethod(c,"querySelector","iframe[frameid='"+a+"']")};GLANCE.Lib.equal=function(a,c){return GLANCE.Lib.JSONStringify(a)===GLANCE.Lib.JSONStringify(c)};
GLANCE.Lib.random=function(a){for(a=String(Math.round(Math.random()*Math.pow(10,a)));4>a.length;)a="0"+a;return a};GLANCE.Lib.getCryptoToken=function(a){a=new Uint32Array(Math.ceil(a/32));window.crypto.getRandomValues(a);let c="";a.forEach(d=>{c+=d.toString(36)});return c};GLANCE.Lib.getProperties=function(a,c){var d={},e=new RegExp(c),h;for(h in a)h.match(e)&&(d[h.substr(c.length)]=a[h]);return d};GLANCE.Lib.pointDistance=function(a,c){return Math.max(Math.abs(a.x-c.x),Math.abs(a.y-c.y))};
GLANCE.Lib.Url={};GLANCE.Lib.Url.isAbsolute=function(a){return 0<=a.indexOf("//")||0===a.indexOf("/")};GLANCE.Lib.ExtendableTimer=function(){};GLANCE.Lib.ExtendableTimer.prototype.set=function(a,c){GLANCE.Lib.GElement.nativeMethod(window,"clearTimeout",this.timer);var d=this;this.timer=GLANCE.Lib.GElement.nativeMethod(window,"setTimeout",function(){delete d.timer;c&&c()},a)};GLANCE.Lib.ExtendableTimer.prototype.isSet=function(){return void 0!==this.timer};
GLANCE.Lib.ExtendableTimer.prototype.clear=function(){GLANCE.Lib.GElement.nativeMethod(window,"clearTimeout",this.timer);delete this.timer};void 0===GLANCE.Lib.JSONStringify&&(GLANCE.Lib.JSONStringify=function(a){return GLANCE.Lib.GElement.USE_CLEANCONTEXT&&GLANCE.Lib.GElement.CleanContext?GLANCE.Lib.GElement.CleanContext.window.JSON.stringify(a):JSON.stringify(a)});
GLANCE.Lib._enhanceSocket=function(a){a.onmessage=function(c){c=JSON.parse(c.data);if(a.onreceiveobj)a.onreceiveobj(c)};a.sendobj=function(c){c=GLANCE.Lib.JSONStringify(c);a.send(c)};a.getcode=function(c){return c&&c.code||0};a.getreason=function(c){return c&&c.reason||""};return a};GLANCE.Lib.GWebSocket=function(a){a=new WebSocket(a);GLANCE.Lib._enhanceSocket(a);return a};
GLANCE.Lib.GSockJS=function(a,c){var d={};if(GLANCE.Lib.useIFrameProxy)var e=new GLANCE.Lib.GSockJSProxy(a);else GLANCE.Lib.Browser.ie9&&"http:"===window.location.protocol&&(d.protocols_whitelist=["iframe-eventsource","iframe-htmlfile"]),e=new SockJS(a,"",d);e.hbskipped=0;e.checkheartbeat=function(){e.cancelheartbeatcheck();c&&e.transport&&!e.transport.match(/^iframe-/)&&(e.hbinterval=GLANCE.Lib.GElement.nativeMethod(window,"setInterval",function(){e.hbskipped++;if(e.onheartbeatskipped)e.onheartbeatskipped({hbskipped:e.hbskipped})},
c))};e.cancelheartbeatcheck=function(){e.hbinterval&&GLANCE.Lib.GElement.nativeMethod(window,"clearInterval",e.hbinterval)};GLANCE.Lib._enhanceSocket(e);e.onclose=function(h){e.cancelheartbeatcheck();if(e.on_close)e.on_close(h)};e.onheartbeat=function(){e.hbskipped=0;e.checkheartbeat();if(e.on_heartbeat)e.on_heartbeat()};return e};GLANCE.Lib.RequestProxy={loaded:!1};
GLANCE.Lib.RequestProxy.init=function(a){GLANCE.Lib.RequestProxy.server=a;if(!document.getElementById("glance_request_proxy")){var c=document.createElement("iframe");c.id="glance_request_proxy";c.width="0px";c.height="0px";c.style.border="none";c.src="https://"+a+"/RequestProxy.htm?1";c.onload=function(){GLANCE.Lib.RequestProxy.loaded=!0};document.body.appendChild(c)}GLANCE.Lib.RequestProxy.proxyframe=document.getElementById("glance_request_proxy").contentWindow};
GLANCE.Lib.RequestProxy.postMessage=function(a,c){var d=GLANCE.Lib.RequestProxy;d.loaded?d.proxyframe.postMessage(a,c||"https://"+GLANCE.Lib.RequestProxy.server):GLANCE.Lib.GElement.nativeMethod(window,"setTimeout",function(){d.postMessage(a,c)},100)};
GLANCE.Lib.GSockJSProxy=function(a){this.readyState=SockJS.CONNECTING;this.sockid=Math.round(1E6*Math.random());GLANCE.Lib.GSockJSProxy.sockets=GLANCE.Lib.GSockJSProxy.sockets||{};GLANCE.Lib.GSockJSProxy.sockets[this.sockid]=this;GLANCE.Lib.RequestProxy.postMessage({from:"GSockJSProxy",sockid:this.sockid,cmd:"open",url:a})};GLANCE.Lib.GSockJSProxy.init=function(a){GLANCE.Lib.RequestProxy.init(a);GLANCE.Lib.Window.addEventListener("message",GLANCE.Lib.GSockJSProxy.handleMessage,!1)};
var _protect_gsjsproxyresp={to:0,event:0};
GLANCE.Lib.GSockJSProxy.handleMessage=function(a){if(GLANCE.Lib.getDomain(a.origin)===GLANCE.Lib.getDomain(GLANCE.Lib.RequestProxy.server)&&"undefined"!=typeof a.data.to&&"GSockJSProxy"==a.data.to){var c=GLANCE.Lib.GSockJSProxy.sockets[a.data.sockid];if(c)switch(a.data.event.type){case "open":c.readyState=SockJS.OPEN;if(c.onopen)c.onopen(a.data.event);break;case "heartbeat":c.onheartbeat();break;case "message":c.onmessage(a.data.event);break;case "close":c.readyState=SockJS.CLOSED;c.onclose(a.data.event);
break;default:GLANCE.Lib.log("UNKNOWN GLANCE SOCKJS PROXY MESSAGE: "+JSON.stringify(a.data))}}};GLANCE.Lib.GSockJSProxy.prototype.send=function(a){GLANCE.Lib.RequestProxy.postMessage({from:"GSockJSProxy",sockid:this.sockid,cmd:"send",data:a})};GLANCE.Lib.GSockJSProxy.prototype.close=function(a,c){this.readyState=SockJS.CLOSING;GLANCE.Lib.RequestProxy.postMessage({from:"GSockJSProxy",sockid:this.sockid,cmd:"close"})};GLANCE.Lib.nextGID=1;
GLANCE.Lib.compressObj=function(a){if(void 0===a||null===a)return a;a=GLANCE.Lib.JSONStringify(a);return{_c:GLANCE.Lib.compressToBase64(a)}};GLANCE.Lib.compressToBase64=function(a){a=(new TextEncoder).encode(a);var c=(new window.GLANCE.Lib.Zlib.RawDeflate(a)).compress();a="";c=new Uint8Array(c);for(var d=c.byteLength,e=0;e<d;e++)a+=String.fromCharCode(c[e]);return window.btoa(a)};
GLANCE.Lib.decompressObj=function(a){if(null===a||a instanceof String&&0===a.length)return null;if(void 0===a._c)return a;a=GLANCE.Lib.decompressFromBase64(a._c);return JSON.parse(a)};GLANCE.Lib.decompressFromBase64=function(a){a=window.atob(a);for(var c=a.length,d=new Uint8Array(c),e=0;e<c;e++)d[e]=a.charCodeAt(e);a=(new window.GLANCE.Lib.Zlib.RawInflate(d.buffer)).decompress();return(new TextDecoder).decode(a)};
GLANCE.Lib.pad=function(a,c,d){return(a.length>=d?"":Array(1+d-a.length>>>0).join(c))+a};GLANCE.Lib.hash=function(a){var c=0,d;if(0==a.length)return c;for(d=0;d<a.length;d++){var e=a.charCodeAt(d);c=(c<<5)-c+e;c&=c}return Math.abs(c)};GLANCE.Lib.Params={};GLANCE.Lib.Params.copy=function(a,c,d){if(void 0!==a)return d=d||Object.keys(a),d.forEach(function(e){void 0!==a[e]&&(c[e]=a[e])}),c};
GLANCE.Lib.invokeFunction=function(a){var c=a.func.split(".");if(2>c.length)GLANCE.Lib.errlog("ERR_BADINVOKE:",a.func);else if("GLANCE"===c[0]||"GLANCE_COBROWSE"===c[0]&&"Custom"===c[1]){for(var d=window[c[0]],e=1;e<c.length;e++)if(d=d[c[e]],!d){GLANCE.Lib.errlog("ERR_UNDEFINVOKE:"+c[e]);return}a.args=a.args||{};a.args.remote=!0;d(a.args)}else GLANCE.Lib.errlog("ERR_BADINVOKE:"+c[0])};
GLANCE.Lib.UTCNow=function(){function a(d,e){for(d=d.toString();d.length<e;)d="0"+d;return d}var c=new Date;return c.getUTCFullYear()+"/"+(c.getUTCMonth()+1)+"/"+c.getUTCDate()+" "+a(c.getUTCHours(),2)+":"+a(c.getUTCMinutes(),2)+":"+a(c.getUTCSeconds(),2)};GLANCE.Lib.Timer=function(){this.t=0};GLANCE.Lib.Timer.prototype.elapsed=function(){return(new Date).getTime()-this.t};GLANCE.Lib.Timer.prototype.set=function(){this.t=(new Date).getTime()};GLANCE.Lib.Window={};
GLANCE.Lib.Window.addEventListener=function(a,c,d){GLANCE.Lib.GElement.nativeMethod(window,"addEventListener",a,c,d)};GLANCE.Lib.Window.removeEventListener=function(a,c){GLANCE.Lib.GElement.nativeMethod(window,"removeEventListener",a,c)};GLANCE.Lib.Window.postWindowMessage=function(a,c,d,e){var h={};h[c]=d;a.postMessage(h,void 0!==e?e:"*")};
GLANCE.Lib.Window.onWindowMessage=function(a,c,d){var e=function(h){if("string"===typeof h.data)try{var k=JSON.parse(h.data)}catch(m){return!1}else k=h.data;void 0!==k[a]&&(d&&!GLANCE.Lib.isAllowedOrigin(h.origin,d)?GLANCE.Lib.errlog("UNTRUSTED_ORIGIN:"+h.origin+" "+JSON.stringify(k)):c(h.source,k[a]))};GLANCE.Lib.GElement.nativeMethod(window,"addEventListener","message",e);return e};GLANCE.Lib.Window.POPUP_WINDOW="location=no,menubar=0,titlebar=0,status=0,toolbar=0";
GLANCE.Lib.Window.onPageHide=function(a){GLANCE.Lib.Window.addEventListener(void 0!==window.onpagehide?"pagehide":"unload",a)};GLANCE.Lib.Window.onPageShow=function(a){void 0!==window.onpageshow&&GLANCE.Lib.Window.addEventListener("pageshow",a)};GLANCE.Lib.Window.DOMEvents="DOMAttrModified DOMAttributeNameChanged DOMCharacterDataModified DOMElementNameChanged DOMNodeInserted DOMNodeInsertedIntoDocument DOMNodeRemoved DOMNodeRemovedFromDocument DOMSubtreeModified".split(" ");
GLANCE.Lib.Window.listenForDOMChanges=function(a){var c=!MutationObserver.toString().includes("native code")&&GLANCE.Lib.GElement.USE_CLEANCONTEXT?GLANCE.Lib.GElement.CleanContext:window;GLANCE.Lib.Window.mutationObserver=new c.MutationObserver(a);GLANCE.Lib.Window.mutationObserver.observe(document,{childList:!0,characterData:!0,attributes:!0,subtree:!0})};GLANCE.Lib.Window.stopListenForDOMChanges=function(){GLANCE.Lib.Window.mutationObserver&&GLANCE.Lib.Window.mutationObserver.disconnect();delete GLANCE.Lib.Window.mutationObserver};
GLANCE.Lib.cleanObj=function(a){function c(e){for(var h in e)if("object"===typeof e[h]){c(e[h]);a:{var k=void 0;var m=e[h];if(m instanceof Array||m instanceof String)k=!1;else{for(k in m)if(m.hasOwnProperty(k)){k=!1;break a}k=!0}}k&&delete e[h]}}function d(e){if(!(e instanceof Array||e instanceof String))for(var h in e)void 0===e[h]?delete e[h]:"object"===typeof e[h]&&d(e[h])}d(a);c(a)};GLANCE.Lib.compareObjects=function(a,c){return JSON.stringify(a)===JSON.stringify(c)};
GLANCE.Lib.compareVersions=function(a,c){a=String(a).split(".");var d=String(c).split(".");a.push([0,0,0,0]);d.push([0,0,0,0]);for(c=0;4>c;c++){isNaN(a[c])&&(a[c]=0);isNaN(d[c])&&(d[c]=0);if(Number(a[c])<Number(d[c]))return-1;if(Number(a[c])>Number(d[c]))return 1}return 0};GLANCE.Lib.AppendUrlParams=function(a,c){var d=a.indexOf("#");return 0>d?a+(-1===a.indexOf("?")?"?":"&")+c:GLANCE.Lib.AppendUrlParams(a.substring(0,d),c)+a.substring(d)};GLANCE.Lib.XMLDoc=function(a){this.ownerDoc=a.ownerDocument};
GLANCE.Lib.XMLDoc.prototype.getElementText=function(a){return(a=this.ownerDoc.querySelector(a))?a.textContent:null};
GLANCE.Lib.JSONFetch=async function(a,c){return new Promise(async(d,e)=>{c.headers={"Content-Type":"application/json"};"object"===typeof c.body&&(c.body=JSON.stringify(c.body));let h;try{h=await fetch(a,c)}catch(m){GLANCE.Lib.errlog(`JSON request to ${a} failed: ${m.message}`);e("connection");return}if(h.ok){try{var k=await h.json()}catch(m){GLANCE.Lib.errlog(`JSON request to ${a} reponse parse failed`,m),e("error")}d(k)}else GLANCE.Lib.errlog(`JSON request to ${a} failed status: ${h.status}`),d=
await h.text(),GLANCE.Lib.errlog(d),e(401===h.status||403===h.status?"authorization":"error")})};GLANCE.Lib.Request=function(a){GLANCE.Lib.useIFrameProxy?this.ifproxy=new GLANCE.Lib.Request.IFrameProxyRequest(a):this.xmlhttp=this.getXmlHttp();this.response=null;this.type=a};GLANCE.Lib.Request.prototype.setAuthorizer=function(a){this.authorizer=a};GLANCE.Lib.Request.prototype.setAuthorizationToken=function(a){this.authorizationToken=a};GLANCE.Lib.Request.prototype.getXmlHttp=function(){return new window.XMLHttpRequest};
GLANCE.Lib.Request.prototype.abort=function(){this.ifproxy?this.ifproxy.abort():this.xmlhttp.abort()};
GLANCE.Lib.Request.prototype.onreadystatechange=function(){if(4==this.xmlhttp.readyState){GLANCE.Lib.GElement.nativeMethod(window,"clearTimeout",this.requesttimeout);delete this.requesttimeout;var a="error";if(0==this.xmlhttp.status)GLANCE.Lib.log(this.method+" to "+this.url+" failed: network"),this.onfailure(!0,"connection",this.xmlhttp.status);else if(200!==this.xmlhttp.status){GLANCE.Lib.errlog(this.method+" to "+this.url+" failed with status: "+this.xmlhttp.status);"text"===this.xmlhttp.responseType&&
null!==this.xmlhttp.responseText&&GLANCE.Lib.log(this.xmlhttp.responseText);if(401===this.xmlhttp.status||403===this.xmlhttp.status)a="authorization",this.authorizer&&this.authorizer.clearToken();this.onfailure(!1,a,this.xmlhttp.status)}else{if(""!==this.xmlhttp.response){if("XML"===this.accept)this.response=this.xmlhttp.responseXML&&this.xmlhttp.responseXML.documentElement,null===this.response&&GLANCE.Lib.errlog("Invalid XML response: "+this.xmlhttp.responseText);else if(this.IE11BinaryWorkaround){for(var c=
new Uint8Array(this.xmlhttp.responseText.length),d=0;d<this.xmlhttp.responseText.length;d++)c[d]=this.xmlhttp.responseText.charCodeAt(d)&255;this.response=new Blob([c],{type:this.xmlhttp.getResponseHeader("Content-Type")})}else if("blob"===this.xmlhttp.responseType)this.response=this.xmlhttp.response;else if(this.xmlhttp.responseXML)this.response=this.parsejson(this.xmlhttp.responseXML.childNodes[0].childNodes[0].nodeValue);else if("HTML"===this.accept||"TEXT"===this.accept)this.response=this.xmlhttp.responseText;
else if(this.response=this.parsejson(this.xmlhttp.responseText),null===this.response){GLANCE.Lib.log(this.method+" to "+this.url+" failed - can't parse response "+this.xmlhttp.responseText);this.onfailure(!1,a);return}if(void 0!==this.response.err&&void 0!==this.response.msg){GLANCE.Lib.log(this.method+" to "+this.url+" failed with error:"+this.response.err+" "+this.response.msg);this.onfailure(!1,a);return}}this.onsuccess(this.response)}}};
GLANCE.Lib.Request.prototype.parsejson=function(a){var c=null;try{c=JSON.parse(a)}catch(d){return GLANCE.Lib.log("JSON parse failed with error: "+d.toString()+" parsing: "+a),null}return c};GLANCE.Lib.Request.prototype.getResponseHeader=function(a){return this.xmlhttp.getResponseHeader(a)};
GLANCE.Lib.Request.prototype.setAccept=function(a){this.accept=a;"XML"===a?this.acceptheader="text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8":"JSON"===a?this.acceptheader="application/json, text/javascript, */*; q=0.01":"HTML"===a?this.acceptheader="text/html":"TEXT"===a?this.acceptheader="text/*":"IMAGE"===a?this.acceptheader="image/*":"BINARY"===a&&(this.acceptheader="*/*");if("IMAGE"===a||"BINARY"===a)this.xmlhttp.responseType="blob"};
GLANCE.Lib.Request.appendQueryStringParams=function(a,c){return a+"?"+Object.keys(c).map(function(d){return d+"="+c[d]}).join("&")};GLANCE.Lib.Request.prototype.get=function(a,c,d,e,h){this.method="GET";this.post(a,null,c,d,e,h)};GLANCE.Lib.Request.formUrlEncode=function(a){var c=[],d;for(d in a)a.hasOwnProperty(d)&&c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")};
GLANCE.Lib.Request.prototype.post=function(a,c,d,e,h,k){this.url=a;this.onsuccess=void 0!==h?h:function(){};this.onfailure=void 0!==k?k:function(){};this.method=this.method||"POST";if(this.ifproxy)this.ifproxy.post(a,c,d,e,h,k);else{h=this.contenttype||("JSON"===this.type?"application/json; charset=utf-8":"application/x-www-form-urlencoded; charset=utf-8");if("string"===typeof c)var m=c;else c instanceof Blob?(h=c.type,m=c):c&&(m="JSON"===this.type?GLANCE.Lib.JSONStringify(c):"data="+GLANCE.Lib.JSONStringify(c));
var r=this;GLANCE.Lib.Browser.safari&&this.safaritimeout&&(this.requesttimeout=GLANCE.Lib.GElement.nativeMethod(window,"setTimeout",function(){GLANCE.Lib.log(this.method+" to "+this.url+" failed - timedout (Safari)");this.onfailure(!1,"timedout")}.bind(this),this.safaritimeout));this.xmlhttp.onreadystatechange=function(){r.onreadystatechange()};try{this.xmlhttp.open(this.method,a,d),void 0!==this.acceptheader&&this.xmlhttp.setRequestHeader("Accept",this.acceptheader),void 0!==this.xmlhttp.setRequestHeader&&
"GET"!==this.method&&this.xmlhttp.setRequestHeader("Content-type",h),this.authorizer&&this.authorizer.gettoken()?this.xmlhttp.setRequestHeader("Authorization","Bearer "+this.authorizer.gettoken()):this.authorizationToken&&this.xmlhttp.setRequestHeader("Authorization","Bearer "+this.authorizationToken),this.xmlhttp.withCredentials=e,this.xmlhttp.send(m)}catch(t){GLANCE.Lib.log(this.method+" to "+a+" failed with: "+t.toString()),this.onfailure(!1,t.toString())}}};
GLANCE.Lib.Request.IFrameProxyRequest=function(a){this.type=a;GLANCE.Lib.Request.IFrameProxyRequest.currentRequest=this};GLANCE.Lib.Request.IFrameProxyRequest.init=function(a){GLANCE.Lib.RequestProxy.init(a);GLANCE.Lib.Window.addEventListener("message",GLANCE.Lib.Request.IFrameProxyRequest.handleMessage,!1)};
GLANCE.Lib.Request.IFrameProxyRequest.prototype.post=function(a,c,d,e,h,k){this.onsuccess=h;this.onfailure=k;GLANCE.Lib.RequestProxy.postMessage({from:"IFrameProxyRequest",type:this.type,url:a,obj:c,async:d,withcred:e})};GLANCE.Lib.Request.IFrameProxyRequest.prototype.abort=function(){GLANCE.Lib.Request.IFrameProxyRequest.postMessage({from:"IFrameProxyRequest",abort:!0})};var _protect_ifproxyresp={to:0,success:0,response:0};
GLANCE.Lib.Request.IFrameProxyRequest.handleMessage=function(a){if(GLANCE.Lib.getDomain(a.origin)===GLANCE.Lib.getDomain(GLANCE.Lib.RequestProxy.server)&&"undefined"!=typeof a.data.to&&"IFrameProxyRequest"==a.data.to)if(a.data.success)GLANCE.Lib.Request.IFrameProxyRequest.currentRequest.onsuccess(a.data.response);else GLANCE.Lib.Request.IFrameProxyRequest.currentRequest.onfailure()};GLANCE.Lib.Cookie=function(a,c){this.name=a;this.domain=c||(new GLANCE.Lib.Page(window)).getDomain()};
GLANCE.Lib.Cookie.prototype.setObj=function(a,c){var d=new Date;d.setUTCHours(d.getUTCHours()+8);document.cookie=this.name+"="+escape(GLANCE.Lib.JSONStringify(a))+"; expires="+d.toGMTString()+"; domain="+this.domain+"; path=/"+(c||a.secure?";secure":"")};GLANCE.Lib.Cookie.prototype.getObj=function(){var a=this.get();return a?JSON.parse(a):null};
GLANCE.Lib.Cookie.prototype.get=function(){return this.exists()?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(this.name).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null};GLANCE.Lib.Cookie.prototype.del=function(){var a=new Date;a.setDate(a.getDate()-1);document.cookie=escape(this.name)+"=; expires="+a.toGMTString()+"; domain="+this.domain+"; path=/"};
GLANCE.Lib.Cookie.prototype.exists=function(){return(new RegExp("(?:^|;\\s*)"+escape(this.name).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie)};GLANCE.Lib.lsCookie=function(a){this.name=a};GLANCE.Lib.lsCookie.prototype.setObj=function(a){var c=new Date;c.setUTCHours(c.getUTCHours()+8);localStorage.setItem(this.name,GLANCE.Lib.JSONStringify(a));localStorage.setItem(this.name+"_exp",c.toGMTString())};
GLANCE.Lib.lsCookie.prototype.getObj=function(){if(!this.exists())return null;var a=localStorage.getItem(this.name);return JSON.parse(a)};GLANCE.Lib.lsCookie.prototype.setExp=function(a){"string"===typeof a&&(a=parseInt(a));var c=new Date;c.setUTCMinutes(c.getUTCMinutes()+a);localStorage.setItem(this.name+"_exp",c.toGMTString())};GLANCE.Lib.lsCookie.prototype.get=function(){return this.exists()?localStorage.getItem(this.name):null};
GLANCE.Lib.lsCookie.prototype.del=function(){localStorage.removeItem(this.name);localStorage.removeItem(this.name+"_exp")};GLANCE.Lib.lsCookie.prototype.exists=function(){var a=localStorage.getItem(this.name+"_exp");if(!a)return!1;a=new Date(a);return a<new Date?(this.del(),!1):!0};GLANCE.Lib.DualCookie=function(a,c){this.cookies=[new GLANCE.Lib.Cookie(a,c),new GLANCE.Lib.lsCookie(a)]};GLANCE.Lib.DualCookie.prototype.setObj=function(a,c){this.cookies[0].setObj(a,c);this.cookies[1].setObj(a,c)};
GLANCE.Lib.DualCookie.prototype.getObj=function(){return this.cookies[0].getObj()||this.cookies[1].getObj()};GLANCE.Lib.DualCookie.prototype.get=function(){return this.cookies[0].get()||this.cookies[1].get()};GLANCE.Lib.DualCookie.prototype.del=function(){this.cookies[0].del();this.cookies[1].del()};GLANCE.Lib.DualCookie.prototype.exists=function(){return this.cookies[0].exists()||this.cookies[1].exists()};
GLANCE.Lib.formatDocEvent=function(a){var c={};["url","name","visitorselected","agentselected"].forEach(d=>{a.hasOwnProperty(d)&&(c[d]=a[d])});return c};GLANCE.Lib.parseSize=function(a,c,d){c={w:c,h:d};a&&((d=a.match(/(\d+)x(\d+)/))&&3===d.length||GLANCE.Lib.log("ERR_INVALIDDIMS:"+a),c.w=d[1],c.h=d[2]);return c};GLANCE.Lib.Event=function(a){this.event=a||window.event;this.client={x:this.event.clientX,y:this.event.clientY}};GLANCE.Lib.toEvent=function(a){return new GLANCE.Lib.Event(a)};
GLANCE.Lib.Event.fireHTMLEvent=function(a,c){if("undefined"!==typeof CustomEvent)try{var d=new CustomEvent(c)}catch(e){}d||(d=document.createEvent("HTMLEvents"),d.initEvent(c,!0,!0));a.dispatchEvent(d)};GLANCE.Lib.Event.fireKeyboardEvent=function(a,c){c=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,key:String.fromCharCode(c.code),"char":String.fromCharCode(c.code),shiftKey:!1});a.dispatchEvent(c)};
GLANCE.Lib.cssEscape=function(a){function c(e,h,k){e=48+parseInt(e);return"\\"+GLANCE.Lib.pad(e.toString(16),"0",6)}function d(e,h,k){return"\\"+e}if(a)return a=a.trim().replace(/[^\w\d-_]/g,d),/^\d/.test(a)&&(a=a.replace(/^\d/,c)),/^-/.test(a)&&(a=a.replace(/^-/,d)),a};
GLANCE.Lib.Page=function(a){this.doc=a.document;this.wnd=a;this.mouse={x:-1,y:-1};this.browser=GLANCE.Lib.Browser;var c=[["hidden","visibilitychange"],["mozHidden","mozvisibilitychange"],["webkitHidden","webkitvisibilitychange"],["msHidden","msvisibilitychange"],["oHidden","ovisibilitychange"]];for(a=0;a<c.length;a++)if(c[a][0]in document){this.HIDDENATTR=c[a][0];this.VISCHANGEEVT=c[a][1];break}};
GLANCE.Lib.hostFromUrl=function(a){var c=a;a=a.split("?");1<a.length&&(c=a[0]);c=(new RegExp(/(?:.*?:\/\/){0,1}([^\/:]+)/)).exec(c);return null===c||2>c.length||0>c[1].indexOf(".")?null:c[1]};
GLANCE.Lib.getDomain=function(a){var c=new RegExp(/^(?:[a-z]{1,5}:\/\/|)([^:\?\/]*)/),d=a.match(/^\d+\.\d+.\d+.\d+$/);c=c.exec(a);if(d)return a;if(null===c||2!==c.length)return"about:"!==a&&GLANCE.Lib.log("ERR_DOMAINPARSE: "+a),null;d=c[1].split(".");return 1===d.length?(GLANCE.Lib.log("ERR_DOMAINPARSE: "+a),null):2===d.length?d.join("."):3===d.length?d.slice(1).join("."):4>=d[d.length-2].length?d.slice(d.length-3).join("."):d.slice(d.length-2).join(".")};
GLANCE.Lib.isAllowedOrigin=function(a,c){var d=!1;a=GLANCE.Lib.hostFromUrl(a);if(null===a||!c)return!1;c.forEach(function(e,h){"object"===typeof e&&(e=e.domain);if(a.match(new RegExp("\\."+e+"$","i"))||a===e)d={index:h,domain:e}});return d};GLANCE.Lib.Page.prototype.getStylesheet=function(a){for(var c=this.doc.styleSheets,d=0;d<c.length;d++)if(c[d].ownerNode&&c[d].ownerNode.getAttribute(GLANCE.Lib.Const.GID)===a.getAttribute(GLANCE.Lib.Const.GID))return c[d];return null};
GLANCE.Lib.Page.prototype.getURL=function(){return window.location.href.replace(/\?.*/g,"")};GLANCE.Lib.Page.prototype.getProto=function(){for(var a=this.wnd.location.protocol,c=this.wnd;("about:"===a||"javascript:"===a)&&c.parent!==c;)a=c.parent.location.protocol,c=c.parent;return a.replace(/:/g,"")};GLANCE.Lib.Page.prototype.isSrclessIframe=function(){return this.wnd.parent!==this.wnd&&""===this.wnd.location.hostname};
GLANCE.Lib.Page.prototype.getDomain=function(){for(var a=this.wnd.location.hostname,c=this.wnd;""===a&&c.parent!==c;)a=c.parent.location.hostname,c=c.parent;return GLANCE.Lib.getDomain(a)};GLANCE.Lib.Page.prototype.inList=function(a){for(var c=window.location.href.toLowerCase(),d=0;d<a.length;d++)if(0<=c.indexOf(a[d].toLowerCase()))return!0;return!1};
GLANCE.Lib.stringToBlob=function(a,c){for(var d=new ArrayBuffer(a.length),e=new Uint8Array(d),h=0,k=a.length;h<k;h++)e[h]=a.charCodeAt(h);return new Blob([d],{type:c})};GLANCE.Lib.trapFocusInIframe=function(){["first","last"].forEach(function(a){let c=document.querySelector("."+a+"control");c&&(c.addEventListener("keydown",function(d){("Tab"===d.key&&"last"===a&&!d.shiftKey||"first"===a&&d.shiftKey)&&d.preventDefault()}),"first"===a&&c.focus())})};
GLANCE.Lib.getScrollables=function(a){function c(e){if(e=GLANCE.Lib.GElement.nativeGetProperty("children",e))for(var h=0;h<e.length;h++)GLANCE.Lib.toElem(e[h]).isScrollable()&&d.push(e[h]),c(e[h])}var d=[];c(a);return d};GLANCE.Lib.Page.prototype.getElementsByTagName=function(a){return GLANCE.Lib.GElement.nativeMethod(this.doc,"getElementsByTagName",a)};
GLANCE.Lib.Page.prototype.isLinkToOtherDomain=function(a){for(var c,d=this.getDomain();a&&!GLANCE.Lib.toElem(a).isBody();){if(a instanceof DocumentFragment){a=null;break}if("a"===a.tagName.toLowerCase())break;a=a.parentNode}if(!a||"a"!==a.tagName.toLowerCase())return!1;c=a.href;c=c.baseVal||c;var e=c.indexOf("//");if(0>e)return!1;0===e&&(c="http:"+c);return a.hasAttribute("download")||c.startsWith("blob:")?!1:GLANCE.Lib.getDomain(c)!==d};
GLANCE.Lib.Page.prototype.getUrlParam=function(a){a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(this.wnd.location.href);return null==a?"":a[1]};GLANCE.Lib.Page.prototype.addScriptAsync=async function(a){return new Promise((c,d)=>{var e=this.doc.createElement("script");e.onload=c;e.onerror=d;for(const h in a)e.setAttribute(h,a[h]);e.setAttribute("charset","UTF-8");this.doc.head.appendChild(e)})};
GLANCE.Lib.Page.prototype.addScript=function(a,c,d){var e=this.doc.createElement("script");c&&e.addEventListener("load",c);d&&e.addEventListener("error",d);e.setAttribute("type","text/javascript");e.setAttribute("charset","UTF-8");for(c=0;c<a.length;c++)e.setAttribute(a[c][0],a[c][1]);this.doc.head.appendChild(e);return e};GLANCE.Lib.Page.prototype.VSCROLL=1;GLANCE.Lib.Page.prototype.HSCROLL=2;
GLANCE.Lib.Page.prototype.getScrollVisible=function(a){var c=this.getDimensions(),d=this.getDocDimensions(),e=GLANCE.Lib.Page.getComputedStyle(this.doc.body);if(null===e)return!1;var h=a===this.VSCROLL?e.overflowY:e.overflowX;return(a===this.VSCROLL?d.y:d.x)>(a===this.VSCROLL?c.y:c.x)&&("visible"===e.overflow||"visible"===h||"auto"===e.overflow||"auto"===h||"scroll"===h)};GLANCE.Lib.Page.prototype.getElement=function(a){return GLANCE.Lib.GElement.nativeMethod(this.doc,"getElementById",a)};
GLANCE.Lib.Page.prototype.trackMouse=function(){var a=this;this.onMouseMove=function(c){c=new GLANCE.Lib.Event(c);a.mouse.x=c.client.x||-1;a.mouse.y=c.client.y||-1;return!0};this.onMouseOut=function(c){new GLANCE.Lib.Event(c);a.mouse.x=-1;a.mouse.y=-1;return!0};this.addEventListener("mousemove",this.onMouseMove);this.addEventListener("mouseout",this.onMouseOut)};
GLANCE.Lib.Page.prototype.stopTrackMouse=function(){this.doc.removeEventListener("mousemove",this.onMouseMove);this.doc.removeEventListener("mouseout",this.onMouseOut)};GLANCE.Lib.Page.prototype.trackMouseClick=function(){var a=this;this.clearMouseClick();this.onMouseClick=function(c){c=new GLANCE.Lib.Event(c);a.click.x=c.client.x||0;a.click.y=c.client.y||0;a.click.ts=Date.now();return!0};this.addEventListener("click",this.onMouseClick)};
GLANCE.Lib.Page.prototype.stopTrackMouseClick=function(){this.doc.removeEventListener("click",this.onMouseClick)};GLANCE.Lib.Page.prototype.getMouse=function(){return this.getElemRelativeCoords(this.mouse)};GLANCE.Lib.Page.prototype.clearMouse=function(){this.mouse={x:-1,y:-1}};GLANCE.Lib.Page.prototype.getMouseClick=function(){var a=this.click;this.click={x:-1,y:-1};return this.getElemRelativeCoords(a)};GLANCE.Lib.Page.prototype.clearMouseClick=function(){this.click={x:-1,y:-1}};
GLANCE.Lib.Page.prototype.isHidden=function(){return void 0===this.HIDDENATTR?!1:this.doc[this.HIDDENATTR]};GLANCE.Lib.Page.prototype.onVisibilityChange=function(a){this.doc.addEventListener(this.VISCHANGEEVT,a)};
GLANCE.Lib.Page.prototype.getNonFixedElemNear=function(a,c){function d(m){if(!m||"body"===m.tagName.toLowerCase())return!1;let r=GLANCE.Lib.Page.getComputedStyle(m).position;return"fixed"===r||"sticky"===r?!0:d(GLANCE.Lib.GElement.nativeGetProperty("parentElement",m))}var e,h=0,k={};for(GLANCE.Lib.Params.copy(a,k);(e=this.getElemAt(k))&&d(e);)if(scrolllog("skipping fixed elem "+e.tagName+"  class="+e.getAttribute("class")+" data-gid="+e.getAttribute(GLANCE.Lib.Const.GID)+" at "+JSON.stringify(k)),
k[c]+=50,10<h++)return scrolllog("getNonFixedElemNear not finding a non fixed element, returning body"),document.body;scrolllog("getNonFixedElemNear found non-fixed elem "+e.tagName+"  class="+e.getAttribute("class")+" data-gid="+e.getAttribute(GLANCE.Lib.Const.GID)+" at "+JSON.stringify(k));return e||document.body};GLANCE.Lib.Page.prototype.getElemAt=function(a){a=document.elementsFromPoint(a.x,a.y).filter(c=>"glance_overlay"!==c.id)[0];a||(a=document.body);3==a.nodeType&&(a=a.parentNode);return a};
GLANCE.Lib.Page.coordsOutside=function(a){a=a.client||a;return 0>a.x||0>a.y};
GLANCE.Lib.Page.prototype.getElemRelativeCoords=function(a,c,d){if(a&&(0>a.x||0>a.y))return{client:{x:Math.round(a.x),y:Math.round(a.y)}};a=a||this.pageToClientCoords(c);c=c||this.clientToPageCoords(a);d=GLANCE.Lib.toElem(d?this.getNonFixedElemNear(a,d):this.getElemAt(a));if(d.matches("#glance_session_widget *")||d.matches("#glance_screensharepreview"))d=GLANCE.Lib.toElem(document.getElementById("glance_session_widget"));var e=d.getCoords();return{client:{x:Math.round(a.x),y:Math.round(a.y)},relative:{x:Math.round(c.x-
e.x),y:Math.round(c.y-e.y),element:d.getPath()}}};GLANCE.Lib.Page.prototype.getElemRelativeOffset=function(a,c){if(0===c)return{offset:0};var d=this.getScrollCoords(a,c);d=this.getElemRelativeCoords(void 0,d,a).relative;return{offset:c,relative:{element:d.element,offset:d[a]}}};GLANCE.Lib.Page.prototype.relativeOffsetToPage=function(a,c,d){if(!c)return d;var e={element:c.element};e[a]=c.offset;e["x"===a?"y":"x"]=0;return(c=this.relativeCoordsToPage(e))?c[a]:d};
GLANCE.Lib.Page.prototype.relativeCoordsToClient=function(a,c){return(a=this.relativeCoordsToPage(a))?this.pageToClientCoords(a):c};GLANCE.Lib.Page.prototype.relativeCoordsToPage=function(a,c){var d=a?GLANCE.Lib.toElem(this.doc.documentElement).getUniqueElement(a.element,!1):null;if(null===d)return GLANCE.Lib.log("Element not found for relative coords"),c;c=GLANCE.Lib.toElem(d).getCoords();return{x:c.x+a.x,y:c.y+a.y}};
GLANCE.Lib.Page.prototype.toAbsoluteUrls=function(a,c){var d,e=this;return a.replace(RegExp("url\\s*\\(['\"]?(\\s*(?!.*//.*).+?)['\"]?\\)","g"),function(h,k){"/"!==k.charAt(0)&&(d=e.getPath())&&(k=d+k);return"url("+c+e.wnd.location.host+k+")"})};GLANCE.Lib.Page.prototype.head=function(){return void 0!==this.doc.head?this.doc.head:this.getElementsByTagName("head")[0]};GLANCE.Lib.Page.prototype.cloneBody=function(){return GLANCE.Lib.toElem(this.doc.body).deepClone()};
GLANCE.Lib.Page.prototype.cloneHead=function(){return this.doc.head.cloneNode(!0)};GLANCE.Lib.Page.prototype.addLoadListener=function(a){this.wnd.addEventListener&&(document.readyState.match(/complete/)?a():(this.wnd.addEventListener("load",a),this.doc.addEventListener("DOMContentLoaded",a,!1)))};GLANCE.Lib.Page.prototype.getDocContainer=function(){return this.doc.compatMode&&"CSS1Compat"!==this.doc.compatMode?this.doc.body:this.doc.documentElement};
GLANCE.Lib.Page.prototype.getDimensions=function(){if(void 0!==window.orientation)return{x:window.innerWidth,y:window.innerHeight};var a=this.getDocContainer();return{x:a.clientWidth,y:a.clientHeight}};GLANCE.Lib.Page.prototype.getDocDimensions=function(){if(this.doc.width)return{x:this.doc.width,y:this.doc.height};var a=this.getDocContainer();return{x:a.scrollWidth,y:a.scrollHeight}};
GLANCE.Lib.Page.prototype.getScrollInfo=function(){for(var a=this.getDimensions(),c=this.getDocDimensions(),d=["x","y"],e,h,k,m,r={},t=0;t<d.length;t++)e=d[t],h=Math.round(Math.pow(a[e],2)/c[e]),k=a[e]-4,m=0,c[e]>a[e]&&(m=(k-h)/(c[e]-a[e])),m=Math.round(1E4*m)/1E4,r[e]={tabsz:h,ratio:m};return r};
GLANCE.Lib.Page.prototype.getScroll=function(){if(void 0!==window.pageXOffset)return{x:Math.round(this.wnd.pageXOffset),y:Math.round(this.wnd.pageYOffset)};if(void 0!==document.documentElement.scrollTop)return{x:this.doc.documentElement.scrollLeft,y:this.doc.documentElement.scrollTop};if(void 0!==document.body.scrollLeft)return{x:this.doc.body.scrollLeft,y:this.doc.body.scrollTop};throw Error("Can't get page scroll");};
GLANCE.Lib.Page.prototype.getScrollCoords=function(a,c){var d=this.getDimensions(),e=this.getScroll();return{x:"x"===a?c:d.x/2+e.x,y:"y"===a?c:d.y/2+e.y}};GLANCE.Lib.Page.prototype.pageToClientCoords=function(a){var c=this.getScroll();return{x:a.x-c.x,y:a.y-c.y}};GLANCE.Lib.Page.prototype.clientToPageCoords=function(a){var c=this.getScroll();return{x:a.x+c.x,y:a.y+c.y}};
GLANCE.Lib.Page.prototype.scrollTo=function(a,c,d){var e=this.getScroll();e[a]=c;a={left:e.x,top:e.y,behavior:d?"smooth":"auto"};GLANCE.Lib.Browser.ie11||GLANCE.Lib.Browser.edge?window.scrollTo(e.x,e.y):window.scrollTo(a);scrolllog("scrolled the page to:",e,"new scroll position:",this.getScroll())};GLANCE.Lib.Page.prototype.getPath=function(){var a=this.origPath(),c=a.match(/(((.*?)\/)*)([^\/]+)/);return 0>a.indexOf(".")?a:c?c[1]:null};
GLANCE.Lib.Page.prototype.getBasePath=function(){let a=new URL(document.baseURI),c=a.pathname.split("/");0<c.slice(-1).indexOf(".")&&(c=c.slice(0,-1));return a.origin+c.join("/")};GLANCE.Lib.Page.prototype.origPath=function(){return window.GLANCE.Cobrowse.Loader._origpath};GLANCE.Lib.Page.prototype.pathChanged=function(){return window===window.parent&&window.location.pathname!==this.origPath()};GLANCE.Lib.Page.getComputedStyle=function(a,c){return window.getComputedStyle(a,c)};
GLANCE.Lib.Page.prototype.addEventListener=function(a,c,d){GLANCE.Lib.GElement.nativeMethod(this.doc,"addEventListener",a,c,d)};GLANCE.Lib.Page.prototype.removeEventListener=function(a,c,d){GLANCE.Lib.GElement.nativeMethod(this.doc,"removeEventListener",a,c,d)};GLANCE.Lib.errlog=function(a){GlanceLogger.error(a)};GLANCE.Lib.log=function(a){GlanceLogger.log(a)};
GLANCE.Lib.moo={extendElement:function(a){a.playAnimation=function(c,d){window.clearTimeout(a.timeout);a.removeClass(c);window.requestAnimationFrame(function(e){window.requestAnimationFrame(function(h){a.addClass(c);a.timeout=window.setTimeout(()=>{a.removeClass("remoteclick")},d)})})}}};GLANCE.Lib.GElement=function(a){this.element=a};GLANCE.Lib.toElem=function(a){return new GLANCE.Lib.GElement(a)};
GLANCE.Lib.GElement.prototype.show=function(a){void 0===a&&(a=!0);this.element.className.match(new RegExp(a?"glance_show":"glance_hide","g"))||(this.replaceClass(a?"glance_hide":"glance_show",a?"glance_show":"glance_hide"),this.addClass(a?"glance_show":"glance_hide"))};GLANCE.Lib.GElement.prototype.dummyOuterHTML=function(){var a=this.element.id?' id="'+this.element.id+'"':"";return"<meta "+GLANCE.Lib.Const.GID+'="'+this.element.getAttribute(GLANCE.Lib.Const.GID)+'"'+a+"></meta>"};
GLANCE.Lib.GElement.prototype.addClass=function(a){"string"===typeof this.element.className&&this.element.className.match(new RegExp("\\b"+a+"\\b","g"))||(this.element.className+=" "+a)};GLANCE.Lib.GElement.prototype.removeClass=function(a){this.element.className=this.element.className.replace(new RegExp("\\s+"+a,"g"),"")};GLANCE.Lib.GElement.prototype.replaceClass=function(a,c){this.element.className=this.element.className.replace(new RegExp(a,"g"),c)};
GLANCE.Lib.GElement.prototype.addEventListener=function(a,c,d){GLANCE.Lib.GElement.nativeMethod(this.element,"addEventListener",c,d)};GLANCE.Lib.GElement.prototype.removeEventListener=function(a,c,d){GLANCE.Lib.GElement.nativeMethod(this.element,"removeEventListener",c,d)};GLANCE.Lib.GElement.prototype.isTextInput=function(){return this.element.tagName.match(/^textarea$/i)||this.element.type.match(/^(text|datetime|email|password|tel|url|number)$/i)};
GLANCE.Lib.GElement.prototype.isButtonInput=function(){return this.element.tagName.match(/^input$/i)&&this.element.type.match(/^(radio|checkbox|button)$/i)};GLANCE.Lib.GElement.prototype.hasNativeShadowRoot=function(){return this.element.attachShadow==Element.prototype.attachShadow&&GLANCE.Lib.GElement.nativeGetProperty("shadowRoot",this.element)};
GLANCE.Lib.GElement.prototype.hasGIDlessDescendants=function(){for(var a=GLANCE.Lib.GElement.nativeMethod(this.element,"querySelectorAll","*"),c=0;c<a.length;c++)if(!a[c].getAttribute(GLANCE.Lib.Const.GID))return!0;return!1};
GLANCE.Lib.GElement.prototype.simulateMouseEvent=function(a,c){"click"===a&&this.element.tagName.match(/input|textarea/i)&&(this.element.focus(),this.isTextInput()&&"number"!==this.element.type&&(this.element.selectionStart=this.element.selectionEnd));if("click"===a&&void 0!==this.element.click)this.element.click();else{void 0===c&&(c={view:window,bubbles:!0,cancelable:!0});try{var d=new MouseEvent(a,c)}catch(e){d=this.element.ownerDocument.createEvent("MouseEvents"),d.initMouseEvent(a,!0,!0,this.element.ownerDocument.defaultView,
1,0,0,0,0,!1,!1,!1,!1,1,null)}this.element.dispatchEvent(d)}};
GLANCE.Lib.GElement.nativeGetProperty=function(a,c){if(!GLANCE.Lib.GElement.USE_CLEANCONTEXT||1!==c.nodeType)return c[a];var d=GLANCE.Lib.GElement.USE_CLEANCONTEXT?GLANCE.Lib.GElement.CleanContext:window;if(GLANCE.Lib.GElement.USE_CLEANCONTEXT)try{var e=d.document.createElement(c.nodeName)}catch(k){e=d.document.createElement("div")}else e=c;e=d.Object.getPrototypeOf(e);if(!e)return c[a];if("contentWindow"===a)return d.Object.getOwnPropertyDescriptor(e,a).get.call(c);for(var h;!(h=d.Object.getOwnPropertyDescriptor(e,
a))||0>h.get.toString().indexOf("[native code]");)if(e=d.Object.getPrototypeOf(e),!e)return c[a];return h.get.call(c)};
GLANCE.Lib.GElement.nativeMethod=function(a,c,...d){return GLANCE.Lib.GElement.USE_CLEANCONTEXT&&GLANCE.Lib.GElement.CleanContext&&a.nodeType?"#document"===a.nodeName?GLANCE.Lib.GElement.CleanContext.document[c].apply(a,d):"#document-fragment"===a.nodeName?GLANCE.Lib.GElement.CleanContext.DocumentFragment.prototype[c].apply(a,d):GLANCE.Lib.GElement.CleanContext.document.body[c].apply(a,d):GLANCE.Lib.GElement.USE_CLEANCONTEXT&&GLANCE.Lib.GElement.CleanContext&&"[object Window]"===a.toString()?GLANCE.Lib.GElement.CleanContext.window[c].apply(a,
d):a[c].apply(a,d)};
GLANCE.Lib.GElement.getNativeMethod=function(a,c){return GLANCE.Lib.GElement.USE_CLEANCONTEXT&&GLANCE.Lib.GElement.CleanContext&&GLANCE.Lib.GElement.CleanContext.document[a]?"#document"===c.nodeName?GLANCE.Lib.GElement.CleanContext.document[a]:"#document-fragment"===c.nodeName?GLANCE.Lib.GElement.CleanContext.DocumentFragment.prototype[a]:GLANCE.Lib.GElement.CleanContext.document.body[a]:GLANCE.Lib.GElement.USE_CLEANCONTEXT&&GLANCE.Lib.GElement.CleanContext&&"[object Window]"===c.toString()?GLANCE.Lib.GElement.CleanContext.window[a]:
c[a]};GLANCE.Lib.GElement.nativeInstance=function(a,...c){a=GLANCE.Lib.GElement.CleanContext.window[a];return new (Function.bind.apply(a,[a,...c]))};
GLANCE.Lib.GElement.prototype.deepClone=function(){try{if(GLANCE.Lib.GElement.USE_CLEANCONTEXT)if(GLANCE.Lib.GElement.CleanContext.clone)var a=GLANCE.Lib.GElement.CleanContext.clone(this.element);else diffslog("clean context clone not loaded  cloning "+this.element.gid+" iframe:"+window.parent!==window),a=GLANCE.Lib.GElement.nativeMethod(this.element,"cloneNode",!0);else a=this.element.cloneNode(!0);return a}catch(c){GLANCE.Lib.log("deepClone failed for "+this.element.tagName+" error:"+c.message)}return this.element.cloneNode(!0)};
GLANCE.Lib.GElement.prototype.isDescendantOf=function(a){return a.contains?GLANCE.Lib.Browser.ie11&&this.element.nodeType===Node.TEXT_NODE?this.element.parentNode===a||GLANCE.Lib.GElement.nativeMethod(a,"contains",this.element.parentNode):GLANCE.Lib.GElement.nativeMethod(a,"contains",this.element):!1};GLANCE.Lib.GElement.prototype.remove=function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)};
GLANCE.Lib.GElement.prototype.isScrollable=function(){if(!this.element)return!1;var a=window.getComputedStyle(this.element);return null===a?!1:(a.overflowX+a.overflowY).match(/scroll|auto/)};GLANCE.Lib.GElement.prototype.replaces=function(a){this.element.parent.replaceChild(this.element,a)};GLANCE.Lib.GElement.prototype.empty=function(){for(;this.element.hasChildNodes();)this.element.removeChild(this.element.childNodes[0])};
GLANCE.Lib.GElement.prototype.getDimensions=function(){if(this.element.getBoundingClientRect){var a=this.element.getBoundingClientRect();return{width:Math.round(a.right-a.left),height:Math.round(a.bottom-a.top)}}return{width:this.element.offsetWidth,height:this.element.offsetHeight}};GLANCE.Lib.GElement.prototype.setDimensions=function(a,c){this.element.style.width=a+"px";this.element.style.height=c+"px"};GLANCE.Lib.GElement.prototype.isBody=function(){return/^(?:body|html)$/i.test(this.element.tagName)};
GLANCE.Lib.GElement.prototype.isHead=function(){return/^(?:head)$/i.test(this.element.tagName)};GLANCE.Lib.GElement.prototype.isHeadOrHeadChild=function(){return this.isHead()||this.isDescendantOf(document.head)};GLANCE.Lib.GElement.prototype.getScrolls=function(){for(var a=this.element.parentNode,c={x:0,y:0};a&&!GLANCE.Lib.toElem(a).isBody();)c.x+=a.scrollLeft,c.y+=a.scrollTop,a=a.parentNode;return c};
GLANCE.Lib.GElement.prototype.getCoords=function(a){if(this.element.tagName.match(/html/i))return{x:0,y:0};var c=this.element.getBoundingClientRect(),d=document.documentElement,e=(new GLANCE.Lib.Page(window)).getScroll();if(a=!a)a=GLANCE.Lib.Page.getComputedStyle(this.element),a="fixed"===(a?a.getPropertyValue("position"):"");return{x:parseInt(c.left)+(a?0:e.x)-d.clientLeft,y:parseInt(c.top)+(a?0:e.y)-d.clientTop}};
GLANCE.Lib.GElement.prototype.setCoords=function(a,c){this.element.style.left=a+"px";this.element.style.top=c+"px"};GLANCE.Lib.GElement.prototype.positionAtZero=function(){if("static"!==GLANCE.Lib.Page.getComputedStyle(document.body).position){let a=GLANCE.Lib.toElem(document.body).getCoords(!0);this.setCoords(-a.x,-a.y)}else this.setCoords(0,0)};
GLANCE.Lib.GElement.prototype.containsElemCoords=function(a){var c=a.getCoords();a=a.getDimensions();var d=this.getCoords(),e=this.getDimensions();return!(c.x+a.width>d.x+e.width||c.x<d.x||c.y+a.height>d.y+e.height||c.y<d.y)};
GLANCE.Lib.GElement.prototype.pointInScrollbar=function(a){if(!this.isScrollable())return!1;var c=this.element.getBoundingClientRect();return a.y>c.top&&a.y<c.bottom&&a.x>c.left+this.element.clientWidth&&a.x<c.right||a.x>c.left&&a.x<c.right&&a.y>c.top+this.element.clientHeight&&a.y<c.bottom};
GLANCE.Lib.GElement.prototype.moveTo=function(a,c){function d(){10>m++?(h+=r,k+=t,e.setCoords(Math.floor(h),Math.floor(k)),e.movetimer=GLANCE.Lib.GElement.nativeMethod(window,"setTimeout",d,20)):e.setCoords(a,c)}void 0!==this.movetimer&&GLANCE.Lib.GElement.nativeMethod(window,"clearTimeout",this.movetimer);var e=this,h=parseInt(this.element.style.left),k=parseInt(this.element.style.top);isNaN(h)&&(h=-999);isNaN(k)&&(k=-999);var m=0,r=(a-h)/10,t=(c-k)/10;0===r&&0===t||d()};
GLANCE.Lib.GElement.prototype.cancelFade=function(){null!=this.fadeStartTimer&&GLANCE.Lib.GElement.nativeMethod(window,"clearTimeout",this.fadeStartTimer);this.fadeStartTimer=null;this.fadeInterval&&GLANCE.Lib.GElement.nativeMethod(window,"clearInterval",this.fadeInterval);this.fadeInterval=null};GLANCE.Lib.GElement.prototype.setOpacity=function(a){this.opacity=a;this.element.style.opacity=this.opacity/100;this.element.style.filter="alpha(opacity = "+this.opacity+")"};
GLANCE.Lib.GElement.prototype.fade=function(a,c,d){var e=this,h=new Date;null!==this.fadeInterval&&this.cancelFade();this.fadeInterval=GLANCE.Lib.GElement.nativeMethod(window,"setInterval",function(){var k=new Date-h;k>=a?(e.setOpacity(0),e.cancelFade(),d&&d()):e.setOpacity(Math.max(0,c(k/a)))},50)};
GLANCE.Lib.GElement.prototype.getSelectorRelativeToParent=function(){var a,c=1,d=this.tagNameLCase();for(a=this.element.previousElementSibling;null!=a;a=a.previousElementSibling)a.tagName.toLowerCase()===d&&c++;return GLANCE.Lib.cssEscape(d)+":nth-of-type("+c+")"};GLANCE.Lib.GElement.prototype.tagNameLCase=function(){return this.element==document?"document":this.element.tagName.toLowerCase()};
GLANCE.Lib.GElement.prototype.cssid=function(){var a=this.element.getAttribute("id");return a?"#"+GLANCE.Lib.cssEscape(a):void 0};GLANCE.Lib.GElement.prototype.isSelectiveEditable=function(){return!this.element.matches(".glance_masked")&&(this.element.matches(".glance_controllable")||this.element.matches(".glance_controllable *"))};
GLANCE.Lib.GElement.prototype.getPath=function(){for(var a=[],c=this,d;c.element&&c.element.tagName;){if(c.isBody()||c.isHead()){a.unshift(c.tagNameLCase());break}var e=GLANCE.Lib.GElement.nativeGetProperty("parentNode",c.element);if(null===e)return null;d=c.cssid();if(c.element.getAttribute(GLANCE.Lib.Const.GID)){a.unshift("["+GLANCE.Lib.Const.GID+'="'+c.element.getAttribute(GLANCE.Lib.Const.GID)+'"]');break}else if(d&&1===GLANCE.Lib.toElem(e).getElements(d).length){if(a.unshift(d),1===GLANCE.Lib.toElem(document.documentElement).getElements(d).length)break}else a.unshift(c.getSelectorRelativeToParent());
c=GLANCE.Lib.toElem(e)}return a.join(">")};GLANCE.Lib.GElement.matchesShim=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.msMatchesSelector;GLANCE.Lib.GElement.prototype.matches=function(a){return GLANCE.Lib.GElement.matchesShim.call(this.element,a)};GLANCE.Lib.GElement.prototype.matchesAny=function(a){return 0<a.length&&this.matches(a.join(","))};
GLANCE.Lib.GElement.prototype.getElements=function(a){return GLANCE.Lib.GElement.nativeMethod(this.element,"querySelectorAll",a)};GLANCE.Lib.GElement.prototype.getShadowDOMElementPath=function(a){if(!a)return null;a=a.replace(/'/g,'"');return(a=a.match(new RegExp("\\["+GLANCE.Lib.Const.GID+'="(.*-.*)"\\]')))&&2===a.length?a[1]:null};
GLANCE.Lib.GElement.prototype.findElementInShadowDOM=function(a){function c(e,h,k){if(null===e)return sdlog("No shadow root at level "+k+"for selector "+a),null;var m="["+GLANCE.Lib.Const.GID+"='"+h.slice(0,k+1).join("-")+"']";e=GLANCE.Lib.GElement.nativeMethod(e,"querySelector",m);return e?k===h.length-1?e:c(e.shadowRoot,h,k+1):(sdlog("sdid "+m+" not found"),null)}var d=this.getShadowDOMElementPath(a);if(!d)return null;d=d.split("-");return c(this.element.ownerDocument,d,0)};
GLANCE.Lib.GElement.prototype.getUniqueElement=function(a,c){function d(h){if(c)throw Error(h);GLANCE.Lib.log(h);return null}if(this.element===document.documentElement&&"html"===a)return this.element;void 0===c&&(c=!0);var e=GLANCE.Lib.GElement.nativeMethod(this.element,"querySelectorAll",a);return 1===e.length?e[0]:1<e.length?d("Nonunique selector: "+a):(e=this.findElementInShadowDOM(a))?e:d("Element not found: "+a)};
GLANCE.Lib.GElement.prototype.getInputValue=function(a){var c=GLANCE.Lib.GElement.nativeGetProperty("type",this.element)||"";a={tag:GLANCE.Lib.GElement.nativeGetProperty("tagName",this.element),type:c,path:this.getPath(),id:GLANCE.Lib.GElement.nativeGetProperty("id",this.element),name:GLANCE.Lib.GElement.nativeGetProperty("name",this.element),sel:GLANCE.Lib.GElement.nativeGetProperty("selectedIndex",this.element),value:a||GLANCE.Lib.GElement.nativeGetProperty("value",this.element)};"string"===typeof a.value&&
(a.value=a.value.replace(/<\/script>/gi,"<\\/script>"));c.match(/^(radio|checkbox)$/i)&&(a.checked=this.element.checked);return a};GLANCE.Lib.GElement.prototype.setInputValue=function(a){switch(a.type.toLowerCase()){case "checkbox":case "radio":this.element.checked=a.checked;break;case "select-one":this.element.selectedIndex=a.sel;break;case "file":break;default:"string"===typeof a.value&&(this.element.value=a.value.replace("<\\/script>","\x3c/script>"))}};
GLANCE.Lib.MessageHandlers=function(){this.handlers={}};GLANCE.Lib.MessageHandlers.prototype.addHandler=function(a,c){this.handlers["^"+a+"$"]=c};GLANCE.Lib.MessageHandlers.prototype.dispatch=function(a){var c=this,d=a.messageName;delete a.messageName;Object.keys(this.handlers).forEach(function(e){if((new RegExp(e)).test(d))c.handlers[e](d,a)})};GLANCE.Lib.EventListeners=function(){this.listeners=this._listeners={}};
GLANCE.Lib.EventListeners.prototype.merge=function(a){a=a.listeners;for(var c in a)this._listeners[c]=(this._listeners[c]||[]).concat(a[c])};GLANCE.Lib.EventListeners.prototype.add=function(a,c){this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(c)};GLANCE.Lib.EventListeners.prototype.remove=function(a,c){a=this._listeners[a];void 0!==a&&(c=a.indexOf(c),0<=c&&a.splice(c,1))};GLANCE.Lib.EventListeners.prototype.removeAll=function(a){this._listeners[a]=[]};
GLANCE.Lib.EventListeners.prototype.fire=function(a,c){eventslog("fire "+a+" "+(c?JSON.stringify(c):""));var d=this._listeners[a],e=!0;if(void 0===d)return!0;for(a=0;a<d.length;a++)d[a](c)||(e=!1);return e};
GLANCE.Lib.CssRuleString=function(a){function c(m){return m.replace(/[\\]:/g,":").replace(":","\\:")}var d=new RegExp(/\[([^\[\]]*)\]/g);try{var e="",h="",k=a.cssRules||a.rules;for(a=0;a<k.length;a++)h=k[a].cssText,h=h.replace(d,c),e+=h+" ";return e}catch(m){return GLANCE.Lib.log("Exception getting csstext for stylesheet:"+m.toString()),""}};
GLANCE.Lib.DomDiff=function(){this.differences=[];this.htmlfilter=function(){return!0};this.renderedhtmlfilter=function(a){return a};this.attrfilter=function(a,c){return a.getAttribute(c)};this.contentfilter=function(){return!0};this.nogids=[]};GLANCE.Lib.DomDiff.prototype.setNoGids=function(a){this.nogids=a};
GLANCE.Lib.DomDiff.prototype.removeGIDs=function(a){delete a.gid;if(1===a.nodeType&&(a.removeAttribute(GLANCE.Lib.Const.GID),a.removeAttribute(GLANCE.Lib.Const.SDID),a.removeAttribute(GLANCE.Lib.Const.GCID),GLANCE.Lib.GElement.nativeGetProperty("children",a))){for(var c=0;c<GLANCE.Lib.GElement.nativeGetProperty("children",a).length;c++)this.removeGIDs(GLANCE.Lib.GElement.nativeGetProperty("children",a)[c]);if(GLANCE.Lib.toElem(a).hasNativeShadowRoot())for(a=GLANCE.Lib.GElement.nativeGetProperty("children",
a.shadowRoot),c=0;c<a.length;c++)this.removeGIDs(a[c])}};
GLANCE.Lib.DomDiff.prototype._assignGIDs=function(a,c){c=c||"";if(1===a.nodeType){if(this.gidless)for(var d=0;d<this.gidless.length;d++)if(a==this.gidless[d]||GLANCE.Lib.toElem(a).isDescendantOf(this.gidless[d])){this.removeGIDs(a);return}a.gid||(d=c?[c,GLANCE.Lib.nextGID].join("-"):GLANCE.Lib.nextGID,a.gid=d,a.setAttribute(GLANCE.Lib.Const.GID,d),"CANVAS"===a.tagName&&a.setAttribute(GLANCE.Lib.Const.GCID,d),GLANCE.Lib.toElem(a).hasNativeShadowRoot()&&a.setAttribute(GLANCE.Lib.Const.SDID,d),GLANCE.Lib.nextGID++);
d=GLANCE.Lib.GElement.nativeGetProperty("children",a);!d&&GLANCE.Lib.Browser.ie11&&(d=GLANCE.Lib.GElement.nativeGetProperty("childNodes",a));if(d)for(var e=0;e<d.length;e++)this._assignGIDs(d[e],c);if(GLANCE.Lib.toElem(a).hasNativeShadowRoot())for(d=GLANCE.Lib.getChildrenOrShadowChildren(a),e=0;e<d.length;e++)this._assignGIDs(d[e],a.gid)}};
GLANCE.Lib.DomDiff.prototype.assignGIDs=function(a,c){diffdetlog("assignGIDs next GID:",GLANCE.Lib.nextGID,"current GID:",a.getAttribute(GLANCE.Lib.Const.GID),this.getPath(a));this.gidless=0<this.nogids.length?GLANCE.Lib.GElement.nativeMethod(document,"querySelectorAll",this.nogids.join(",")):[];this._assignGIDs(a,c);delete this.gidless};GLANCE.Lib.DomDiff.prototype.log=function(a,c){};
GLANCE.Lib.DomDiff.prototype.getPath=function(a){var c=GLANCE.Lib.toElem(a).getPath();return null===c?null:a._idchanged&&!/^(head|body)$/i.test(a.tagName)?"["+GLANCE.Lib.Const.GID+'="'+a.getAttribute(GLANCE.Lib.Const.GID)+'"]':c};GLANCE.Lib.DomDiff.prototype.diff=function(a,c){this._diff(a,c);a=this.differences;this.differences=[];return a};
GLANCE.Lib.DomDiff.prototype.createDiffForDisabledChange=function(a,c){c=this.getPath(a);this.differences.push({diff:a.disabled?"SETATTR":"REMATTR",path:c,attr:"disabled",value:""});diffslog("ATTR diff: "+GLANCE.Lib.JSONStringify(this.differences[this.differences.length-1]));return this._returnMyDiffs()};
GLANCE.Lib.DomDiff.prototype.createDiffsForStyleChange=function(a,c,d){a.getAttribute("style")===c.getAttribute("style")||a.getAttribute("glance_cobrowse_suppress")||this._addAttrDiffFromMutation(a,"style");a=GLANCE.Lib.GElement.nativeGetProperty("children",a);c=GLANCE.Lib.GElement.nativeGetProperty("children",c);for(var e=0;a&&e<a.length;e++)if(e<c.length&&a[e].getAttribute(GLANCE.Lib.Const.GID)===c[e].getAttribute(GLANCE.Lib.Const.GID))this.createDiffsForStyleChange(a[e],c[e],!0);else for(var h=
0;h<c.length;h++)if(c[h].getAttribute(GLANCE.Lib.Const.GID)===a[e].getAttribute(GLANCE.Lib.Const.GID)){this.createDiffsForStyleChange(a[e],c[h],!0);break}if(void 0===d)return this._returnMyDiffs()};GLANCE.Lib.DomDiff.prototype._diff=function(a,c){this._diffElemAttrs(a,c);if(!this._diffChildList(a,c)&&!this._diffNodeList(a,c)){a=GLANCE.Lib.GElement.nativeGetProperty("children",a);var d=GLANCE.Lib.GElement.nativeGetProperty("children",c);for(c=0;void 0!==a&&c<a.length;c++)this._diff(a[c],d[c])}};
GLANCE.Lib.DomDiff.prototype.mergeDiffs=function(a,c){var d,e;for(d=0;d<a.length;d++){var h=!1;switch(a[d].diff){case "CONTENT":for(e=0;e<c.length;e++)if(c[e].path===a[d].path&&c[e].node===a[d].node){c[e].data=a[d].data;h=!0;break}break;case "ATTR":for(e=0;e<c.length;e++)if(c[e].path===a[d].path){c[e].data=a[d].data;h=!0;break}break;case "SETATTR":case "REMATTR":for(e=0;e<c.length;e++)if(("SETATTR"===c[e].diff||"REMATTR"===c[e].diff)&&c[e].path===a[d].path&&c[e].attr===a[d].attr){c[e]=a[d];h=!0;break}break;
case "REPLACE":for(e=0;e<c.length;e++)if(c[e].path===a[d].path&&"REPLACE"===c[e].diff){c[e].data=a[d].data;h=!0;break}}h||c.push(a[d])}};
GLANCE.Lib.DomDiff.prototype._diffElemAttrs=function(a,c){var d,e=a.attributes,h=c.attributes;a.id!==c.id&&(c._idchanged=!0);for(d=0;d<e.length;d++)e.item(d).nodeName!==GLANCE.Lib.Const.GID&&c.getAttribute(e.item(d).nodeName)!=e.item(d).nodeValue&&this._addAttrDiffFromMutation(c,e.item(d).nodeName);for(d=0;d<h.length;d++)h.item(d).nodeName===GLANCE.Lib.Const.GID||a.getAttribute(h.item(d).nodeName)||this._addAttrDiffFromMutation(c,h.item(d).nodeName)};
GLANCE.Lib.DomDiff.prototype._diffNodeList=function(a,c){var d=GLANCE.Lib.GElement.nativeGetProperty("children",a);var e=GLANCE.Lib.GElement.nativeGetProperty("children",c);if(d&&e&&0===d.length&&0===e.length)return a.textContent!==c.textContent&&this._addContentDiff(c),!0;e=GLANCE.Lib.GElement.nativeGetProperty("childNodes",a);let h=GLANCE.Lib.GElement.nativeGetProperty("childNodes",c);if(e.length!==h.length)return this._addHTMLDiff(c),!0;for(var k=0;k<e.length;k++)if(a=e[k],d=h[k],a.nodeType!==
d.nodeType||a.nodeValue!==d.nodeValue)return this._addHTMLDiff(c),!0};GLANCE.Lib.DomDiff.prototype._diffChildList=function(a,c){let d=GLANCE.Lib.GElement.nativeGetProperty("children",a),e=GLANCE.Lib.GElement.nativeGetProperty("children",c);if(void 0===d||void 0===e)return void 0===d!==(void 0===e);if(d.length!=e.length)return this._addHTMLDiff(c);for(a=0;a<d.length;a++)if(d[a].tagName!==e[a].tagName)return this._addHTMLDiff(c);return!1};
GLANCE.Lib.DomDiff.prototype._addAttrDiff=function(a){var c,d={};for(c=0;c<a.attributes.length;c++)this.attrfilter(a,a.attributes[c].name)&&(d[a.attributes[c].name]=a.attributes[c].value);diffslog("ATTR diff: "+this.getPath(a)+" "+GLANCE.Lib.JSONStringify(d),a);this.differences.push({diff:"ATTR",path:this.getPath(a),data:d})};
GLANCE.Lib.DomDiff.prototype.createMediaDiffs=function(){if(void 0!==window.matchMedia)for(var a=GLANCE.Lib.GElement.nativeMethod(document.head,"getElementsByTagName","link"),c=0;c<a.length;c++)this.differences.push({diff:"SETATTR",path:this.getPath(a[c]),attr:"media",value:""===a[c].media||window.matchMedia(a[c].media).matches?"all":"none"});return this._returnMyDiffs()};GLANCE.Lib.DomDiff.prototype.createHTMLAttrDiff=function(){this._addAttrDiff(document.documentElement);return this._returnMyDiffs()};
GLANCE.Lib.DomDiff.prototype._addAttrDiffFromMutation=function(a,c){var d=this.getPath(a);if(null===d)diffslog("Ignoring attr diff for ",c,"=",a.getAttribute(c)+" of elem ",a," not in DOM");else{var e=this.attrfilter(a,c);!1===e?diffslog("Ignoring attr diff for ",c,"=",a.getAttribute(c)+" of elem ",a," filtered out"):(this.differences.push({diff:e||""===e?"SETATTR":"REMATTR",path:d,attr:c,value:e}),diffslog("ATTR diff: "+d+" "+c+" "+e,a))}};
GLANCE.Lib.DomDiff.prototype.addContentDiff=function(a,c){var d=this.getPath(a);null!==d&&(this.differences.push({diff:"CONTENT",path:d,data:c}),diffslog("CONTENT diff: "+d,a))};GLANCE.Lib.DomDiff.prototype._addContentDiff=function(a){this.contentfilter(a)&&(diffslog("CONTENT diff: "+this.getPath(a)),this.addContentDiff(a,a.textContent))};
GLANCE.Lib.getChildNodesOrShadowChildNodes=function(a){return GLANCE.Lib.toElem(a).hasNativeShadowRoot()?GLANCE.Lib.GElement.nativeGetProperty("childNodes",GLANCE.Lib.GElement.nativeGetProperty("shadowRoot",a)):GLANCE.Lib.GElement.nativeGetProperty("childNodes",a)};
GLANCE.Lib.getChildrenOrShadowChildren=function(a){return GLANCE.Lib.toElem(a).hasNativeShadowRoot()?GLANCE.Lib.GElement.nativeGetProperty("children",GLANCE.Lib.GElement.nativeGetProperty("shadowRoot",a)):GLANCE.Lib.GElement.nativeGetProperty("children",a)};
GLANCE.Lib.DomDiff.prototype._addContentDiffFromMutation=function(a){var c,d=a.parentNode;for(c=0;c<GLANCE.Lib.GElement.nativeGetProperty("childNodes",d).length;c++)if(GLANCE.Lib.GElement.nativeGetProperty("childNodes",d)[c]===a){var e=c;break}void 0===e?GLANCE.Lib.log("Node not found in _addContentDiffFromMutation"):this.contentfilter(d)&&(ShadowRoot&&d instanceof ShadowRoot&&(d=d.host),this.differences.push({diff:"CONTENT",path:this.getPath(d),data:a.textContent,node:e}),diffslog("CONTENT diff: "+
this.getPath(d),a.textContent,e,"out of",GLANCE.Lib.GElement.nativeGetProperty("childNodes",d).length))};GLANCE.Lib.DomDiff.prototype._addHTMLDiff=function(a){diffslog("HTML diff: "+this.getPath(a));this.htmlfilter(a);this.differences.push({diff:"HTML",path:this.getPath(a),data:this.renderedhtmlfilter(a.innerHTML)});return!0};
GLANCE.Lib.DomDiff.prototype._getOuterHTML=function(a){var c=GLANCE.Lib.GElement.nativeGetProperty("outerHTML",a);c||(c=document.createElement("div"),c.appendChild(a),c=c.innerHTML);return this.renderedhtmlfilter(c)};GLANCE.Lib.DomDiff.prototype._getElemHtml=function(a){var c=GLANCE.Lib.toElem(a).deepClone();if(this.htmlfilter(a,c))return this._getOuterHTML(c);diffslog("Ignoring filtered element of type: "+a.tagName);return GLANCE.Lib.toElem(c).dummyOuterHTML()};
GLANCE.Lib.DomDiff.prototype._addChildOrderDiff=function(a){var c=this.getPath(a);if(c&&this.contentfilter(a)){diffslog("CHILDORDER diff: "+c,a);a=GLANCE.Lib.GElement.nativeGetProperty("childNodes",a);for(var d=[],e=0;e<a.length;e++)switch(a[e].nodeType){case 1:d.push({gid:a[e].getAttribute(GLANCE.Lib.Const.GID)});break;case 3:d.push({text:a[e].textContent});break;case 8:d.push({comment:a[e].data})}this.differences.push({diff:"CHILDORDER",path:c,data:d})}};
GLANCE.Lib.DomDiff.prototype._addReplaceNodeDiff=function(a){var c=this.getPath(a);if(c&&(1!==a.nodeType||!a.tagName.match(/textarea/i))){diffslog("REPLACE diff: "+c,"gid:",a.getAttribute(GLANCE.Lib.Const.GID),a);a.getAttribute(GLANCE.Lib.Const.GID)||diffslog("No gid for replace node diff on "+this.getPath(a));for(var d=GLANCE.Lib.GElement.nativeGetProperty("children",a),e=0;d&&e<d.length;e++)this.assignGIDs(d[e]);(a=this._getElemHtml(a))?(this.differences.push({diff:"REPLACE",path:c,data:a}),"html"!==
c||GLANCE.Lib.GElement.USE_CHILDORDER||this._addReplaceNodeDiff(document.head),diffdetlog(this.differences.length+" differences")):diffslog("Ingoring filtered replace diff for ",c)}};
GLANCE.Lib.DomDiff.prototype._addChildListDiff=function(a){var c=a.target,d=a._addedNodes,e=a._removedNodes,h=a.nextSibling;h&&1===h.nodeType&&(GLANCE.Lib.toElem(h).isDescendantOf(document.documentElement)&&GLANCE.Lib.GElement.nativeGetProperty("parentElement",h)===c?h.getAttribute(GLANCE.Lib.Const.GID)||diffslog("No data-gid for nextSibling. removedgid:",h.removedgid):(diffdetlog("nextSibling not in dom or in different parent, not sending:",h),h=null));diffdetlog("CHILDLIST diff for element: "+this.getPath(c),
c);var k=this.getPath(c);if(null!==k){var m={diff:"CHILDLIST",path:k,nsib:h&&d?this.getPath(h):null,added:[],removed:[]};if(d)for(k=0;k<d.length;k++)if(!(0<=a.ignoreAdded.indexOf(k))){var r=GLANCE.Lib.GElement.nativeGetProperty("parentNode",d[k]);if(r!==c)diffdetlog("==> Ignoring add element no longer in same parent. gid=",d[k].gid),r||(diffdetlog("==> Ignored add element no longer in dom, removing gid"),delete d[k].gid,1===d[k].nodeType&&d[k].removeAttribute(GLANCE.Lib.Const.GID));else{if(1===d[k].nodeType){this.assignGIDs(d[k]);
var t=this._getElemHtml(d[k]);if(!t){diffdetlog("==> Not adding filtered element:",d[k]);continue}diffdetlog("==> Added element node gid="+d[k].getAttribute(GLANCE.Lib.Const.GID)+" before "+m.nsib,d[k],"htmllength",t.length,"html:",t.substr(0,100))}else if(3===d[k].nodeType)t=this.contentfilter(c)?d[k].nodeValue:"",diffdetlog("==> added text node ","'"+t+"'");else if(8===d[k].nodeType)t=d[k].nodeValue,diffdetlog("==> added comment node ","'"+t+"'");else{diffdetlog("==> ignoring added node type ",
d[k].nodeType);continue}m.added.push({nodeType:d[k].nodeType,tagName:d[k].tagName,value:t})}}if(e)for(k=0;k<e.length;k++)if(!(0<=a.ignoreRemoved.indexOf(k))){switch(e[k].nodeType){case 1:diffdetlog("==> Removed node gid=",e[k].removedgid);t=e[k].removedgid;if(!t){diffdetlog("==> Ignoring remove Element with no gid");continue}break;case 3:diffdetlog("==> removed text node with value "+e[k].nodeValue);t=e[k].nodeValue;break;default:GLANCE.Lib.log("==> Ignoring remove node type "+e[k].nodeType)}m.removed.push({nodeType:e[k].nodeType,
value:t})}if(0===m.removed.length&&0===m.added.length)return!1;this.differences.push(m);h&&8===h.nodeType&&(diffdetlog("Found comment node as nextSibling, adding childorder diff",c),this._addChildOrderDiff(c));return!0}};
GLANCE.Lib.DomDiff.prototype._mergeMutations=function(a){function c(w){a.push({target:w,type:"replacedNode"})}function d(w){if(w instanceof HTMLHtmlElement)diffslog("No order fixing mutation needed for HTML element");else if(!w.getAttribute(GLANCE.Lib.Const.GID)||!GLANCE.Lib.GElement.USE_CHILDORDER&&GLANCE.Lib.toElem(w).hasGIDlessDescendants())c(w);else a:{for(var x=0;x<A.length;x++)if(A[x].target===w)break a;A.push({target:w,type:"childOrder"})}}function e(w){w=GLANCE.Lib.GElement.nativeGetProperty("childNodes",
w);for(var x=1;x<w.length;x++)if(w[x].nodeType===w[x-1].nodeType&&(3===w[x].nodeType||8===w[x].nodeType))return!0;return!1}function h(w){for(var x=0;x<a.length;x++)if(a[x]!==w&&"attributes"===w.type&&"attributes"===a[x].type&&w.target===a[x].target&&w.attributeName===a[x].attributeName)return w.target;return!1}function k(w){var x,n,u=GLANCE.Lib.toElem(w.target);for(x=0;x<a.length;x++)if(a[x]!==w&&"childList"===a[x].type)for(n=0;a[x]._addedNodes&&n<a[x]._addedNodes.length;n++)if(w.target===a[x]._addedNodes[n]||
u.isDescendantOf(a[x]._addedNodes[n]))return a[x]._addedNodes[n];return!1}function m(w){var x;for(x=0;x<a.length;x++)if(a[x]!==w&&"replacedNode"===a[x].type&&(w.target===a[x].target||GLANCE.Lib.toElem(w.target).isDescendantOf(a[x].target)))return a[x].target;return!1}var r=this,t=new GLANCE.Lib.Timer;t.set();var A=[];diffslog("Merging "+a.length+" mutations");if(500<a.length){GLANCE.Lib.log("Mutation overflow");t=!1;for(var q=0;q<a.length&&!t;q++)if(a[q].target===document.head||GLANCE.Lib.GElement.nativeGetProperty("parentElement",
a[q].target)===document.head)t=!0;a.length=0;t&&this._addReplaceNodeDiff(document.head);this._addReplaceNodeDiff(document.body)}else{a.forEach(function(w){"attributes"===w.type&&"id"===w.attributeName&&w.target.id&&(w.target._idchanged=!0);"childList"===w.type&&(w.ignoreAdded=[],w.ignoreRemoved=[])});for(q=0;q<a.length;q++){var y=k(a[q]),p=GLANCE.Lib.GElement.nativeGetProperty("parentElement",a[q].target);y?(diffdetlog("Ignoring redundant mutation "+a[q].type+" to target ",a[q].target.tagName," descendant of added node ",
y.tagName),a.splice(q,1),q--):"characterData"===a[q].type&&p&&e(p)&&(diffslog("Using child order diff instead of content diff for",this.getPath(a[q].target),"due to consecutive text elements in parent",this.getPath(p)),d(p),a.splice(q,1),q--)}a.forEach(function(w){if("childList"===w.type){var x;a:{for(x=0;x<a.length;x++)if(a[x].target===w.target&&"replacedNode"===a[x].type){x=!0;break a}x=!1}if(!x){if(0<w._addedNodes.length)for(x=0;x<a.length;x++)if("childList"===a[x].type&&a[x].target===w.target&&
0<a[x]._removedNodes.length){diffslog("Creating order-fixing mutation for "+r.getPath(w.target)+" due to adds and removes in child list");d(w.target);return}if(w.nextSibling&&3===w.nextSibling.nodeType)GLANCE.Lib.GElement.USE_CHILDORDER?(diffslog("Creating order fixing mutation for "+r.getPath(w.target)+" due to add before text node"),d(w.target)):(diffslog("Creating replaceNode mutation for "+r.getPath(w.target)+" due to add before text node"),c(w.target));else for(x=0;x<w._removedNodes.length;x++)if(3===
w._removedNodes[x].nodeType){diffslog("Creating replaceNode mutation for "+r.getPath(w.target)+" due to remove text node");c(w.target);break}}}});for(q=0;q<a.length;q++)GLANCE.Lib.toElem(a[q].target).isDescendantOf(document.documentElement)||(diffdetlog("Ignoring mutation type=",a[q].type," to target ",a[q].target," no longer in dom"),a.splice(q,1),q--);for(q=0;q<a.length;q++)if("childList"===a[q].type&&0!==a[q]._addedNodes.length)for(y=0;y<a[q]._addedNodes.length;y++){p=a[q]._addedNodes[y];for(var D=
!1,C=q+1;!D&&C<a.length;C++)if("childList"===a[C].type)for(var J=0;J<a[C]._removedNodes.length;J++)if(p===a[C]._removedNodes[J]){diffdetlog("Ignoring add and remove for same node: (",q,y,") and (",C,J,") node:",p.tagName);a[q].ignoreAdded.push(y);a[C].ignoreRemoved.push(J);D=!0;break}}Array.prototype.push.apply(a,A);for(q=0;q<a.length;q++)if(y=m(a[q]))diffdetlog("Ignoring redundant mutation "+a[q].type+" to target ",a[q].target.tagName,a[q].target.gid," descendant of replaced node ",y.tagName,y.gid),
a.splice(q,1),q--;for(q=0;q<a.length;q++)if(y=h(a[q]))diffdetlog("Ignoring redundant attribute mutation "+a[q].attributeName+" to target "+this.getPath(y)),a.splice(q,1),q--;diffslog("Merged mutations to:"+a.length+" in "+t.elapsed()+" ms")}};
GLANCE.Lib.DomDiff.prototype._addDiffsFromMutationObserver=function(a){var c=this;a.forEach(function(d){if("childList"===d.type)for(var e=0;e<d._removedNodes.length;e++)1===d._removedNodes[e].nodeType&&(d._removedNodes[e].gid&&delete d._removedNodes[e].removedgid,d._removedNodes[e].gid&&(d._removedNodes[e].removedgid=d._removedNodes[e].gid,delete d._removedNodes[e].gid,d._removedNodes[e].removeAttribute(GLANCE.Lib.Const.GID)))});this._mergeMutations(a);a.forEach(function(d){switch(d.type){case "attributes":c._addAttrDiffFromMutation(d.target,
d.attributeName);break;case "characterData":c._addContentDiffFromMutation(d.target);break;case "childList":c._addChildListDiff(d);break;case "replacedNode":c._addReplaceNodeDiff(d.target);break;case "childOrder":c._addChildOrderDiff(d.target);break;default:GLANCE.Lib.log("Unrecognized mutation record type "+d.type)}})};GLANCE.Lib.DomDiff.prototype.setHtmlFilter=function(a){this.htmlfilter=a};GLANCE.Lib.DomDiff.prototype.setRenderedHtmlFilter=function(a){this.renderedhtmlfilter=a};
GLANCE.Lib.DomDiff.prototype.setAttrFilter=function(a){this.attrfilter=a};GLANCE.Lib.DomDiff.prototype.setContentFilter=function(a){this.contentfilter=a};GLANCE.Lib.DomDiff.prototype.diffsFromMutations=function(a){if(0!==a.length)return-1!==a[0].toString().indexOf("MutationRecord")&&this._addDiffsFromMutationObserver(a),diffslog("Got "+this.differences.length+" differences"),this._returnMyDiffs()};GLANCE.Lib.DomDiff.prototype._returnMyDiffs=function(){var a=this.differences;this.differences=[];return a};
GLANCE.Lib.DomDiffApplier=function(){};GLANCE.Lib.DomDiffApplier.prototype._applyAttrDiff=function(a,c){var d=a.data,e=[];for(a=0;a<c.attributes.length;a++)e.push(c.attributes[a].name);for(a=0;a<e.length;a++)void 0===d[e[a]]&&(diffslog("   -"+e[a]),c.removeAttribute(e[a]));for(var h in d)d.hasOwnProperty(h)&&(diffslog("   +"+h+"="+d[h]),c.setAttribute(h,d[h]))};
GLANCE.Lib.DomDiffApplier.prototype._hashHrefsToAbsolute=function(a){a=(a.parentElement||document.body).querySelectorAll("svg [*|href^='#']");for(var c=window.location.href.replace(/#.*/,""),d=0;d<a.length;d++){var e=a[d].attributes.getNamedItem("href")||a[d].attributes.getNamedItem("xlink:href");if(e){var h=e.value;diffslog("Page-relative href to absolute. Element:",a[d],"namespace:",e.namespaceURI,"href:",c+h);a[d].attributes.removeNamedItem(e.name);a[d].setAttributeNS(e.namespaceURI||"http://www.w3.org/1999/xlink",
"href",c+h)}else GLANCE.Lib.log("ERR_HREFNOTFOUND")}};GLANCE.Lib.DomDiffApplier.prototype._removeObjectUrlImages=function(a){if(!GLANCE.Lib.Browser.ie){a=(a.parentElement||document.body).querySelectorAll("svg image[*|href^='blob']");for(var c=0;c<a.length;c++){var d=a[c];d.href&&d.href.baseVal&&(d.href.baseVal="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAIAAAD38zoCAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAQSURBVBhXYziMA9Be4vBhAFKrW2mB3kkXAAAAAElFTkSuQmCC")}}};
GLANCE.Lib.DomDiffApplier.prototype.processAddedElem=function(a){this._hashHrefsToAbsolute(a);null!==document.getElementById("glance-pdf")&&this._removeObjectUrlImages(a)};
GLANCE.Lib.DomDiffApplier.prototype._processAddedHeadElem=function(a){var c=GLANCE.Lib.GElement.nativeGetProperty("childNodes",document.head);for(let d=0;d<c.length;)document.head.removeChild(c[d]);c=document.implementation.createHTMLDocument("");c.head.outerHTML=a;a=document.head.getElementsByTagName("BASE");for(a=(a=a.length?a[0]:null)?a.nextSibling:null;0<c.head.childNodes.length;)document.head.insertBefore(c.head.firstChild,a)};
GLANCE.Lib.DomDiffApplier.prototype._setOuterHTML=function(a,c){c=c.replace(/<script\s/gi,"<template ").replace(/<script>/gi,"<template>").replace(/\/script>/gi,"/template>");c=c.replace(/http-equiv\s*=\s*['"]?refresh['"]?/gi,"");try{a.outerHTML=c}catch(d){GLANCE.Lib.errlog("Exception setting outer HTML:"+d.toString()+" for element:"+a.toString()+" to "+c.substr(0,200))}};
GLANCE.Lib.DomDiffApplier.prototype._applyChildOrderDiff=function(a,c,d){var e=GLANCE.Lib.GElement.nativeGetProperty("childNodes",c),h;if(/^(head|body)$/i.test(c.tagName))for(h=0;h<e.length;)1!==e[h].nodeType||e[h].getAttribute(GLANCE.Lib.Const.GID)||"BASE"===e[h].tagName||"glance_open_sel"===e[h].id?h++:(diffslog("ChildOrder: Removing gidless "+e[h].tagName+" id:"+e[h].id+" index:"+h+" in "+a),c.removeChild(e[h]));for(a=h=0;h<d.length;h++,a++)if(diffslog("ChildOrder: Entry "+h+"="+JSON.stringify(d[h])),
d[h])if(a>=e.length)diffslog("ChildOrder: Append empty text node"),c.appendChild(document.createTextNode(""));else if(1!==e[a].nodeType||e[a].getAttribute(GLANCE.Lib.Const.GID))if(void 0!==d[h].text)3!==e[a].nodeType?(diffslog("ChildOrder: Inserting text node "+JSON.stringify(d[h].text)+" at "+a),c.insertBefore(document.createTextNode(d[h].text),e[a])):e[a].textContent!==d[h].text?(diffslog("ChildOrder: Fixing up text "+JSON.stringify(d[h].text)+" in node "+a),e[a].textContent=d[h].text):diffslog("ChildOrder: Text "+
JSON.stringify(e[a].textContent)+" correct in node "+a);else if(void 0!==d[h].comment)8!==e[a].nodeType&&(diffslog("ChildOrder: Adding comment node at "+a),c.insertBefore(document.createComment(d[h].comment),e[a]));else if(1===e[a].nodeType&&e[a].getAttribute(GLANCE.Lib.Const.GID)===d[h].gid)diffslog("ChildOrder: Found "+d[h].gid+" in correct location at "+a);else{diffslog("ChildOrder: Moving "+d[h].gid+" to correct location at "+a);var k=c.querySelector("[data-gid='"+d[h].gid+"']");k?c.insertBefore(k,
e[a]):(diffslog("ChildOrder: Element missing gid:"+d[h].gid),a--)}else"BASE"!==e[a].tagName&&errorlog("ERR_MISSING_GID",c.tagName,c.id,c.className),h--;for(;a<e.length;)3===e[a].nodeType?c.removeChild(e[a]):a++};
GLANCE.Lib.DomDiffApplier.prototype.applyDiffs=function(a){var c,d=GLANCE.Lib.toElem(document.documentElement),e={};if(!a)return e;diffslog("=== Applying Diffs ===");for(c=0;c<a.length;c++){var h=d.getUniqueElement(a[c].path,!1);if(null===h)GLANCE.Lib.log("Element not found applying diff: "+a[c].diff+" to "+a[c].path);else switch(diffslog("Applying diff "+a[c].diff+" to "+h.tagName+" "+a[c].path),a[c].diff){case "ATTR":this._applyAttrDiff(a[c],h);break;case "SETATTR":diffslog("SETATTR attr on: "+
a[c].path+" attr:"+a[c].attr+" value:"+a[c].value);GLANCE.Lib.Browser.firefox&&"disabled"===a[c].attr&&h.tagName.match(/link/i)&&(h.disabled=!0);"style"===a[c].attr&&window.PrefixFree&&(a[c].value+=";"+PrefixFree.prefixCSS(a[c].value.replace(/-webkit-/,"")));"class"===a[c].attr?h.setAttribute("class",a[c].value):h.setAttribute(a[c].attr,a[c].value);"CANVAS"===h.tagName&&(e.canvas=!0);break;case "REMATTR":diffslog("REMATTR attr on: "+a[c].path+" attr:"+a[c].attr);GLANCE.Lib.Browser.firefox&&"disabled"===
a[c].attr&&h.tagName.match(/link/i)&&(h.disabled=!1);"class"===a[c].attr?h.setAttribute("class",""):h.removeAttribute(a[c].attr);break;case "CONTENT":0===a[c].node&&0===GLANCE.Lib.GElement.nativeGetProperty("childNodes",h).length&&(a[c].node=void 0);if(void 0!==a[c].node&&a[c].node>=GLANCE.Lib.GElement.nativeGetProperty("childNodes",h).length){GLANCE.Lib.log("Child node out of range applying CONTENT diff to "+a[c].path);break}void 0!==a[c].node?GLANCE.Lib.GElement.nativeGetProperty("childNodes",h)[a[c].node].textContent=
a[c].data:h.textContent=a[c].data;break;case "REPLACE":diffslog("REPLACE "+a[c].path+" with "+a[c].data.substr(0,100));if(h instanceof HTMLHtmlElement){var k=(new DOMParser).parseFromString(a[c].data,"text/html");h.querySelector("body").innerHTML=k.querySelector("body").innerHTML}else this._setOuterHTML(h,a[c].data);this.processAddedElem(h);/^(head|body|canvas)$/i.test(h.tagName)&&(e[h.tagName.toLowerCase()]=!0);0<h.getElementsByTagName("canvas").length&&(e.canvas=!0);/^head$/i.test(h.tagName)&&(k=
document.getElementsByTagName("body"),1<k.length&&0==GLANCE.Lib.GElement.nativeGetProperty("children",k[0]).length&&document.documentElement.removeChild(k[0]));/^body$/i.test(h.tagName)&&(k=document.getElementsByTagName("head"),1<k.length&&0==GLANCE.Lib.GElement.nativeGetProperty("children",k[1]).length&&document.documentElement.removeChild(k[1]));diffdetlog("==> replaced element with gid:",h.getAttribute(GLANCE.Lib.Const.GID));break;case "CHILDLIST":var m=a[c].nsib?GLANCE.Lib.toElem(h).getUniqueElement(a[c].nsib,
!1):null;for(k=0;k<a[c].added.length;k++)switch(diffslog("Adding node type: "+a[c].added[k].nodeType+" to "+GLANCE.Lib.toElem(h).getPath()),a[c].added[k].nodeType){case 1:if("HEAD"===a[c].added[k].tagName){diffdetlog("Added HEAD element");e.head=!0;this._processAddedHeadElem(a[c].added[k].value);break}var r=document.createElement("x");h.insertBefore(r,m);this._setOuterHTML(r,a[c].added[k].value);this.processAddedElem(r);diffdetlog("Added node gid:",r.getAttribute(GLANCE.Lib.Const.GID));break;case 3:r=
document.createTextNode(a[c].added[k].value);h.insertBefore(r,m);break;case 8:r=document.createComment(a[c].added[k].value);h.insertBefore(r,m);break;default:GLANCE.Lib.errlog("Unexpected node type "+a[c].added[k].nodeType+" added in applyDiffs")}for(k=0;k<a[c].removed.length;k++)switch(diffslog("Removing node type: "+a[c].removed[k].nodeType+" value "+a[c].removed[k].value),a[c].removed[k].nodeType){case 1:m=GLANCE.Lib.toElem(h).getElements("["+GLANCE.Lib.Const.GID+'="'+a[c].removed[k].value+'"]');
if(0===m.length||GLANCE.Lib.GElement.nativeGetProperty("parentElement",m[0])!==h&&m[0].parentNode!==h){diffslog("Ignoring removed Element gid "+a[c].removed[k].value+" not in parent");break}h.removeChild(m[0]);break;case 3:for(m=0;m<h.childNodes.length;m++)if(3===h.childNodes[m].nodeType&&h.childNodes[m].nodeValue===a[c].removed[k].value){h.removeChild(h.childNodes[m]);break}}break;case "CHILDORDER":/^(head|body)$/i.test(h.tagName)&&(e[h.tagName.toLowerCase()]=!0);this._applyChildOrderDiff(a[c].path,
h,a[c].data);break;case "HTML":h.innerHTML=a[c].data,this.processAddedElem(h)}}return e};function InitPrefixFree(){(function(){if(window.addEventListener)var a=window.StyleFix={link:function(c){var d=c.href||c.getAttribute("data-href");try{if(!d||"stylesheet"!==c.rel||c.hasAttribute("data-noprefix"))return}catch(q){return}var e=d.replace(/[^\/]+$/,""),h=(/^[a-z]{3,10}:/.exec(e)||[""])[0],k=(/^[a-z]{3,10}:\/\/[^\/]+/.exec(e)||[""])[0],m=/^([^?]*)\??/.exec(d)[1],r=c.parentNode,t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&A()};var A=function(){var q=t.responseText;
if(q&&c.parentNode&&(!t.status||400>t.status||600<t.status)){if((q=a.fix(q,!0,c))&&e){q=q.replace(/url\(\s*?((?:"|')?)(.+?)\1\s*?\)/gi,function(p,D,C){return/^([a-z]{3,10}:|#)/i.test(C)?p:/^\/\//.test(C)?'url("'+h+C+'")':/^\//.test(C)?'url("'+k+C+'")':/^\?/.test(C)?'url("'+m+C+'")':'url("'+e+C+'")'});var y=e.replace(/([\\\^\$*+[\]?{}.=!:(|)])/g,"\\$1");q=q.replace(RegExp("\\b(behavior:\\s*?url\\('?\"?)"+y,"gi"),"$1")}y=document.createElement("style");y.textContent="/*# sourceURL="+c.getAttribute("href")+
" */\n/*@ sourceURL="+c.getAttribute("href")+" */\n"+q;y.media=c.media;y.disabled=c.disabled;y.setAttribute("data-href",c.getAttribute("href"));c.id&&(y.id=c.id);r.insertBefore(y,c);r.removeChild(c);y.media=c.media}};try{t.open("GET",d),t.send(null)}catch(q){"undefined"!=typeof XDomainRequest&&(t=new XDomainRequest,t.onerror=t.onprogress=function(){},t.onload=A,t.open("GET",d),t.send(null))}c.setAttribute("data-inprogress","")},styleElement:function(c){if(!c.hasAttribute("data-noprefix")){var d=c.disabled;
c.textContent=a.fix(c.textContent,!0,c);c.disabled=d}},styleAttribute:function(c){var d=c.getAttribute("style");d=a.fix(d,!1,c);c.setAttribute("style",d)},process:function(){[].slice.call(document.querySelectorAll("style")).forEach(StyleFix.styleElement);[].slice.call(document.querySelectorAll("[style]")).forEach(StyleFix.styleAttribute)},register:function(c,d){(a.fixers=a.fixers||[]).splice(void 0===d?a.fixers.length:d,0,c)},fix:function(c,d,e){if(a.fixers)for(var h=0;h<a.fixers.length;h++)c=a.fixers[h](c,
d,e)||c;return c},camelCase:function(c){return c.replace(/-([a-z])/g,function(d,e){return e.toUpperCase()}).replace("-","")},deCamelCase:function(c){return c.replace(/[A-Z]/g,function(d){return"-"+d.toLowerCase()})}}})();(function(a){function c(e,h,k,m,r){e=d[e];e.length&&(e=RegExp(h+"("+e.join("|")+")"+k,"gi"),r=r.replace(e,m));return r}if(window.StyleFix&&window.getComputedStyle){var d=window.PrefixFree={prefixCSS:function(e,h,k){var m=d.prefix;-1<d.functions.indexOf("linear-gradient")&&(e=e.replace(/(\s|:|,)(repeating-)?linear-gradient\(\s*(-?\d*\.?\d*)deg/ig,
function(t,A,q,y){return A+(q||"")+"linear-gradient("+(90-y)+"deg"}));e=c("functions","(\\s|:|,)","\\s*\\(","$1"+m+"$2(",e);e=c("keywords","(\\s|:)","(\\s|;|\\}|$)","$1"+m+"$2$3",e);e=c("properties","(^|\\{|\\s|;)","\\s*:","$1"+m+"$2:",e);if(d.properties.length){var r=RegExp("\\b("+d.properties.join("|")+")(?!:)","gi");e=c("valueProperties","\\b",":(.+?);",function(t){return t.replace(r,m+"$1")},e)}h&&(e=c("selectors","","\\b",d.prefixSelector,e),e=c("atrules","@","\\b","@"+m+"$1",e));e=e.replace(RegExp("-"+
m,"g"),"-");return e=e.replace(/-\*-(?=[a-z]+)/gi,d.prefix)},property:function(e){return(0<=d.properties.indexOf(e)?d.prefix:"")+e},value:function(e,h){e=c("functions","(^|\\s|,)","\\s*\\(","$1"+d.prefix+"$2(",e);e=c("keywords","(^|\\s)","(\\s|$)","$1"+d.prefix+"$2$3",e);0<=d.valueProperties.indexOf(h)&&(e=c("properties","(^|\\s|,)","($|\\s|,)","$1"+d.prefix+"$2$3",e));return e},prefixSelector:function(e){return d.selectorMap[e]||e},prefixProperty:function(e,h){e=d.prefix+e;return h?StyleFix.camelCase(e):
e}};(function(){var e={},h=[],k=getComputedStyle(document.documentElement,null),m=document.createElement("div").style,r=function(p){if("-"===p.charAt(0)){h.push(p);p=p.split("-");var D=p[1];for(e[D]=++e[D]||1;3<p.length;)p.pop(),D=p.join("-"),StyleFix.camelCase(D)in m&&-1===h.indexOf(D)&&h.push(D)}};if(k&&0<k.length)for(var t=0;t<k.length;t++)r(k[t]);else for(var A in k)r(StyleFix.deCamelCase(A));t=0;var q;for(q in e)if(k=e[q],t<k){var y=q;t=k}d.prefix="-"+y+"-";d.Prefix=StyleFix.camelCase(d.prefix);
d.properties=[];for(t=0;t<h.length;t++)A=h[t],0===A.indexOf(d.prefix)&&(y=A.slice(d.prefix.length),StyleFix.camelCase(y)in m||d.properties.push(y));!("Ms"!=d.Prefix||"transform"in m||"MsTransform"in m)&&"msTransform"in m&&d.properties.push("transform","transform-origin");d.properties.sort()})();(function(){function e(y,p){m[p]="";m[p]=y;return!!m[p]}var h={"linear-gradient":{property:"backgroundImage",params:"red, teal"},calc:{property:"width",params:"1px + 5%"},element:{property:"backgroundImage",
params:"#foo"},"cross-fade":{property:"backgroundImage",params:"url(a.png), url(b.png), 50%"}};h["repeating-linear-gradient"]=h["repeating-radial-gradient"]=h["radial-gradient"]=h["linear-gradient"];var k={initial:"color",grab:"cursor",grabbing:"cursor","zoom-in":"cursor","zoom-out":"cursor",box:"display",flexbox:"display","inline-flexbox":"display",flex:"display","inline-flex":"display",grid:"display","inline-grid":"display","max-content":"width","min-content":"width","fit-content":"width","fill-available":"width",
"contain-floats":"width"};d.functions=[];d.keywords=[];var m=document.createElement("div").style,r;for(r in h){var t=h[r],A=t.property;t=r+"("+t.params+")";!e(t,A)&&e(d.prefix+t,A)&&d.functions.push(r)}for(var q in k)A=k[q],!e(q,A)&&e(d.prefix+q,A)&&d.keywords.push(q)})();(function(){function e(y){m.textContent=y+"{}";return!!m.sheet.cssRules.length}var h={":any-link":null,"::backdrop":null,":fullscreen":null,":full-screen":":fullscreen","::placeholder":null,":placeholder":"::placeholder","::input-placeholder":"::placeholder",
":input-placeholder":"::placeholder",":read-only":null,":read-write":null,"::selection":null},k={keyframes:"name",viewport:null,document:'regexp(".")'};d.selectors=[];d.selectorMap={};d.atrules=[];var m=a.appendChild(document.createElement("style")),r;for(r in h){var t=h[r]||r,A=r.replace(/::?/,function(y){return y+d.prefix});!e(t)&&e(A)&&(d.selectors.push(t),d.selectorMap[t]=A)}for(var q in k)h=q+" "+(k[q]||""),!e("@"+h)&&e("@"+d.prefix+h)&&d.atrules.push(q);a.removeChild(m)})();d.valueProperties=
["transition","transition-property","will-change"];a.className+=" "+d.prefix;StyleFix.register(d.prefixCSS)}})(document.documentElement)};var SSN_COOKIE_NAME="glance_ssn_info";GLANCE.MINIMIZED=!0;var GLANCEVERSION3=GLANCE.VERSION.split(".").slice(0,3).join("."),GLANCESCRIPTVERSION=GLANCEVERSION3+""+(GLANCE.MINIMIZED?"M":"");
function CBScriptTag(){this.scripttag=document.getElementById("cobrowsescript")||document.getElementById("glance-cobrowse");this.metatag=document.getElementById("glance-cobrowse");if(null!==this.scripttag){var a=_GLANCE.Config.getCobrowseConfigData();_GLANCE.Config.Params.copy(a,this);var c=RegExp("//(.*)/").exec("string"===typeof this.scripttag.src?this.scripttag.src:a.scriptserver+"/");this.scriptServer=c&&2===c.length?c[1]:"www.glancecdn.net/cobrowse";this.scriptServer=this.scriptServer.replace("/js",
"");this.videoScriptServer=this.scriptServer.replace("cobrowse","video");a.cbexperiment&&(this.scriptServer=this.scriptServer.replace("cobrowse","cbexperiment"),this.videoScriptServer=this.videoScriptServer.replace("video","videoexperiment"));c=(a.oninit||"").split(":");this.groupid=a.groupid||this.scripttag.getAttribute("groupid");this.webServerHost=a.ws||this.scripttag.getAttribute("ws")||"www.glance.net";this.webServer=this.webServerHost+"/cobrowse";this.dev=!this.webServerHost.match("\\.glance\\.net$");
this.cookiedomain=a.cookiedomain;this.ui=a.ui;this.cookietype=a.cookietype;this.hostkey=a.hostkey;this.uri=a.uri;this.oninit={command:c[0],param:c[1]};this.site=a.site||this.scripttag.getAttribute("site")||"production";this.inputEvents=JSON.parse(a.inputevents||"{}");this.presence=a.presence;if(!this.groupid)throw Error("data-groupid missing");a=a.additionalgroupids||"";this.groupids=[this.groupid].concat(a?a.split(","):[]);this.groupids=this.groupids.map(function(d){if(!parseInt(d))throw Error("data-groupid invalid: "+
d);return parseInt(d)});if(!/staging|production/i.test(this.site))throw Error("data-site invalid");}}CBScriptTag.prototype.nativeInstance=function(a,...c){if(!this.cleanContextWindow){let d=document.createElement("iframe");d.style.display="none";d.setAttribute("data-no-cobrowse-content",1);document.body.appendChild(d);this.cleanContextWindow=d.contentWindow}a=this.cleanContextWindow[a];return new (Function.bind.apply(a,[a,...c]))};CBScriptTag.prototype.ready=function(){return null!==this.scripttag};
CBScriptTag.prototype.makeUrl=function(a){return URL.toString().includes("[native code]")?(new URL(`https://${this.scriptServer}/${a}`)).href:this.nativeInstance("URL",`https://${this.scriptServer}/${a}`).href};CBScriptTag.prototype.makeWebServiceUrl=function(a){return URL.toString().includes("[native code]")?(new URL(`https://${this.webServerHost}/${a}`)).href:this.nativeInstance("URL",`https://${this.webServerHost}/${a}`).href};
CBScriptTag.prototype.includesGroupId=function(a){a=parseInt(a);return this.groupid===a||0<=this.groupids.indexOf(a)};CBScriptTag.prototype.setCustomizationVersion=function(a){this.custver||(this.custver=a)};
CBScriptTag.prototype.coalesceSessionStartParams=function(a,c){function d(h,k,m){m.forEach(r=>{h[r]=k[r]||h[r]})}var e={};d(e,a,["video","content"]);d(e,this,["name","email","phone","video","content"]);e.sessionKey=e.sessionKey||this.visitorid||"GLANCE_KEYTYPE_RANDOM";"off"!==e.video&&!1===a.nwayvideoallowed&&(console.error("ERR_NO_NWAYVIDEO_SETTINGS"),e.video="off");Object.assign(e,c||{});return e};
CBScriptTag.prototype.addGlanceVideo=async function(){let a=c=>new Promise(d=>{if(document.querySelector(`script[src*=${c}]`))d();else{let e=document.createElement("script");e.addEventListener("load",d);e.setAttribute("type","text/javascript");e.setAttribute("src",`//${this.videoScriptServer}/source/js/${c}_${GLANCESCRIPTVERSION}.js`);document.head.appendChild(e)}});await a("browserCap");return a("GlanceVideoSource")};
CBScriptTag.prototype.addStylesheets=function(a){function c(h,k,m){if(!document.getElementById(h)){uilog("adding stylesheet",h);var r=document.createElement("link"),t=document.getElementsByTagName("head")[0];r.id=h;r.type="text/css";r.rel="stylesheet";r.media="all";r.href=k;m=m||t.firstElementChild;t.insertBefore(r,m)}}function d(h){return new Promise((k,m)=>{let r=document.getElementById(h);"1"===r.getAttribute("data-loaded")?(uilog(`stylesheet ${h} already loaded`),k()):(r.addEventListener("load",
()=>{r.setAttribute("data-loaded","1");uilog(`stylesheet ${h} loaded`);k()},{once:!0}),r.addEventListener("error",k,{once:!0}))})}this.currentGroupId||c("glance_ss",this.makeUrl("styles/Cobrowse_"+GLANCEVERSION3+".css"));if(this.currentGroupId!==a){this.currentGroupId=a;var e=document.getElementById("glance_customss");e&&e.parentElement.removeChild(e);c("glance_customss",this.makeUrl("customstyles/CustomSkin_"+a+"_"+this.site.substr(0,1).toUpperCase()+".css?gv=4&v="+this.custver),document.getElementById("glance_ss").nextElementSibling)}return Promise.all([d("glance_ss"),
d("glance_customss")]).then(()=>{uilog("all stylesheets loaded")})};function CookieUtils(){}CookieUtils.makeCookie=function(a){var c=SSN_COOKIE_NAME;switch(a.cookietype){case "ls":var d=GLANCE.Lib.lsCookie;break;case "dual":d=GLANCE.Lib.DualCookie;break;default:d=GLANCE.Lib.Cookie}return new d(c,a.cookiedomain)};CookieUtils.dropCookie=function(a,c){CookieUtils.makeCookie(a).setObj(c,"secure"===a.cookietype)};
var fixButtons=function(a){if(0>=Math.floor(a.scrollLeft)){var c="left";document.getElementById("glance_scroll-left").disabled=!0;document.getElementById("glance_scroll-right").disabled=!1}else 7>a.scrollWidth-a.scrollLeft-a.offsetWidth?(c="right",document.getElementById("glance_scroll-right").disabled=!0):(c="both",document.getElementById("glance_scroll-right").disabled=!1),document.getElementById("glance_scroll-left").disabled=!1;a.setAttribute("data-smallvideoscroll",c)};
class CobrowseVideoUtils{static getViewerId(a,c){return"original"!==(c||"original")?`glance_video_${a}`:"glance_agentvideo"}static validFile(a){return["application/pdf","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(a.type)||a.name.match(".csv")}static validSize(a){return 5>a.size/1048576}static scrollVideoStrip(a){var c=document.querySelector("#glance_video_containers");if(c)return c.scrollLeft=a?c.scrollLeft+191:c.scrollLeft-191,fixButtons(c),
c.scrollLeft}static setVideoScrollOffset(a){var c=document.querySelector("#glance_video_containers");if(c)return c.scrollLeft=a,fixButtons(c),c.scrollLeft}};function ShadowDOMViewer(a,c){this.shadowDomHTML={};this.shadowDomStyleSheets={};this.elemstate=a;this.adoptedStylesheetInfo={};this.overlay=c}ShadowDOMViewer.prototype.findShadowDomElement=function(a,c){a="["+GLANCE.Lib.Const.GID+"='"+a+"']";return GLANCE.Lib.toElem(document.documentElement).getUniqueElement(a,!1)};
ShadowDOMViewer.prototype.handleAdoptedStyles=function(a){if(a){a=GLANCE.Lib.decompressObj(a);var c=!1;for(const [d,e]of Object.entries(a))sdlog(`Received adopted stylesheet length: ${e.sheet.length} styleid: ${e.styleid}`),a=new CSSStyleSheet,a.replaceSync(e.sheet+" * {transition-duration: 0s !important; animation-duration:0s !important;}"),e.sheet=a,this.adoptedStylesheetInfo[d]=e,"#document"===e.tagname&&(c=!0,this.shadowDomStyleSheets["#document"]||(this.shadowDomStyleSheets["#document"]=[]),
this.shadowDomStyleSheets["#document"].push(a));c&&this.updateDocumentAdoptedStyles()}};ShadowDOMViewer.prototype.updateDocumentAdoptedStyles=function(){let a=this.shadowDomStyleSheets["#document"];document.adoptedStyleSheets.length!==a.length&&(console.log("updating doc sheets:",a),document.adoptedStyleSheets=a)};
ShadowDOMViewer.prototype.renderShadowDomElements=function(a){a&&(sdlog("Rendering shadow dom elements"),Object.keys(a).forEach(c=>{var d=GLANCE.Lib.decompressObj(a[c]),e="",h=[];if("object"===typeof d){e=d.html;if(d.styles)try{h=d.styles.map(function(k){var m=new CSSStyleSheet;m.replaceSync(k+" * {animation:none !important}");return m})}catch(k){GLANCE.Lib.log("Browser does not yet support Constructed Stylesheets. Not applying adopted styles")}d.styleids&&(h=d.styleids.map(k=>{let m=this.adoptedStylesheetInfo[k];
return m?m.sheet:(GLANCE.Lib.errlog("ERR_ADOPTEDSSMISSING:"+k),new CSSStyleSheet)}))}else e=d;this.shadowDomHTML[c]=e;this.shadowDomStyleSheets[c]=h;"#document"===c?document.adoptedStyleSheets=h:(sdlog("Rendering data-sdid:",c,"with stylesheets",d.styleids),(d=this.findShadowDomElement(c))?this.restoreShadowDomElement(d):GLANCE.Lib.log("Can't find shadow dom element "+c))}))};
ShadowDOMViewer.prototype.restoreState=function(a){var c=this;a.shadowRoot&&(a.shadowRoot.querySelectorAll("input,select,textarea").forEach(d=>{d=GLANCE.Lib.toElem(d);d.matchesAny([".glance_masked",".glance_masked *"])&&(d.element.disabled=!0);var e=this.elemstate.inputValues[d.getPath()];e&&d.setInputValue(e)}),Object.keys(this.elemstate.scrollState).forEach(d=>{var e=GLANCE.Lib.toElem(document.documentElement).getUniqueElement(d,!1);e&&(e.scrollTop=c.elemstate.scrollState[d].y,e.scrollLeft=c.elemstate.scrollState[d].x)}))};
ShadowDOMViewer.prototype.restoreShadowDomElement=function(a){var c=a.getAttribute(GLANCE.Lib.Const.SDID);sdlog("Restoring html for element sdid",c);if(this.shadowDomHTML[c])if(this.shadowDomStyleSheets[c]){var d=(d=document.querySelector("link.cbheadelem[href*='AgentCSS']"))?d.outerHTML:"";var e=a.shadowRoot||a.attachShadow({mode:"open"});e.innerHTML=d+this.shadowDomHTML[c];e.adoptedStyleSheets=this.shadowDomStyleSheets[c];e.querySelectorAll("["+GLANCE.Lib.Const.SDID+"]").forEach(h=>this.restoreShadowDomElement(h));
e.addEventListener("scroll",h=>{this.overlay.onElemScroll(h)},!0);this.restoreState(a)}else sdlog("No saved stylesheets yet to restore shadow dom element",c);else sdlog("No saved html yet to restore shadow dom element",c)};class AgentVideoPreview{constructor(a,c,d){this.GLANCE_SESSIONINFO=a;this.agent=c;this.visitorVideoRunning=!1;this.session=d}setPreviewElement(a,c){this.videoPreviewElementId!==a&&(this.visitorVideoRunning=c,this.videoPreviewElementId=a,c&&this.previewAgentVideoAtElement(document.getElementById(a)))}setupIframeForPreview(a,c,d){d=d||0;5<d&&vidlog(`Aborting setupIframeForPreview after ${d} retries`);a.contentDocument&&a.contentDocument.getElementById("glance_video_preview")?(vidlog("glance_video_preview already available"),
c(a.contentDocument.getElementById("glance_video_preview"))):(a.addEventListener("load",()=>{vidlog("Agent video preview iframe loaded");a.contentDocument?c(a.contentDocument.getElementById("glance_video_preview")):errlog("Video preview iframe contentDocument not available")},{once:!0}),a.srcdoc?vidlog("Agent video preview iframe srcdoc set, wait for load"):(a.setAttribute("allow","camera"),a.removeAttribute("sandbox"),a.removeAttribute("src"),a.setAttribute("data-agentpreviewrunning","true"),d=`${this.session.getScriptPath()}/AgentVideoPreview_${GLANCEVERSION3}.js`,
a.srcdoc=`<html style="height:100%"><script src="${d}"></script><body style="margin:0; height:100%; overflow:hidden;"><video id="glance_video_preview" style="transform: rotateY(180deg);position:relative; width:100%; height:100%; object-fit:cover;" muted></video></body></html>`,this.session.preserveElement(a,(e,h)=>{vidlog("A new agent video iframe is ready for preview, restarting preview");this.setupIframeForPreview(h,k=>{this.previewAgentVideoAtElement(k)})})))}getVideoPreviewElement(a,c){if(this.visitorVideoRunning)a(document.getElementById(this.videoPreviewElementId));
else{c=CobrowseVideoUtils.getViewerId(this.GLANCE_SESSIONINFO.num,this.GLANCE_SESSIONINFO.newssn.widget);var d=document.getElementById(c);d?this.setupIframeForPreview(d,a):vidlog("Video preview element not available",c,"widget",this.GLANCE_SESSIONINFO.newssn.widget)}}previewAgentVideoAtElement(a){this.previewElement!==a&&a&&!a.srcObject&&this.agent.agentVideoRunning()&&(this.previewElement=a,vidlog("Setting video preview element to:",a.id),this.agent.setVideoPreviewElement(a),document.contains(a)&&
this.session.preserveElement(a,(c,d)=>{vidlog("Restoring preview element after it was replaced by a DOM update");this.agent.setVideoPreviewElement(d)}))}checkPreview(a){a&&delete this.previewElement;!this.previewElement&&this.agent.agentVideoRunning()&&this.getVideoPreviewElement(c=>{this.previewAgentVideoAtElement(c)})}}
class VisitorVideoViewer{constructor(a,c,d){this.session=d;this.agentvideopreview=c;this.GLANCE_SESSIONINFO=a;this.joined=!1}updateState(a){vidlog("Visitor video state update:",a);a.previewelementid&&this.agentvideopreview.setPreviewElement(a.previewelementid,!0)}};document.domain=window.location.hostname.match(/[^\.]+\.([^\.]+)$/)[0];GLANCE=GLANCE||{};GLANCE.Cobrowse=GLANCE.Cobrowse||{};
GLANCE.Cobrowse.Viewer=function(){function a(b){if(E.getDomain()!==GLANCE.Lib.getDomain(b.origin))GLANCE.Lib.log("Ignoring mesage from origin "+b.origin);else{var f=b.data;f.parentConnected?n.parentConnected||(n.parentConnected=!0,n.onOpen()):f.interactiveOverlay?f.interactiveOverlay.interactive?u.div.addClass("agentinteractive"):u.div.removeClass("agentinteractive"):f.iframeLoaded?n.isConnected()&&b.source.postMessage(n.getParentConnectedMessage(),window.location.origin):f.mouseOverScrollbar?u.handleMouseOverScrollbar(f.mouseOverScrollbar.over):
f.iframeSend?n.ipage?window.parent.postMessage(f,window.location.origin):n.ws.send(JSON.stringify(f.iframeSend)):f.iframeReceive?parseInt(f.iframeReceive.frameid)===n.info.frameid?n.handleServerMessage(f.iframeReceive):n.forwardIframeMessage(f.iframeReceive):f.readyFrames?(n.fixAddedOrReplacedIframes(),n.notifyIframes(f)):f.glance_viewer&&f.glance_viewer.closereason&&("PlayerTooSlow"===f.glance_viewer.closereason&&b.source.frameElement.parentElement.setAttribute("data-videostate","error"),n.fireEvent("viewerclosing",
{closereason:f.glance_viewer.closereason}))}}function c(b){let f=document.getElementById("glance_confirm_btn"),g=document.getElementById("glance_deny_btn"),l=document.querySelector(b);f.focus();f.addEventListener("keydown",v=>{"Tab"===v.key&&v.shiftKey&&v.preventDefault();"Enter"===v.key&&l.focus();"Escape"===v.key&&(u.hideConfirmation(),l.focus())});g.addEventListener("keydown",v=>{"Tab"!==v.key||v.shiftKey||v.preventDefault();"Enter"===v.key&&l.focus();"Escape"===v.key&&(u.hideConfirmation(),l.focus())})}
function d(){for(var b=window;b=b.parent;){try{if(b.document.getElementById("agentviewerui"))return b}catch(f){return GLANCE.Lib.errlog("Exception looking for agentviewerui "+f.toString()),null}if(b===b.parent)return GLANCE.Lib.errlog("No agentviewerui at top level"),null}}function e(){var b=d();b&&(b=b.document.id("pageframe").contentWindow);return b}function h(){P||(P=!0,n=new r,n.init(),n.connect(),window.addEventListener("unload",k),window.addEventListener("message",a,!1),n.ipage&&window.parent.postMessage({iframeLoaded:!0},
window.location.origin),"on"===z.viewerinfo.inlinestyles&&(InitPrefixFree(),StyleFix.process()))}function k(){M||n.ipage||(n.post("LeaveSession",{},function(){},!0),n.sessionEnded());window.removeEventListener("unload",k)}function m(){}function r(){this.reconnects=0;this.connected=!1;this.timeoutMilliseconds=this.pingMilliseconds=this.lastMessage=0;this.pingTimer=new GLANCE.Lib.ExtendableTimer;this.timeoutTimer=new GLANCE.Lib.ExtendableTimer}function t(){this.headelems=document.documentElement.querySelectorAll(".cbheadelem")}
function A(b,f){this.scrolltab=window.parent.document.id(b+"scrolltab");this.scrollbar=window.parent.document.id(b+"scrollbar");this.posname="v"===b?"top":"left";this.dimname="v"===b?"height":"width";this.axisname="h"===b?"x":"y";this.scrolldim="h"===b?"scrollWidth":"scrollHeight";this.scroller=new q(this.axisname);this.pageframeoffset=window.parent.document.id("pageframe").getPosition()[this.axisname];z.newssn.remotescroll&&this.ToggleRC(!0);this.setScrollInfo(f)}function q(b){this.axisname=b}function y(b,
f){this.name=f;this.webserver=b;this.retries=0;this.state="STOPPED"}function p(){function b(g){f.onKeyEvent(g)}var f=this;document.id(document.body).addEvent("dblclick",function(g){g.stop()});this.scrollers={x:new q("x"),y:new q("y")};document.addEvent("keydown",b);document.addEvent("keyup",b);document.addEvent("keypress",b);document.addEvent("input",g=>this.onInputEvent(g));document.addEvent("change",g=>this.onInputEvent(g));document.addEvent("scroll",g=>this.onScroll());document.addEvent("focusin",
g=>this.onFocusIn());this.sessionPaused=this.mousedown=this.seenabled=this.rcenabled=!1;this.visitorIsScrolling=new GLANCE.Lib.ExtendableTimer;this.agentIsScrolling=new GLANCE.Lib.ExtendableTimer;this.agentSettingFocus=new GLANCE.Lib.ExtendableTimer;this.pageIsScrolling=new GLANCE.Lib.ExtendableTimer;this.create();n.ipage&&window.addEventListener("scroll",p.onIframeScroll)}function D(b){this.init(b)}function C(b){if(b===N.name)return N;if(b===H.name)return H;GLANCE.Lib.errlog("Unrecognized screenshareView:",
b)}function J(b){let f=document.getElementById("glance_screenshare_viewer");null!=f&&f.remove();f=document.createElement("div");f.id="glance_screenshare_viewer";f.style="position:fixed;top:0px;left:0px;width:95%;height:95%;z-index: 2147483645;";var g=document.createElement("div");g.id="glance_visitorscreenshare_dim";g.tabindex="-1";g.addClass("glance_dim");f.appendChild(g);g=document.createElement("iframe");g.id="glance_screenshare_iframe";g.style="position:relative;top:2.5%;left:2.5%;width:95vw;height:95vh;z-index: 2147483645;";
g.src=b;f.appendChild(g);return f}function w(b){if(b&&0<b.length){b=J(b);let f=document.getElementById("glance_ssview");f.hasClass("glance_hide")?f.parentNode.insertBefore(b,f):f.parentNode.insertBefore(b,f.nextElementSibling)}}function x(){let b=document.getElementById("glance_screenshare_viewer");if(null!=b&&"started"==n.visitorScreenshareStatus){var f=document.getElementById("glance_screenshare_iframe").src;b.remove();b=J(f);f=document.getElementById("glance_scrim");f.parentNode.insertBefore(b,
f)}}var n=null,u=null,Q=null,N=null,H=null,P=!1,M=!1,O=!1,R=1,L=d(),V=e(),E=new GLANCE.Lib.Page(window),S=new GLANCE.Lib.Timer,z=JSON.parse(document.id("glance-ssninfo").getAttribute("data-ssninfo"));null!==z.frameid?window.addEvent("domready",h):window.addEvent("domready",function(){window.parent.addEvent("domready",h)});m.prototype.init=function(){debuglog("Viewer Init inframe:"+this.ipage);this.canvasData=this.canvasData||{};N=new y(z.webserver,GLANCE.Lib.MESSAGES.GLANCE_SCREENSHARE);this.videoshare=
H=new y(z.webserver,CobrowseVideoUtils.getViewerId(z.num,z.newssn.widget));this.info=z;this.pageScroll=this.info.state.scroll;this.windims=Window.getSize();this.docdims=this.info.state.docdims;this.leftPage=!1;this.ipage=null!==this.info.frameid;this.ipage||(this.hscrollBar=new A("h",this.info.state.scrollinfo.x),this.vscrollBar=new A("v",this.info.state.scrollinfo.y),this.agent=L.GLANCE.Cobrowse.Agent,this.agentVideoPreview=new AgentVideoPreview(z,this.agent,this),this.visitorVideo=new VisitorVideoViewer(z,
this.agentVideoPreview,this),this.restoreViewerStateAttributes());this.embeddedViewer=window.parent.parent!==window.parent&&!this.ipage;this.visitorCursor=new D(n.info.state.mouse);this.differ=new GLANCE.Lib.DomDiffApplier;this.frames=[];this.elemstate={inputValues:{},scrollState:{}};Q=new t;u=new p;this.shadowDomViewer=new ShadowDOMViewer(this.elemstate,u);GLANCE.Lib.protocolVersion=this.info.visitorver;this.ipage||window.parent.document.id("pageframe").setStyle("visibility","visible");this.ipage&&
GLANCE.Lib.trapFocusInIframe();this.applyCumState(this.info.cumstate);this.shadowDomViewer.handleAdoptedStyles(this.info.elemdata.adoptedstyles);this.shadowDomViewer.renderShadowDomElements(this.info.elemdata.shadowdoms);this.updateState(this.info.state);this.drawCanvases(this.info.elemdata.canvases);if(GLANCE.Lib.Browser.firefox)for(var b=document.getElementsByTagName("link"),f=0;f<b.length;f++)null!==b[f].getAttribute("disabled")&&(b[f].disabled=!0);this.differ.processAddedElem(document.body);this.ipage||
this.agentVideoPreview.checkPreview();!this.ipage&&document.id(GLANCE.Lib.MESSAGES.GLANCE_SCREENSHAREPREVIEW)&&this.agent.setScreensharePreviewElement(document.id(GLANCE.Lib.MESSAGES.GLANCE_SCREENSHAREPREVIEW));this.fixAddedOrReplacedIframes();this.addCobrowseCSS();this.fireNavigateEvent();this.videoScrollOffset=this.info.state["agent-scrollstate-"+z.num]||0};m.prototype.restoreAgentVideoScrollOffset=function(){CobrowseVideoUtils.setVideoScrollOffset(n.videoScrollOffset)};m.prototype.addCobrowseCSS=
function(){function b(l,v){var B=document.createElement("link");B.id=l;B.type="text/css";B.rel="stylesheet";B.media="all";B.href=v;l=document.getElementsByTagName("head")[0];l.insertBefore(B,l.firstElementChild)}var f=`
            #glance_gesture:not([data-localgesture])[data-agentnum="${z.num}"] {
                display: none;
            }
        `,g=document.createElement("style");g.type="text/css";g.appendChild(document.createTextNode(f));document.head.appendChild(g);f=d().GLANCE_SESSIONINFO.scriptserver;this.ipage&&!document.getElementById("glance_ss")&&(b("glance_customss","https://"+f+"/cobrowse/customstyles/CustomSkin_"+z.newssn.groupid+"_"+z.newssn.site.substr(0,1).toUpperCase()+".css"),b("glance_ss","https://"+f+"/cobrowse/styles/Cobrowse_"+GLANCEVERSION3+".css"))};m.prototype.restoreViewerStateAttributes=function(){if(!this.ipage){var b=
this.agent.getViewerStateAttributes();Object.keys(b).forEach(f=>{document.body.setAttribute(f,b[f])})}};m.prototype.fireNavigateEvent=function(){var b={browser:this.info.newssn.browser,visitorversion:this.info.newssn.ver,url:this.info.page.pageurl,pagemasked:document.body.hasClass("glance_masked")};this.fireEvent("navigate",b)};m.prototype.redirectTop=function(b){window.parent.location.href=GLANCE.Lib.AppendUrlParams(b,`role=${z.agentinfo.role}`);M=!0};m.prototype.redirectPage=function(){this.ipage||
(this.hscrollBar.Destroy(),this.vscrollBar.Destroy());if(!M){var b=window.location.href;diffslog("==== Redirect Page ====");b=b.replace(/&cb=\d*/,"");b=b.replace("#glance_scroll","&cb="+GLANCE.Lib.random(4)+"#glance_scroll");window.location.href=b;M=!0}};m.prototype.visitorLeavingPage=function(){u.suspendRC(!0);this.leftPage=window.setTimeout(function(){u.dim();rclog("visitorLeavingPage, suspend rc")},2E3)};m.prototype.preserveElement=function(b,f){b.id?(this.preservedElements=this.preservedElements||
[],this.preservedElements=this.preservedElements.filter(g=>g.element.id!==b.id),this.preservedElements.push({element:b,restorefunc:f})):GLANCE.Lib.log("ERR_NOPRESERVEID")};m.prototype.restorePreserved=function(){if(this.preservedElements)for(let b=0;b<this.preservedElements.length;b++){let f=this.preservedElements[b].element;if(!document.contains(f)){let g=document.getElementById(f.id);debuglog("Restoring preserved element",f.id);g&&(this.preservedElements[b].restorefunc(f,g),this.preservedElements[b].element=
g)}}};m.prototype.fixAddedOrReplacedIframes=function(){let b=V.GLANCE.Cobrowse.Viewer.getFrames();iframelog("frame:",this.info.frameid,"fixAddedOrReplacedIframes");var f,g=document.getElementsByTagName("iframe");for(f=0;f<g.length;f++){var l=g[f].getAttribute("frameid");if(!g[f].getAttribute("data-no-cobrowse-content"))if(g[f].getAttribute("data-independent-content")){if(g[f].id!==H.name){if(g[f].id===GLANCE.Lib.MESSAGES.GLANCE_SCREENSHARE){l=g[f].getAttribute("data-agentnum");if(!l)continue;if(l==
z.num)continue}if(l=g[f].getAttribute("data-src"))l=l.replace(/&gid=\d+/,"&gid="+z.num).replace("{guestid}",z.agentinfo.guestid).replace("{role}",z.agentinfo.role),g[f].src!==l&&(GLANCE.Lib.getDomain(l)!==GLANCE.Lib.getDomain(z.webserver)?GLANCE.Lib.log("ERR_UNTRUSTED_IFRAME src:"+l+" iframe id:"+g[f].id+" not on same domain as "+z.webserver):(vidlog("Setting src on iframe",g[f].id,l),g[f].removeAttribute("sandbox"),g[f].src=l))}}else null===l||-1===b.indexOf(parseInt(l))?(iframelog("Sandboxing iframe with src:",
g[f].src,"frameid:",l,"call iframes:",b),g[f].setAttribute("sandbox","")):this.setIPageSrc(g[f])}};m.prototype.setIPageSrc=function(b){if(!(b.src&&0<b.src.length)){var f=window.location.origin+"/agent/IPage?ssnid="+this.info.ssnid+"&frameid="+b.getAttribute("frameid")+"&num="+this.info.num;iframelog("Setting src on iframe",b.getAttribute("frameid"),"to",f);b.removeAttribute("sandbox");b.src=f}};m.prototype.atLeastVer=function(b){return 0<=GLANCE.Lib.compareVersions(this.info.visitorver,b)};m.prototype.isStopped=
function(){return this.info.stopped};m.prototype.fireEvent=function(b,f){this.ipage||(eventslog("fireEvent",{GlanceEvent:{name:b,event:f}}),this.embeddedViewer&&this.postMessageToViewerContainer({GlanceEvent:{name:b,event:f}}),this.agent&&this.agent._fire(b,f))};m.prototype.postMessageToViewerContainer=function(b){if(z.viewerinfo.viewerparentorigin)try{window.parent.parent.postMessage(b,z.viewerinfo.viewerparentorigin)}catch(f){console.error("Caught exception: '"+f.message+"' posting to viewer container.  Check allowed viewer parent origins for the group.")}else console.error("Viewer is iframed.  Configure allowed viewer parent origins for the group.")};
m.prototype.handleMessage=function(b){b.pauseparticipantvideo&&b.pauseparticipantvideo.participantnum&&n.info.num===b.pauseparticipantvideo.participantnum&&n.agent.pauseAgentVideo();b.pagechanged&&this.handlePageChanged(b.pagechanged);b.accessdenied&&this.fireEvent("accessdenied",b.accessdenied);void 0!==b.adoptedstyles&&this.shadowDomViewer.handleAdoptedStyles(b.adoptedstyles);b.shadowdoms&&(this.shadowDomViewer.renderShadowDomElements(b.shadowdoms),"started"==this.visitorScreenshareStatus&&w(this.visitorScreenshareUrl));
void 0!==b.ol_c&&(b.outline=GLANCE.Lib.decompressObj(b.ol_c));b.outline&&u.drawRemoteGesture(b.outline);b.incstate&&this.handleIncState(b.incstate);b.doc&&(this.fireEvent("documentShared",b),b.nmsgs-1===b.n&&this.fireEvent("docShared",{sharedBy:"visitor",name:b.name}));b.docdownloaded&&this.fireEvent("docDownloaded",{sharedBy:"agent",downloadedBy:"visitor",name:b.name});b.canvases&&this.drawCanvases(b.canvases);b.ssnmessage&&(b.ssnmessage.messageName?this.embeddedViewer?this.postMessageToViewerContainer({GlanceMessage:b.ssnmessage}):
window.parent.GLANCE&&window.parent.GLANCE.Cobrowse&&window.parent.GLANCE.Cobrowse.Agent&&window.parent.GLANCE.Cobrowse.Agent._dispatch(b.ssnmessage):b.ssnmessage.rcrequest?(rclog("received rcrequest response:"+b.ssnmessage.rcrequest),u.rcRequestState(b.ssnmessage.rcrequest)):b.ssnmessage.visitorvideorequest&&(vidlog("received visitorvideorequest response: "+b.ssnmessage.visitorvideorequest),this.fireEvent("visitorvideorequest",{response:b.ssnmessage.visitorvideorequest})))};m.prototype.fixLinkElemsIE11=
function(){for(var b=document.head.querySelector("base[href]").getAttribute("href"),f=b.split("/").slice(0,3).join("/"),g=document.querySelectorAll("link[href]"),l=0;l<g.length;l++){var v=g[l].getAttribute("href");0<=v.indexOf("//")||(0===v.indexOf("/")?g[l].setAttribute("href",f+v):g[l].setAttribute("href",b+v))}};m.prototype.waitForElement=function(b){return new Promise((f,g)=>{})};m.prototype.handleIncState=function(b){void 0!=b.bd_c&&(b.bodydiffs=GLANCE.Lib.decompressObj(b.bd_c),b.bodydiffs||
GLANCE.Lib.errlog("ERR_DECOMPDIFFS"));if(void 0!==b.bodydiffs){var f=this.differ.applyDiffs(b.bodydiffs);this.fixAddedOrReplacedIframes();this.restoreAgentVideoScrollOffset();f.head&&(Q.restore(),this.addCobrowseCSS());this.restorePreserved();this.restoreViewerStateAttributes();document.getElementById("glance_blurbgd_video")&&document.getElementById("glance_blurbgd_video").setAttribute("aria-pressed",document.body.getAttribute("data-videobgblur"));this.ipage||(this.agentVideoPreview.checkPreview(),
document.id(GLANCE.Lib.MESSAGES.GLANCE_SCREENSHAREPREVIEW)&&this.agent.setScreensharePreviewElement(document.id(GLANCE.Lib.MESSAGES.GLANCE_SCREENSHAREPREVIEW)));f.body&&(u.restore(),this.visitorCursor.restore(),document.body.setAttribute("data-cobrowseviewer","true"));u.disableMaskedFields();f.head&&(GLANCE.Lib.Browser.ie10||GLANCE.Lib.Browser.ie11)&&this.fixLinkElemsIE11();f.head&&u.temporarilyHidePage();f.canvas&&this.restoreCanvasData()}void 0!=b.ip_c&&(b.inputs=GLANCE.Lib.decompressObj(b.ip_c));
b.inputs&&this.populateInputs(b.inputs);void 0!==b.escroll&&this.scrollElems(b.escroll);void 0!==b.canvases&&this.drawCanvases43(GLANCE.Lib.decompressObj(b.canvases))};m.prototype.handleStateUpdate=function(b){var f=b.state;b=b.messages;var g=this;b&&b.forEach(function(l){g.handleMessage(l)});f&&this.updateState(f)};m.prototype.handlePageChanged=function(b){u.isgesturing()&&!b.newurl?u.ongesturedone=function(){n.handlePageChanged(b)}:this.redirectPage()};m.prototype.getScriptPath=function(){let b=
document.querySelectorAll("script[src*='CobrowseViewer']")[0].getAttribute("src"),f=b.lastIndexOf("/");return b.substr(0,f)};m.prototype.getCanvas=function(b){var f=GLANCE.Lib.toElem(document.documentElement).getUniqueElement("canvas["+GLANCE.Lib.Const.GID+"='"+b+"']",!1);return f?f:(cbstatelog("Canvas element not found: data-gcid=",b),null)};m.prototype.drawCanvas=function(b,f){var g=this.getCanvas(b);if(null!==g){cbstatelog("Drawing canvas",b);var l=new Image,v=Math.random();l.addEventListener("load",
function(){if(g.rnd!==v)cbstatelog("Image loaded for canvas data-gcid=",b,"length:",f.length,"was superceded by another image");else{cbstatelog("Image loaded for canvas data-gcid=",b,"length:",f.length);var B=g.getContext("2d");B.clearRect(0,0,g.width,g.height);B.drawImage(l,0,0)}});l.src=f;g.rnd=v;this.canvasData[b]=l}};m.prototype.drawCanvases=function(b){if(b){var f=this;Object.keys(b).forEach(function(g,l){f.drawCanvas(g,b[g].data)})}};m.prototype.drawCanvases43=function(b){var f=this;b=b.c;b.forEach(function(g){f.drawCanvas(g.gcid,
g.data)})};m.prototype.restoreCanvasData=function(){var b=this;Object.getOwnPropertyNames(this.canvasData).forEach(function(f){cbstatelog("Restoring canvas image data for data-gcid=",f);var g=b.getCanvas(f);null===g?delete b.canvasData[f]:(f=b.canvasData[f],g.getContext("2d").drawImage(f,0,0))})};m.prototype.applyCumState=function(b){if(b&&b.forEach){var f=this;b.forEach(function(g){f.handleIncState(g)})}};m.prototype.updateState=function(b){b.leftpage&&!this.leftPage&&this.visitorLeavingPage();void 0!=
b.ip_c&&(b.inputs=GLANCE.Lib.decompressObj(b.ip_c));b.mouse&&this.visitorCursor.moveTo(b.mouse);b.click&&this.visitorCursor.clickAt(b.click);b.inputs&&this.populateInputs(b.inputs);b.styles&&this.applyStyles(b.styles);b.focus&&this.setFocus(b.focus);b.pageurl&&this.setPageUrl(b.pageurl);b.agents&&this.setAgents(b.agents);b.user&&this.setUserState(b.user);this.storeStateInParent(b);var f=b.ssvisitor&&b.ssvisitor[GLANCE.Lib.MESSAGES.GLANCE_SCREENSHARE],g=b[`ssagent-${GLANCE.Lib.MESSAGES.GLANCE_SCREENSHARE}`];
(g||f)&&N.updateState(g,f);f=`ssagent-${H.name}`;g=b.ssvisitor&&b.ssvisitor[H.name];(b[`ssagent-${H.name}`]||g)&&H.updateState(b[f],g);b.visitorscreenshare&&this.handleScreenshareResponse(b);(b.docshare||b.docsharepreview)&&this.handleDocshareState(b);b.visitorvideoinfo&&this.visitorVideo.setAgentState(b.visitorvideoinfo);b.visitorvideo&&(this.visitorVideo.updateState(b.visitorvideo),this.fireEvent("visitorvideo",b.visitorvideo));this.ipage||(b.windims&&this.setWinDims(b.windims),b.docdims&&(this.docdims=
b.docdims),b.scrollinfo&&(scrolllog("scroll info from visitor:",JSON.stringify(b.scrollinfo)),this.hscrollBar.setScrollInfo(b.scrollinfo.x),this.vscrollBar.setScrollInfo(b.scrollinfo.y),this.scrollTo(this.pageScroll)),b.scrollvisible&&(scrolllog("scrollbar visibility from visitor:",b.scrollvisible),this.hscrollBar.setVisibility(b.scrollvisible.x),this.vscrollBar.setVisibility(b.scrollvisible.y)));b.scroll&&(scrolllog("scroll state from visitor:",JSON.stringify(b.scroll)),u.agentIsScrolling.isSet()?
scrolllog("Ignoring visitor scroll echoed back while agent is scrolling"):(u.visitorIsScrolling.set(T),this.scrollTo(b.scroll)));b.frames&&(this.frames=b.frames,this.fixAddedOrReplacedIframes(),this.notifyIframes({readyFrames:!0}));b.rc&&(rclog("Received rc state "+JSON.stringify(b.rc)),"on"===z.privs.CBGUESTSE?u.enableSE(b.rc.enabled,b.rc.suspended):u.enableRC(b.rc.enabled,b.rc.suspended));b.accessibility&&(this.accessibilityEnabled=b.accessibility.enabled);b.sessionpaused&&(masklog("sessionpaused:",
b.sessionpaused),u.showPaused(b.sessionpaused.paused,b.sessionpaused.message),this.fireEvent("sessionpaused",b.sessionpaused));Object.assign(this.info.state,b)};m.prototype.handleScreenshareResponse=function(b){b.visitorscreenshare?b.visitorscreenshare.status&&b.visitorscreenshare.status!=this.visitorScreenshareStatus&&("notsupported"==b.visitorscreenshare.status?(this.visitorScreenshareStatus="stopped",this.fireEvent("visitorscreensharenotsupported")):"stopped"==b.visitorscreenshare.status&&"pending"==
this.visitorScreenshareStatus?(this.visitorScreenshareStatus="stopped",this.fireEvent("screensharedeclined")):"stopped"==b.visitorscreenshare.status?("stopped"!=this.visitorScreenshareStatus&&this.fireEvent("visitorscreensharestopped"),this.visitorScreenshareStatus="stopped",this.disableScreenshareGestures=!1,b=document.getElementById("glance_screenshare_viewer"),null!=b&&b.addClass("glance_hide"),this.visitorCursor.show(!0)):(this.visitorScreenshareUrl=b.visitorscreenshare.joinurl.replace("{guestid}",
z.agentinfo.guestid).replace("{role}","agent"),w(this.visitorScreenshareUrl),this.visitorScreenshareStatus="started",this.disableScreenshareGestures=!0,this.visitorCursor.hide(!0),this.fireEvent("visitorscreensharestarted"))):console.error("No on going screenshare")};m.prototype.handleDocshareState=function(b){b.docshare&&(b.docshare.enabled?this.fireEvent("startdocshare"):this.fireEvent("enddocshare"));b.docsharepreview&&(b.docsharepreview.enabled?this.fireEvent("startdocsharepreview"):this.fireEvent("enddocsharepreview"))};
m.prototype.storeStateInParent=function(b){if(!this.ipage){var f={};["agents","accessibility","rc","sessionpaused"].forEach(g=>{b[g]&&(f[g]=b[g])});window.parent.GLANCE.Cobrowse.ViewerFrame.updateState(f)}};m.prototype.setAgents=function(b){this.agentState=b;this.fireEvent("agents",b)};m.prototype.setUserState=function(b){this.userState=b;this.fireEvent("userstate",b)};m.prototype.setPageUrl=function(b){n.info.page.pageurl=b;this.fireNavigateEvent()};m.prototype.setWinDims=function(b){this.windims=
b;this.hscrollBar.scrollbar.setStyle("width",b.x-4);this.vscrollBar.scrollbar.setStyle("height",b.y-4);window.parent.GLANCE&&window.parent.GLANCE.Cobrowse&&window.parent.GLANCE.Cobrowse.ViewerFrame.setWinDims(b)};m.prototype.clickElement=function(b){this.dispatchMouseEvent(b,"mousedown")};m.prototype.populateSelect=function(b,f,g,l){if(0!==f.children.length){l=l||0;var v=window.getComputedStyle(b);debuglog("select computed style ",v.height,v.lineHeight);for(var B=0;B<f.children.length;B++){var F=
f.children[B],I=document.createElement("div"),K=window.getComputedStyle(f.children[B]);["height","lineHeight"].forEach(function(G){I.style[G]=v[G]});g.appendChild(I);F.tagName.match(/option/i)?(I.innerHTML=F.innerHTML,"fontFamily fontStyle fontWeight paddingLeft lineHeight color backgroundColor".split(" ").forEach(function(G){I.style[G]=K[G]}),0<l&&(I.style.paddingLeft=5*l+"px")):F.tagName.match(/optgroup/i)&&(I.innerHTML=F.label,I.style.fontWeight="bold",this.populateSelect(b,F,g,l+1))}}};m.prototype.showSelect=
function(b){if(0!==b.children.length){var f=document.id("glance_open_sel");f||(f=new Element("div",{id:"glance_open_sel"}),u.div.appendChild(f));f.empty();this.populateSelect(b,b,f);var g=window.getComputedStyle(b);"backgroundColor backgroundPosition backgroundSize backgroundRepeat paddingLeft border".split(" ").forEach(function(v){f.style[v]=g[v]});"none"===f.style.borderStyle&&(f.style.border="1px solid gray");f.style["min-width"]=b.getSize().x+"px";f.style["max-height"]="345px";f.style.overflow=
"hidden scroll";f.style.display="inline-block";var l=b.getPosition();l.y+=b.getSize().y;l.y+f.getSize().y>window.getScroll().y+window.getSize().y&&(l.y-=f.getSize().y+b.getSize().y);f.setPosition(l)}};m.prototype.hideSelect=function(){var b=document.id("glance_open_sel");b&&b.setStyle("display","none")};m.prototype.dispatchMouseEvent=function(b,f){f=new MouseEvent(f,{view:window,bubbles:!0,cancelable:!0});b.dispatchEvent(f)};m.prototype._setFocus=function(b,f){if(b=document.id(document).getElement(b)){if(!b.hasClass("glance_focus")){var g=
document.id(document).getElement(".glance_focus");g&&g.removeClass("glance_focus");b.addClass("glance_focus")}f&&this.showSelect(b)}};m.prototype.setFocus=function(b){this.ws&&u.agentHasControl()||this.focusedElement&&b.path===this.focusedElement&&this.focusOpen===b.open||(this.focusOpen&&this.focusedElement&&this.hideSelect(),this._setFocus(b.path,b.open),this.focusedElement=b.path,this.focusOpen=b.open)};m.prototype.applyStyles=function(b){var f;if(void 0!==b){for(f=0;void 0!==this.appliedStyles&&
f<this.appliedStyles.length;f++){var g=document.id(document).getElement(this.appliedStyles[f].p);null!==g&&(g.className=g.className.replace(this.appliedStyles[f].cn,""))}for(f=0;f<b.length;f++)g=document.id(document).getElement(b[f].p),null!==g&&g.addClass(b[f].cn);this.appliedStyles=b}};m.prototype.scrollTo=function(b){var f=void 0!==b.x.offset?E.relativeOffsetToPage("x",b.x.relative,b.x.offset):b.x,g=void 0!==b.y.offset?E.relativeOffsetToPage("y",b.y.relative,b.y.offset):b.y;scrolllog("scroll to:",
JSON.stringify(b),f,g);window.scrollTo(f,g);this.pageScroll=b;this.ipage||(this.hscrollBar.setPos(f),this.vscrollBar.setPos(g))};m.prototype.scrollElems=function(b,f){if(!u.agentIsScrolling.isSet()){f=function(v,B){v-=B;return-2<v&&2>v};for(var g=0;g<b.length;g++){var l=GLANCE.Lib.toElem(document.documentElement).getUniqueElement(b[g].path,!1);if(!l){scrolllog("ERR_SCROLL_ELEMENT: Element not found: "+b[g].path);continue}let v=l.scrollWidth-l.clientWidth,B=l.scrollHeight-l.clientHeight;scrolllog("setting scroll offset of "+
b[g].path+" to "+b[g].x+","+b[g].y+` (scrollWidth, scrollHeight) = (${l.scrollWidth}, ${l.scrollHeight}) (clientWidth, clientHeight) = ${l.clientWidth},${l.clientHeight}) max scroll = (${v}, ${B})`);b[g].x=Math.min(b[g].x,v);b[g].y=Math.min(b[g].y,B);if(l.scrollTop!==b[g].y||l.scrollLeft!==b[g].x)l.scrollTop=b[g].y,l.scrollLeft=b[g].x,f(l.scrollTop,b[g].y)&&f(l.scrollLeft,b[g].x)||scrolllog(`Failed to set scroll, current offsets (scrollLeft, scrollTop) = (${l.scrollLeft}, ${l.scrollTop})`),u.onVisitorElemScroll(l),
this.elemstate.scrollState[b[g].path]=b[g]}}};m.prototype.populateInputs=function(b){if(void 0!==b){var f,g,l=b.i;for(f=0;f<l.length;f++)b=l[f],u.agentHasControl()&&b.path===u.agentControlledInput||((g=GLANCE.Lib.toElem(document.documentElement).getUniqueElement(b.path,!1))?(GLANCE.Lib.toElem(g).setInputValue(b),this.elemstate.inputValues[b.path]=b):GLANCE.Lib.log("Input not found "+b.path))}};m.prototype.sessionEnded=function(){this.fireEvent("sessionend",{ssnid:this.info.ssnid,groupid:"",reason:O?
"AgentLeft":"VisitorLeft"})};r.prototype=new m;r.prototype.connect=function(b={}){if(!this.ipage){var f=this,g=window.location.protocol.replace(":","");g=(this.info.secure?"wss://":"ws://")+window.location.hostname+":"+this.info.ports[this.info.secure?"https":"http"]+"/agent/ws?ssnid="+this.info.ssnid+"&num="+this.info.num+"&proto="+g;try{this.ws=new WebSocket(g)}catch(l){u.showMessage("Agent failed to connect:"+l.message);return}this.ws.onopen=()=>f.onOpen(b);this.ws.onclose=()=>f.onClose();this.ws.onerror=
()=>f.onWSError();this.ws.onmessage=l=>f.onServerMessage(l.data)}};r.prototype.onWSError=function(b={}){GLANCE.Lib.log("WS_RECON");this.reconnects+=1;if(10<this.reconnects)this.redirectTop(z.conndropurl);else{var f=Math.min(2*this.reconnects,10);u.showMessage("Connection dropped...will reconnect in "+f+" seconds");window.setTimeout(()=>this.connect(b),1E3*f)}};r.prototype.forwardIframeMessage=function(b){var f=document.querySelector("[frameid='"+b.frameid+"']");if(f)try{f.contentWindow.postMessage({iframeReceive:b},
window.location.origin)}catch(g){console.error(g)}else this.notifyIframes({iframeReceive:b})};r.prototype.notifyIframes=function(b){var f,g=document.getElementsByTagName("iframe");for(f=0;f<g.length;f++)if(g[f].getAttribute("frameid")&&g[f].getAttribute("src"))try{g[f].contentWindow.postMessage(b,window.location.origin)}catch(l){framelog("Error in notifyIframes. error:",l,"iframe:",g[f].getAttribute("src"))}};r.prototype.handleServerMessage=function(b){switch(b.mtype){case "MS":this.handleMessage(b.data);
scrolllog("Fix page scroll after update"+(n.ipage?" in frame":""));b.data.pagechanged||this.scrollTo(this.pageScroll);break;case "SU":this.handleStateUpdate(b.data);break;case "close":this.sessionEnded();b.data.redirect&&0<b.data.redirect.length&&this.redirectTop(b.data.redirect);break;case "Config":b.data.pinginterval&&(this.pingMilliseconds=1E3*b.data.pinginterval),b.data.pingtimeout&&(this.timeoutMilliseconds=1E3*b.data.pingtimeout)}};r.prototype.onServerMessage=function(b){this.lastMessage=Date.now();
0<this.pingMilliseconds&&this.pingTimer.set(this.pingMilliseconds,()=>this.post("Ping",{}));0<this.timeoutMilliseconds&&this.timeoutTimer.set(this.timeoutMilliseconds,()=>this.onWSError({reason:"pingtimeout"}));b=JSON.parse(b);b.frameid?this.forwardIframeMessage(b):this.handleServerMessage(b)};r.prototype.getParentConnectedMessage=function(){return{parentConnected:!0}};r.prototype.onOpen=function(b={}){u.sessionPaused||u.hideMessage();this.post("CN",b);this.sendQueue&&(this.sendQueue.forEach(f=>n.post(f.mtype,
f.obj)),delete this.sendQueue);this.notifyIframes(this.getParentConnectedMessage());this.connected=!0};m.prototype.agentLeftUrl=function(){var b=new URI(z.agentlefturl);b.setData({agentcount:this.agentState.count},!0);return b.toString()};r.prototype.onClose=function(){M||this.ipage||(O&&this.redirectTop(this.agentLeftUrl()),this.onWSError())};r.prototype.isConnected=function(){return this.ipage?this.parentConnected:!(void 0===this.ws||1!==this.ws.readyState)};r.prototype.post=function(b,f){this.isConnected()?
(b={mtype:b,data:f},this.ipage?(b.frameid=this.info.frameid,window.parent.postMessage({iframeSend:b},window.location.origin)):this.ws.send(JSON.stringify(b))):(this.sendQueue=this.sendQueue||[],this.sendQueue.push({mtype:b,obj:f}))};r.prototype.close=function(){this.ws.close()};r.prototype.nextCheckPage=function(){};m.prototype.setAgentState=function(b,f){var g={};g[b]=f;this.post("AgentData",g)};t.prototype.exists=function(){return 0<document.documentElement.querySelectorAll(".cbheadelem").length};
t.prototype.restore=function(){for(var b=0;b<this.headelems.length;b++)document.head.appendChild(this.headelems[b])};A.prototype.Destroy=function(){this.ToggleEventHandlers(!1)};A.prototype.ToggleEventHandlers=function(b){var f=this;rclog("ToggleEventHandlers",b);b?(this.scrolltab.addEvents({mousedown:function(g){f.onMouseDown(g)},mouseenter:function(g){f.onMouseEnter(g)},mouseleave:function(g){f.onMouseLeave(g)}}),window.parent.document.addEvents({mousemove:function(g){f.onDocEvent(g)},mouseup:function(g){f.onDocEvent(g)}}),
document.addEvents({mousemove:function(g){f.onDocEvent(g,!0)},mouseup:function(g){f.onDocEvent(g,!0)}})):(this.scrolltab.removeEvents(),window.parent.document.removeEvents())};A.prototype.setPos=function(b){b*=this.ratio;b=Math.min(b,this.scrollbar["x"==this.axisname?"clientWidth":"clientHeight"]-this.tabsz);this.scrolltab.style[this.posname]=Math.floor(b)+"px"};A.prototype.setScrollInfo=function(b){if(b.tabsz!==this.tabsz||b.ratio!==this.ratio)this.ratio=b.ratio,this.tabsz=b.tabsz,this.scrolltab.style[this.dimname]=
this.tabsz+"px"};A.prototype.setVisibility=function(b){this.scrollbar.style.display=b?"x"===this.axisname?"block":"inline-block":"none"};A.prototype.getVisible=function(){return"none"!==this.scrollbar.style.display};A.prototype.ToggleRC=function(b){if(!z.newssn.remotescroll||b)this.scrollbar.toggleClass("glance_agentcursor",b),this.scrolltab.toggleClass("glance_agentcursor",b),this.ToggleEventHandlers(b),b||delete this.mousedown};A.prototype.onMouseDown=function(b){u.checkCanScroll()&&(this.origscroll=
window.getScroll()[this.axisname],this.mousedown=b.client[this.axisname])};A.prototype.onMouseEnter=function(b){};A.prototype.onDocEvent=function(b,f){if((u.agentHasControl()||z.newssn.remotescroll)&&this.mousedown)if(f&&(b.client[this.axisname]=b.client[this.axisname]*R+this.pageframeoffset),"mousemove"===b.type)this.onMouseMove(b);else if("mouseup"===b.type)this.onMouseUp(b)};A.prototype.onMouseMove=function(b){if(this.mousedown&&!u.rcsuspended){b=b.client[this.axisname]-this.mousedown;var f=this.scrollbar.getSize()[this.axisname];
0!==b&&this.scroller.scrollTo(this.origscroll+Math.floor(b/f*n.docdims[this.axisname]))}};A.prototype.onMouseUp=function(b){delete this.mousedown;delete this.origscroll};A.prototype.scrollPage=function(b){var f=window.getSize().y,g=window.getScroll().y;this.scroller.scrollTo(g+("up"===b?-1:1)*f*.8);this.scroller.sendScroll()};A.prototype.onMouseLeave=function(b){};q.prototype.scrollTo=function(b){var f=document.getElementById("glance_cobrowse_btn");if(!(e().document.body.matches("[data-role=guest]")||
f&&"large"===f.getAttribute("data-videosize"))){var g=this;u.agentIsScrolling.set(U);b=Math.min(b,E.getDocDimensions()[this.axisname]-window.getSize()[this.axisname]);b=Math.max(b,0);this.newscroll=Math.round(b);b="x"===this.axisname?document.body.scrollWidth-window.innerWidth:document.body.scrollHeight-window.innerHeight;f=!1;this.newscroll>=b&&(this.newscroll=b,f=!0);n.ipage||f||(scrolllog("agent scrolled to: ",this.axisname,this.newscroll),E.scrollTo(this.axisname,this.newscroll),("x"===this.axisname?
n.hscrollBar:n.vscrollBar).setPos(this.newscroll));n.pageScroll[this.axisname]=this.newscroll;void 0===this.sendscrolltimer&&(this.sendscrolltimer=window.setTimeout(function(){g.sendScroll()},Math.max(0,200-(S.elapsed()-this.sendscrolltime))))}};q.prototype.sendScroll=function(){if(this.lastsentscroll!==this.newscroll){u.div.style.display="none";var b=E.getElemRelativeOffset(this.axisname,this.newscroll);u.div.style.display="";b.type="scroll";b.axis=this.axisname;scrolllog("sending scroll:",JSON.stringify(b));
u.sendRCEvent(b,void 0,!1)}this.lastsentscroll=this.newscroll;this.sendscrolltime=S.elapsed();delete this.sendscrolltimer};y.prototype.start=function(b,f){this.state="STARTING";var g=this;this.waitForSession("G",b.key,function(l,v){g.inviteVisitor(l,null,b,f)})};y.prototype.inviteVisitor=function(b,f,g,l){b&&(this.state="STARTED");this.ssagent={ssnid:b,joinurl:f,type:g?g.type:void 0,params:g,view:this.name,paused:!1,error:g&&g.error,agentparams:l};this.sendAgentInfo()};y.prototype.isRunning=function(){return"STARTED"===
this.state};y.prototype.getView=function(){return this.ssagent&&this.ssagent.view};y.prototype.sendAgentInfo=function(b){vidlog("adding callstate for screenshare: ","ssagent-"+this.name,this.ssagent);n.setAgentState("ssagent-"+this.name,this.ssagent)};y.prototype.clear=function(){delete this.ssagent;delete this.ssvisitor};y.prototype.pause=function(b){vidlog("pausing "+this.name);this.ssagent.paused=b;this.sendAgentInfo()};y.prototype.isReverse=function(){return this.ssagent&&this.ssagent.params&&
"reverse"===this.ssagent.params.type};y.prototype.stop=function(){vidlog("stopping "+this.name);this.state="STOPPED";this.inviteVisitor(null)};y.prototype.waitForSession=function(b,f,g,l){var v=this,B="https://"+this.webserver+"/services/SessionService.asmx/LookupSession",F=new GLANCE.Lib.Request("XML"),I={calltype:b,personid:z.agentid,key:f};this.retries=l?this.retries+1:0;u.showMessage("Starting session...");F.setAccept("XML");F.post(B,I,!1,!1,function(K){var G=new GLANCE.Lib.XMLDoc(K);K=G.getElementText("ssnid");
G=G.getElementText("joinurl");vidlog("waitForSession received reply:",K,G);K?(u.hideMessage(),g(K,G)):8>v.retries?window.setTimeout(function(){v.waitForSession(b,f,g,!0)},0==v.retries?1E3:3>v.retries?3E3:5E3):(u.showMessage("Session failed to start."),v.state="STOPPED")},function(K){u.showMessage("Failed to look up session at "+v.webserver)})};y.prototype.updateState=function(b,f){let g=b&&b.agentnum&&b.agentnum==z.num;vidlog("updateState agent:",JSON.stringify(b),"visitor:",JSON.stringify(f),"mysession:",
g);!b||this.ssagent&&g||(this.ssagent=b,b.ssnid&&(this.state="STARTED"));f&&(this.ssvisitor=f);f&&this.ssagent&&("declined"===f.status&&this.stop(),"accepted"===f.status&&this.ssagent.params&&"reverse"===this.ssagent.params.type&&this.stop(),f.status&&n.fireEvent("screenshare",{state:f.status,screenshareView:this.name,agentnum:this.ssagent.agentnum}))};var U=800,T=500;p.prototype.exists=function(){return this.div&&this.div.parentNode===document.body};p.prototype.restore=function(){this.div.inject(document.id(document.body));
this.msgbox.inject(document.id(document.body))};p.prototype.showPaused=function(b,f){if(b!==this.sessionPaused||f)this.sessionPaused=!0,b?f&&(this.div.setStyle("backgroundColor","white"),this.showMessage(f,!1)):(this.hideMessage(),this.div.setStyle("backgroundColor",null))};p.prototype.temporarilyHidePage=function(){this.div.setStyle("backgroundColor","white");var b=this;window.setTimeout(function(){b.div.setStyle("backgroundColor",null)},200)};p.prototype.create=function(){var b=this;this.mouseleft=
0;this.div=document.id("glance_overlay");this.setOverlayPosition();this.msgbox=document.id("glance_agent_msg_box");this.msgboxtitle=document.id("msg_box_title")||this.msgbox;this.msgboxok=document.id("msg_box_ok")||this.msgbox;this.msgboxok.addEvent("click",function(f){f.stop();b.hideMessage()});this.gesture=document.id("glance_gesture");this.gestureEvents="click mouseup mousedown mousemove wheel keydown".split(" ");this.gestureHandlers=[function(f){b.onClickNoRC(f)},function(f){b.onMouseUp(f)},function(f){b.onMouseDown(f)},
function(f){b.onMouseMove(f)},function(f){b.onMouseWheel(f)},function(f){b.onKeyDown(f)}];this.seEvents=["mousemove"];this.seHandlers=[function(f){b.onMouseMoveSE(f)}];this.rcEvents=["click","mousedown","mouseup","mousemove","wheel"];this.rcHandlers=[function(f){return b.onClickRC(f)},function(f){return b.onMouseEventRC(f)},function(f){return b.onMouseEventRC(f)},function(f){b.onMouseMoveRC(f)},function(f){b.onMouseWheel(f)}];document.addEventListener("scroll",function(f){b.onElemScroll(f)},!0);document.addEventListener("mouseleave",
function(f){b.onMouseLeave(f)});this.gesturefade=new Fx.Tween(this.gesture,{duration:5E3,property:"opacity",fps:20,onComplete:function(){b.gesture.setStyles({width:"0px",height:"0px"});delete b.gesturedElement}});void 0!==z.state.rc&&z.state.rc.enabled?"on"==z.privs.CBGUESTSE?this.enableSE(z.state.rc.enabled,z.state.rc.suspended):this.enableRC(z.state.rc.enabled,z.state.rc.suspended):this.enableGestures(!0);n.ipage&&this.div.addClass("iframe")};p.prototype.checkCanScroll=function(){return this.agentScrollingEnabled()?
this.rcsuspended?(rclog("visitor working"),n.fireEvent("visitorworking",{working:!0}),!1):!0:!1};p.prototype.handleMouseOverScrollbar=function(b){n.ipage?window.parent.postMessage({mouseOverScrollbar:{over:b}},window.location.origin):(this.rcsuspended&&(b=!1),b!==this.overScrollbar&&(b?this.div.addClass("elementscrolling"):this.div.removeClass("elementscrolling"),this.overScrollbar=b))};p.prototype.scrollElementAtMouse=function(b,f){if(GLANCE.Lib.Browser.ie11||!this.mouseclientpos)return!1;var g=
function(l,v,B){if(GLANCE.Lib.toElem(l).isScrollable()&&"HTML"!==l.nodeName){var F=B?l.scrollLeft:l.scrollTop;B?l.scrollLeft+=v:l.scrollTop+=v;if(F===(B?l.scrollLeft:l.scrollTop))return!1;scrolllog("scrolling element "+l.tagName+" by "+v+(B?" X":" Y"));return!0}return"IFRAME"===l.tagName&&"no"!==l.scrolling?(F=B?l.contentDocument.window.pageXOffset:l.contentDocument.window.pageYOffset,B?l.contentDocument.window.scrollTo(l.contentDocument.window.pageXOffset+v,l.contentDocument.window.pageYOffset):
l.contentDocument.window.scrollTo(l.contentDocument.window.pageXOffset,l.contentDocument.window.pageYOffset+v),F===(B?l.contentDocument.window.pageXOffset:l.contentDocument.window.pageYOffset)?!1:!0):l.parentElement?g(l.parentElement,v,B):!1};return this.processElementAtPoint(this.mouseclientpos,function(l,v){return e().document.body.matches("[data-role=guest]")?!1:g(l,b,f)})};p.prototype.onMouseWheel=function(b){if(u.checkCanScroll()){var f=1;switch(b.deltaMode){case 0:f=1;break;case 1:f=100;break;
case 2:f=400}var g=Math.round(b.deltaY*f);scrolllog("mousewheel:",b.deltaMode,b.deltaY,g);f=!1;if(0===b.deltaX||0!==g)if(b.shiftKey&&(f=!0),this.scrollElementAtMouse(g,f))b.preventDefault(),b.stopPropagation();else if(f||n.vscrollBar&&n.vscrollBar.getVisible())if(!f||n.hscrollBar&&n.hscrollBar.getVisible())if(window.parent.GLANCE_SESSIONINFO.scaledview||b.altKey)g=f?window.getScroll().x+g:window.getScroll().y+g,f?this.scrollers.x.scrollTo(g):this.scrollers.y.scrollTo(g),b.preventDefault(),b.stopPropagation()}};
p.prototype.agentHasControl=function(){return this.rcenabled&&!this.rcsuspended};p.prototype.agentScrollingEnabled=function(){return e().document.body.matches("[data-role=guest]")?!1:z.newssn.remotescroll||this.rcenabled};p.prototype.enableGestures=function(b){this.enableEvents(this.gestureEvents,this.gestureHandlers,b)};p.prototype.enableEvents=function(b,f,g){var l;for(l=0;l<b.length;l++)g?"wheel"===b[l]?document.addEventListener(b[l],f[l],{passive:!1}):document.addEvent(b[l],f[l]):"wheel"===b[l]?
document.removeEventListener(b[l],f[l]):document.removeEvent(b[l],f[l])};p.prototype.isgesturing=function(){return this.mousedown};p.prototype.dim=function(){this.div.addClass("dim");window.setTimeout(()=>{this.showMessage("<h5>Waiting for visitor</h5><p>The visitor's page may be taking a long time to load. They may have navigated to another page or lost their connection. The session will automatically resume once the other side reconnects.</p>")},5E3);this.div.removeEvents("mouseup");this.div.removeEvents("mousedown")};
p.prototype.showMessage=function(b,f){this.msgboxtitle.innerHTML=b.replace(/<script/,"&ltscript");this.msgbox.removeClass("glance_hide");this.msgbox.addClass("glance_show");f?(this.msgboxok.removeClass("glance_hide"),this.msgboxok.focus()):(this.msgboxok.addClass("glance_hide"),this.msgbox.focus())};p.prototype.hideMessage=function(b){this.msgbox.removeClass("glance_show");this.msgbox.addClass("glance_hide")};p.prototype.getMouseDragCoords=function(b){var f=b.page;var g=this.getElemRelativeCoords(this.clientMouseDown,
this.pageMouseDown);b=this.getElemRelativeCoords(b.client,b.page);return{left:Math.min(this.pageMouseDown.x,f.x),top:Math.min(this.pageMouseDown.y,f.y),width:Math.abs(this.pageMouseDown.x-f.x),height:Math.abs(this.pageMouseDown.y-f.y),relative:[g.relative,b.relative],p1:g,p2:b}};p.prototype.hide=function(b){this.div.style.display=b?"none":""};p.prototype.getElemInShadowRoot=function(b,f,g,l){b=b.elementsFromPoint(f.x,f.y).filter(v=>"glance_overlay"!==v.id)[0];return b.shadowRoot&&b!==l?(gestlog(g,
" shadow layers deep"),this.getElemInShadowRoot(b.shadowRoot,f,g+1,b)):b};p.prototype.getElemAt=function(b){let f=document.id(E.getElemAt(b));return f.shadowRoot?this.getElemInShadowRoot(f.shadowRoot,b,1):f};p.prototype.getElemRelativeCoords=function(b,f){this.div.style.display="none";b=E.getElemRelativeCoords(b,f);this.div.style.display="";return b};p.prototype.setOverlayPosition=function(){let b=()=>{GLANCE.Lib.toElem(this.div).positionAtZero()};b();window.setInterval(b,5E3)};p.prototype.click=
function(b){if(this.rcenabled)this.onClickRC(b);else this.doGestureAt(b.client)};p.prototype.onElemScroll=function(b){if(b.target!==document&&!(b.target.getAttribute&&"true"===b.target.getAttribute("data-independentscroll")||this.visitorIsScrolling.isSet()))if(u.checkCanScroll()){this.agentIsScrolling.set(U);var f={type:"elementscroll",path:GLANCE.Lib.toElem(b.target).getPath(),y:b.target.scrollTop,x:b.target.scrollLeft};this.sendRCEvent(f,b.target,!1)}else b.preventDefault()};p.prototype.requestDocShare=
function(b){b?(n.post("AgentMsg",{docshared:b}),n.fireEvent("docShared",{sharedBy:"agent",fileName:b.name})):n.post("AgentMsg",{docrequest:!0})};p.prototype.showConfirmation=function(b,f,g){b=document.getElementById(b);let l=document.getElementById("glance_agent_confirm_dialog");document.getElementById("glance_confirm_msg").innerText=b.innerText;p.prototype.onConfirm=f;b.removeClass("glance_hide");l.removeClass("glance_hide");l.hasClass("glance_ui")||l.addClass("glance_ui");c(g)};p.prototype.hideConfirmation=
function(){document.querySelectorAll(".agent_confirmation_message").forEach(b=>{b.hasClass("glance_hide")||b.addClass("glance_hide")});document.getElementById("glance_agent_confirm_dialog").addClass("glance_hide");p.prototype.onConfirm=void 0};p.prototype.onMouseDown=function(b){if(!b.rightClick)if(b.target.match(".glance_pausevideobutton")){var f=b.target.getAttribute("data-participantnum");this.showConfirmation("glance_confirm_pausevideo",function(){n.post("AgentMsg",{pauseparticipantvideo:{participantnum:f}})},
".glance_pausevideobutton")}else if(b.target.match(".glance_ejectguestbutton"))f=b.target.getAttribute("data-participantnum"),this.showConfirmation("glance_confirm_ejectuser",function(){n.post("AgentMsg",{ejectguest:{participantnum:f}})},".glance_ejectguestbutton");else if(b.target.getAttribute&&("remote"===b.target.getAttribute("data-agentinteractive")||b.target.matches("[data-agentinteractive=remote] *")))this.sendRCEvent({type:"mouse",etype:b.type,path:GLANCE.Lib.toElem(b.target).getPath()},b.target,
!1),b.target.tagName.match(/^select$/i)||b.target.tagName.match(/^input$/i)||b.stop();else{if("local"===b.target.getAttribute("data-agentinteractive")||b.target.matches("[data-agentinteractive=local] *")){if(b.target.match("#glance_stop_btn")){e().document.body.matches("[data-role=guest]")?this.showConfirmation("glance_confirm_viewerleave",()=>{k();n.fireEvent("guestleave")},"#glance_stop_btn"):(b=2<=n.agentState.agentlist.filter(g=>"agent"===g.role).length?"glance_confirm_viewerleave":"glance_confirm_endsession",
this.showConfirmation(b,()=>{k()},"#glance_stop_btn"));return}if(b.target.match("#glance_stop_video")){vidlog("Toggle agent/guest video");n.agent.toggleAgentVideo();return}if(b.target.match("#glance_blurbgd_video")){n.agent.toggleAgentVideoBackgroundFilter();b.target.setAttribute("aria-pressed","false"===b.target.getAttribute("aria-pressed"));return}if(b.target.matches("#scroll-controls button")){b=b.target.matches("#glance_scroll-right");b=CobrowseVideoUtils.scrollVideoStrip(b);n.setAgentState("agent-scrollstate-"+
z.num,b);return}if(b.target.match("#glance_confirm_btn")){u.onConfirm();u.hideConfirmation();return}if(b.target.match("#glance_deny_btn")){u.hideConfirmation();return}}this.pointInAnyScrollbar(b.client)?this.checkCanScroll():this.rcenabled||(b.stop(),n.disableScreenshareGestures||(this.mousedown=!0,this.gesturefade.cancel(),this.clientMouseDown=b.client,this.pageMouseDown=b.page))}};p.prototype.onKeyDown=function(b){if(e().document.body.matches("[data-role=guest]"))return!1;"enter"===b.key&&"remote"===
b.target.getAttribute("data-agentinteractive")&&b.target.click();"esc"===b.key&&b.target.hasClass("glance_tooltip")&&(b.target.hasAttribute("data-accessibility-hidden")?b.target.removeAttribute("data-accessibility-hidden"):b.target.setAttribute("data-accessibility-hidden",""));b.target.matches('[data-videosize="large"] .firstcontrol')&&"tab"===b.key&&b.shift&&b.preventDefault();b.target.matches('[data-videosize="large"] .lastcontrol')&&("tab"!==b.key||b.shift||b.preventDefault())};p.prototype.sendAgentMousepos=
function(){if(!e().document.body.matches("[data-role=guest]")){var b=this;0!==this.mouseleft?this.mouseleft--:void 0===this.sendmousemovetimer&&(this.sendmousemovetimer=window.setTimeout(function(){var f=b.getElemRelativeCoords(b.mouseclientpos,b.mousepagepos);f.type="mousemove";b.sendRCEvent(f,void 0,!1);delete b.sendmousemovetimer},200))}};p.prototype.onMouseLeave=function(b){b.page=this.mousepagepos;b.client=this.mouseclientpos;this.onMouseUp(b);window.clearTimeout(this.sendmousemovetimer);delete this.sendmousemovetimer;
this.mouseleft=3;this.sendRCEvent({type:"mouseleave"},void 0,!1)};p.prototype.processElementAtPoint=function(b,f){var g=this.getElemAt(b);if("IFRAME"===g.tagName){GLANCE.Lib.Browser.ie11&&this.hide(!0);try{var l=g.getBoundingClientRect(),v=g.contentWindow.GLANCE.Cobrowse.Viewer.processElementAtPoint({x:b.x-l.left,y:b.y-l.top},f);GLANCE.Lib.Browser.ie11&&this.hide(!1);if(v)return v}catch(B){}GLANCE.Lib.Browser.ie11&&this.hide(!1)}return f(g,b)};p.prototype.pointInAnyScrollbar=function(b){return GLANCE.Lib.Browser.ie11?
!1:this.processElementAtPoint(b,function(f,g){if(GLANCE.Lib.toElem(f).pointInScrollbar(g)||"HTML"===f.tagName&&(g.x>f.ownerDocument.documentElement.clientWidth||g.y>f.ownerDocument.documentElement.clientHeight)||"BODY"===f.tagName&&(f.ownerDocument!==document||n.ipage)&&(g.x>f.ownerDocument.documentElement.clientWidth||g.y>f.ownerDocument.documentElement.clientHeight))return!0})};p.prototype.onMouseMove=function(b){this.mouseclientpos=b.client;this.mousepagepos=b.page;var f=this;window.clearTimeout(this.clearagentmousetimer);
!this.mousedown&&5>=b.client.x&&(this.clearagentmousetimer=window.setTimeout(function(){f.onMouseLeave(b)},2E3));z.newssn.remotescroll&&!b.frameid&&this.sendAgentMousepos(b);this.mousedown&&4<GLANCE.Lib.pointDistance(b.client,this.clientMouseDown)?n.ipage||this.doWidgetDrag(b).then(g=>{g?this.hideGesture():this.doDragGesture(b,!1)}):(this.agentScrollingEnabled()&&this.handleMouseOverScrollbar(this.pointInAnyScrollbar(b.client)),this.processElementAtPoint(b.client,g=>{g.getAttribute("data-agentinteractive")||
g.matches("[data-agentinteractive] *")?(this.div.addClass("agentinteractive"),window.postMessage({interactiveOverlay:{interactive:!0}},window.location.origin)):(this.div.removeClass("agentinteractive"),["glance_pdfviewer","glance_xlsviewer"].includes(window.frameElement.id)&&window.parent.postMessage({interactiveOverlay:{interactive:!1}},window.location.origin))}))};p.prototype.doWidgetDrag=function(b){if(this.repositioning&&this.lastmovewidgetevt){let f=this.lastmovewidgetevt.client,g=b.client;n.post("AgentMsg",
{reposition:{left:g.x-f.x,bottom:f.y-g.y}});this.lastmovewidgetevt=b;return Promise.resolve(!0)}return new Promise((f,g)=>{this.processElementAtPoint(b.client,l=>{this.dragGesturing||e().document.body.matches("[data-role=guest]")||!l.matches("#glance_titlebar, #glance_titlebar *")?this.repositioning||f(!1):(this.repositioning=!0,this.lastmovewidgetevt=b,f(!0))})})};p.prototype.onMouseUp=function(b){if(b.rightClick)return!0;if(this.mousedown){this.mousedown=!1;if(this.sessionPaused)return!0;var f;
if((null==b?0:null==(f=b.target)?0:f.getAttribute)&&("remote"===b.target.getAttribute("data-agentinteractive")||b.target.matches("[data-agentinteractive=remote] *")))this.sendRCEvent({type:"mouse",etype:b.type,path:GLANCE.Lib.toElem(b.target).getPath()},b.target,!1),b.stop();else{if(this.repositioning)this.lastmovewidgetevt=this.repositioning=!1,n.post("AgentMsg",{repositiondone:!0});else if(4<GLANCE.Lib.pointDistance(b.page,this.pageMouseDown)){if(n.ipage){gestlog("No drag gesture in iframe");delete this.pageMouseDown;
delete this.clientMouseDown;return}this.doDragGesture(b,!0);this.dragGesturing=!1}else b.frameid||this.doGestureAt(b.client);delete this.pageMouseDown;delete this.clientMouseDown}}};p.prototype.hideGesture=function(){gestlog("Overlay.hideGesture");this.gesturefade.cancel();this.gesture.setStyle("opacity",0)};p.prototype.handleIframeClick=function(b,f){var g={};if("iframe"===b.get("tag").toLowerCase()){var l=GLANCE.Lib.hostFromUrl(b.src);if(null!==l&&GLANCE.Lib.getDomain(l)!==E.getDomain())return!1;
this.hideGesture();l=b.getBoundingClientRect();g.x=f.x-l.left;g.y=f.y-l.top;try{let v;null==(v=b.contentWindow.GLANCE)||v.Cobrowse.Viewer.clickOverlay({client:g})}catch(v){return!1}return!0}return!1};p.prototype.onVisitorElemScroll=function(b){this.visitorIsScrolling.set(T);if(this.gesturedElement&&b.contains(this.gesturedElement)){b=new GLANCE.Lib.GElement(b);var f=new GLANCE.Lib.GElement(this.gesturedElement);b.containsElemCoords(f)?(b=f.getCoords(),this.gesture.setPosition({x:b.x-6,y:b.y-6})):
(this.gesturefade.cancel(),this.gesture.setStyle("opacity",0),delete this.gesturedElement)}};p.prototype.doDragGesture=function(b,f){assert(!n.info.frameid);b=this.getMouseDragCoords(b);b.gesttype="rect";this.dragGesturing=!0;this.doGesture(b,f)};p.prototype.doGestureAt=function(b,f){this.hideGesture();var g={};f=f||this.getElemAt(b);f.tagName.match(/^(html|body)$/i)||!f.getBoundingClientRect().height||this.msgbox.contains(f)||f.matches("#glance_session_widget *")||b&&this.handleIframeClick(f,b)||
(/tspan/.test(f.tagName)?(g.gesttype="attr",g.attr="fill",g.attrval="#F96900"):(g.gesttype="rect",this.setElemCoords(g,f)),g.element=GLANCE.Lib.toElem(f).getPath(),this.gesturedElement=f,this.doGesture(g,!0))};p.prototype.setElemCoords=function(b,f){var g=new GLANCE.Lib.GElement(f);f=g.getDimensions();g=g.getCoords(!0);b.left=g.x-6;b.top=g.y-6;b.width=f.width;b.height=f.height};p.prototype.drawRemoteGesture=function(b){if(b.element){let f=document.querySelector(b.element);f&&this.setElemCoords(b,
f)}this.drawLocalGesture(b);this.fadeGesture()};p.prototype.doGesture=function(b,f){this.sessionPaused||(b.gesturedone=f,b.url=n.info.page.pageurl,this.postDrawGesture(b),this.drawLocalGesture(b),"rect"===b.gesttype&&b.gesturedone&&this.fadeGesture(),b.gesturedone&&void 0!==this.ongesturedone&&(this.ongesturedone(),delete this.ongesturedone))};p.prototype.drawLocalGesture=function(b){gestlog("drawLocalGesture");this.gesture.setAttribute("data-agentnum",b.agentnum);this.gesture.setAttribute("data-role",
b.role);this.gesture.setAttribute("data-localgesture",!0);switch(b.gesttype){case "rect":this.gesture.setStyles(b);this.gesture.setStyle("opacity",100);this.gesture.setStyle("padding",void 0!==b.element?"3px":"0px");break;case "attr":document.querySelector(b.element).setAttribute(b.attr,b.attrval)}let f=this.gesture.getElementById("glance_gesture_label");b.gesturedone&&b.agentname?(f.innerText=b.agentname,f.style.visibility="visible"):f.style.visibility="hidden"};p.prototype.postDrawGesture=function(b){let f,
g;b.agentname=((null==(f=L.GLANCE_SESSIONINFO.agentinfo)?void 0:f.name)||(null==(g=z.agentinfo)?void 0:g.name)||"").split(" ")[0];b.agentnum=n.info.num;b.role=L.GLANCE_SESSIONINFO.role;b={ol_c:GLANCE.Lib.compressObj(b)};n.post("AgentMsg",b)};p.prototype.fadeGesture=function(){this.gesturefade.cancel();this.gesturefade.start(1,0)};p.prototype.enableAgentAccessibility=function(b){(this.agentaccessibility=b)?document.body.classList.add("agent-accessibility"):document.body.classList.remove("agent-accessibility")};
p.prototype.agentAccessibilityEnabled=function(){return this.agentaccessibility||n.ipage&&e().GLANCE.Cobrowse.Viewer.agentAccessibilityEnabled()};p.prototype.requestRC=function(b){n.post("AgentMsg",{rcrequest:b,priv:"CBGUESTRC"})};p.prototype.requestCE=function(b){n.post("AgentMsg",{cerequest:b,priv:"CBGUESTSE"})};p.prototype.rcRequestState=function(b){n.fireEvent("rcrequest",{response:b})};p.onIframeScroll=function(b){u.visitorIsScrolling.isSet()||(u.checkCanScroll()?e().document.body.matches("[data-role=guest]")||
(b=window.getScroll(),u.scrollers.x.scrollTo(b.x),u.scrollers.y.scrollTo(b.y),scrolllog("onIframeScroll pageScroll:"+JSON.stringify(n.pageScroll))):b.preventDefault())};p.prototype.enableRC=function(b,f){!b||z.privs&&"on"===z.privs.CBGUESTRC?(b!==this.rcenabled&&(this.rcenabled=b,this.enableEvents(this.rcEvents,this.rcHandlers,b),this.enableGestures(!this.rcenabled),this.enableFocusDetect(b),this.disableMaskedFields(),this.div.toggleClass("rcenabled",b),n.fireEvent("rc",{enabled:b,suspended:!1})),
this.suspendRemoteScroll(f),b&&this.suspendRC(f)):rclog("Attempt to enable R/C, not allowed for this agent")};p.prototype.enableSEOverlay=function(b){this.rcenabled=this.editing=b;this.enableEvents(this.rcEvents,this.rcHandlers,b);this.enableGestures(!b);this.enableFocusDetect(b);this.disableMaskedFields();b?this.div.addClass("rcenabled"):this.div.removeClass("rcenabled")};p.prototype.enableSE=function(b,f){!b||z.privs&&"on"===z.privs.CBGUESTSE?(b!==this.seenabled&&(this.seenabled=b,this.enableEvents(this.seEvents,
this.seHandlers,b),n.fireEvent("rc",{enabled:b,suspended:!1,selectiveEditingMode:!0}),document.body.setAttribute("data-editing",b)),this.enableSEOverlay(!1)):rclog("Attempt to enable R/C, not allowed for this agent")};p.prototype.disableMaskedFields=function(){for(var b=document.querySelectorAll(".glance_masked, .glance_masked input, .glance_masked select, .glance_masked textarea"),f=0;f<b.length;f++)b[f].disabled=this.rcenabled};p.prototype.suspendRemoteScroll=function(b){rclog("suspendRC:",b);(this.rcsuspended=
b)&&this.agentIsScrolling.clear();b||(rclog("clear visitor working"),n.fireEvent("visitorworking",{working:!1}))};p.prototype.suspendRC=function(b){rclog("suspendRC:",b);this.rcsuspended=b;document.body.toggleClass("glance_agentcursor",this.agentHasControl());document.html.toggleClass("glance_agentcursor",this.agentHasControl());this.div.toggleClass("rcsuspended",b);n.visitorCursor.hide(this.agentHasControl());b&&delete this.agentControlledInput;n.hscrollBar&&n.vscrollBar&&(n.hscrollBar.ToggleRC(this.agentHasControl()),
n.vscrollBar.ToggleRC(this.agentHasControl()));n.ipage||n.fireEvent("rc",{enabled:this.rcenabled,suspended:this.rcsuspended})};p.prototype.onMouseEventRC=function(b){if(b.target.hasClass("glance_norc")||b.target.matches(".glance_norc *")){if("mousedown"===b.type)this.onMouseDown(b);return!0}if(this.rcsuspended)return b.stop(),!1;b.target.tagName.match(/select/i)||(!b.target.tagName.match(/input/i)||GLANCE.Lib.toElem(b.target).isTextInput()||GLANCE.Lib.toElem(b.target).isButtonInput())&&this.sendRCEvent({type:"mouse",
etype:b.type,path:GLANCE.Lib.toElem(b.target).getPath()},b.target,!0)};p.prototype.onClickNoRC=function(b){b.stop();("remote"===b.target.getAttribute("data-agentinteractive")||b.target.matches("[data-agentinteractive=remote] *"))&&this.sendRCMouseClick(b.target)};p.prototype.onClickRC=function(b){if(!b.target)return!1;let f=b.target;f.shadowRoot&&(f=this.getElemInShadowRoot(f.shadowRoot,b.client));if(this.rcsuspended||this.sessionPaused)return b.stop(),!1;if(f.tagName.match(/^select$/i)||f.tagName.match(/^input$/i)&&
f.type.match(/^(color|date|datetime|datetime-local|number|month|week|time)$/i))return!0;if(f.hasClass("glance_norc")||f.matches(".glance_norc *"))return this.onClickNoRC(b);if(GLANCE.Lib.toElem(f).pointInScrollbar(b.client))return!0;this.sendRCMouseClick(f);b.stop();return!1};p.prototype.enableFocusDetect=function(b){var f=this;void 0===this.onFocusChange&&(this.onFocusChange=function(g){if(g.target&&g.target!==Window&&g.target instanceof HTMLElement){var l=g.target;l.shadowRoot&&(l=g.path[0]);if(f.editing&&
!GLANCE.Lib.toElem(l).isSelectiveEditable())rclog("can't tab to that!",g.target.nodeName," data-gid: ",g.target.getAttribute("data-gid")),g.relatedTarget&&g.relatedTarget.focus();else return f.sendRCEvent({type:"focus",path:GLANCE.Lib.toElem(l).getPath()},l,!0),!0}});(b?document.body.addEventListener:document.body.removeEventListener).call(document.body,"focus",this.onFocusChange,!0);void 0===this.onBlur&&(this.onBlur=function(g){var l=g.target;l.shadowRoot&&(l=g.path[0]);delete f.agentControlledInput;
f.sendRCEvent({type:"blur",path:GLANCE.Lib.toElem(l).getPath()},l,!0);return!0});(b?document.body.addEventListener:document.body.removeEventListener).call(document.body,"blur",this.onBlur,!0)};p.prototype.onInputEvent=function(b){const f="remote"!==b.target.getAttribute("data-agentinteractive");if(!(f&&!this.agentHasControl()||b.target.hasClass("glance_norc")||b.target.matches(".glance_norc *"))){var g=b.target;g.shadowRoot&&(g=b.event.path[0]);b=GLANCE.Lib.toElem(g).getPath();g.tagName.match(/select/i)?
this.sendRCEvent({type:"selchange",path:b,selectedIndex:g.selectedIndex},g,f):null!==g.value&&(g.tagName.match(/^input$/i)&&!g.type.match(/^(radio|checkbox|button)$/i)||g.tagName.match(/^textarea$/i))&&(this.sendRCEvent({type:"input",path:b,value:g.value},g,f),this.agentControlledInput=b)}};p.prototype.onFocusIn=function(b){if(this.agentAccessibilityEnabled()&&(this.agentSettingFocus.set(100),this.pageIsScrolling.isSet()))this.onScroll()};p.prototype.onScroll=function(){this.pageIsScrolling.set(100);
if(this.agentAccessibilityEnabled()&&(scrolllog("onScroll visitorIsScrolling:",this.visitorIsScrolling.isSet(),"agenIsTabbing",this.agentSettingFocus.isSet()),this.agentScrollingEnabled()&&!this.visitorIsScrolling.isSet()&&this.agentSettingFocus.isSet())){var b=window.getScroll();scrolllog("Agent accessibility scrolling to ",b);this.scrollers.x.scrollTo(b.x);this.scrollers.y.scrollTo(b.y)}};p.prototype.onKeyEvent=function(b){var f=(b.target.tagName.match(/^input$/i)||b.target.tagName.match(/^select$/i))&&
"remote"===b.target.getAttribute("data-agentinteractive"),g=b.event.code.startsWith("Arrow"),l=b.event.code.startsWith("Page");if(g||l)if(b.event.shiftKey&&document.activeElement.matches("#glance_drag_handle")){b={};switch(event.key){case "ArrowLeft":b.left=!0;break;case "ArrowRight":b.left=!1;break;case "ArrowUp":b.bottom=!1;break;case "ArrowDown":b.bottom=!0}n.post("AgentMsg",{repositiondone:b})}else{if(b.event.altKey||window.parent.GLANCE_SESSIONINFO.scaledview)g=l?400:50,["ArrowLeft","ArrowUp",
"PageUp"].contains(b.event.code)&&(g=-g),g=(f=["ArrowLeft","ArrowRight"].contains(b.event.code))?window.getScroll().x+g:window.getScroll().y+g,f?this.scrollers.x.scrollTo(g):this.scrollers.y.scrollTo(g),b.stop()}else if(this.agentHasControl()||f)switch(b.code){case 13:f=b.target.tagName.match(/^input$/i)&&b.target.type.match(/button|submit/);g=b.target.tagName.match(/^a$/i);f||g?(this.sendRCMouseClick(b.target),b.stop()):b.target.tagName.match(/^select$/i)||b.stop();break;case 33:case 34:n.vscrollBar.scrollPage(33===
b.code?"up":"dn"),b.stop()}else if(!this.agentAccessibilityEnabled())b.stop();else if(b.control&&"v"===b.key.toLowerCase())(f=document.querySelector(".glance_focus"))&&f.focus({preventScroll:!0}),b.stop();else if(this.msgbox.contains(document.activeElement))9===b.code&&b.stop();else if(9!==b.code){if(13===b.code&&document.activeElement&&(this.doGestureAt(void 0,document.activeElement),"keydown"===b.type.toLowerCase()&&"button"===document.activeElement.tagName.toLowerCase()))this.onMouseDown(b);b.stop()}};
p.prototype.sendRCMouseClick=function(b){let f=GLANCE.Lib.toElem(b);this.seenabled&&!f.isSelectiveEditable()&&"remote"!==b.getAttribute("data-agentinteractive")?(rclog("Can't click this in SE mode",b.getAttribute("data-gid")),this.enableSEOverlay("false")):this.sendRCEvent({type:"mouse",etype:"click",path:f.getPath()},b,!0)};p.prototype.onMouseMoveSE=function(b){var f=this;this.processElementAtPoint(b.client,g=>{if(g!==f.elemUnderMouse&&!(g instanceof HTMLIFrameElement)){this.elemUnderMouse=g;let l=
GLANCE.Lib.toElem(g).isSelectiveEditable();f.seenabled&&(f.editing||!l||this.isgesturing()?!this.editing||l||GLANCE.Lib.toElem(document.activeElement).isSelectiveEditable()||(rclog("Selective-Editing mode off"),f.enableSEOverlay(!1)):(rclog("Selective-Editing mode on: ",g.nodeName," data-gid: ",g.getAttribute("data-gid")),f.enableSEOverlay(!0)))}});this.mouseclientpos=b.client;this.mousepagepos=b.page;this.sendAgentMousepos(b)};p.prototype.onMouseMoveRC=function(b){var f=this.getElemAt(b.client),
g;f&&this.elemUnderMouse!==f&&(this.elemUnderMouse&&(g=GLANCE.Lib.toElem(this.elemUnderMouse).getPath())&&this.sendRCEvent({type:"mouse",etype:"mouseout",path:g},this.elemUnderMouse,!0),this.sendRCEvent({type:"mouse",etype:"mouseover",path:GLANCE.Lib.toElem(f).getPath()},f,!0),this.elemUnderMouse=f);this.mouseclientpos=b.client;this.mousepagepos=b.page;this.sendAgentMousepos(b)};p.prototype.sendRCEvent=function(b,f,g){null!=f&&f.getAttribute&&"1"===f.getAttribute("glance_agent_only")||((null==f?0:
f.getAttribute)&&this.editing&&!GLANCE.Lib.toElem(f).isSelectiveEditable()?rclog("can't R/C that!",f.nodeName," data-gid: ",f.getAttribute("data-gid")):((null==f?0:f.getAttribute)&&("remote"===f.getAttribute("data-agentinteractive")||f.matches("[data-agentinteractive=remote] *"))&&(g=!1),f={rcevent:b,priv:g?"CBGUESTRC":void 0},["mousemove","mouseleave"].includes(b.type)||"agent"!==L.GLANCE_SESSIONINFO.role||(f.rcevent.agent={username:L.GLANCE_SESSIONINFO.agentinfo.username,puid:L.GLANCE_SESSIONINFO.agentinfo.partneruserid,
num:L.GLANCE_SESSIONINFO.num}),n.post("AgentMsg",f)))};D.prototype.init=function(b){this.click&&this.pointer||(this.click=document.id("glance_remoteclick"),this.pointer=document.id("glance_remotemouse"),GLANCE.Lib.moo.extendElement(this.click),this.hidden=!1,this.click&&this.pointer&&(this.click.setPosition({x:-999,y:-999}),this.effect=new Fx.Morph(this.pointer,{duration:"short",transition:Fx.Transitions.Sine.easeOut}),b&&this.showAt(b)))};D.prototype.restore=function(){this.click.inject(document.id("glance_overlay"));
this.pointer.inject(document.id("glance_overlay"))};D.prototype.clickAt=function(b){this.hidden||(this.init(),b&&!GLANCE.Lib.Page.coordsOutside(b)&&(b=E.relativeCoordsToPage(b.relative,E.clientToPageCoords(b.client)),this.click.playAnimation("remoteclick",1200),this.click.setPosition(b)))};D.prototype.showAt=function(b){this.init();this.movingTo=b;this.pointer.setPosition(b);this.show(!0)};D.prototype.show=function(b){this.pointer.style.display=b&&!this.hidden&&this.movingTo&&0<=this.movingTo.x?"block":
"none"};D.prototype.hide=function(b){this.hidden=b;this.show(!b)};D.prototype.moveTo=function(b){this.init();if(GLANCE.Lib.Page.coordsOutside(b))this.pointer.style.display="none";else if(b=E.relativeCoordsToPage(b.relative,E.clientToPageCoords(b.client)),"block"!==this.pointer.style.display)this.showAt(b);else if(this.movingTo.x!==b.x||this.movingTo.y!==b.y)this.movingTo=b,this.effect.cancel(),this.effect.start({left:b.x,top:b.y})};return{ready:function(){return n&&n.connected},addAgentVideo:function(b){vidlog("Viewer.addAgentVideo");
H.waitForSession("V",b.key,function(f,g){b.ssnParams=b.ssnParams||{};b.ssnParams.type="forward";b.ssnParams.video=2;H.inviteVisitor(f,g+"&scaling=clip",b.ssnParams,b.agentparams)})},addScreenshare:function(b){vidlog("Viewer.addScreenshare",b.screenshareView);var f=C(b.screenshareView);b.browserbased?(f.clear(),x(),n.disableScreenshareGestures=!1):b.key||b.sessionKey?f.waitForSession("G",b.key||b.sessionKey,function(g,l){f.inviteVisitor(g,null,b.ssnParams,b.agentparams)}):f.inviteVisitor(b.ssnid,null,
b.ssnParams,b.agentparams)},startScreenshare:function(b){vidlog("Viewer.startScreenshare",b.screenshareView);C(b.screenshareView).start(b.ssnParams,b.agentparams)},closeScreenshare:function(b){C(b.screenshareView).stop()},pauseScreenshare:function(b){vidlog("Viewer.pauseScreenshare",b.screenshareView);C(b.screenshareView).pause(!0)},resumeScreenshare:function(b){vidlog("Viewer.resumeScreenshare",b.screenshareView);C(b.screenshareView).pause(!1)},screenshareState:function(){return N.state},requestScreenshare:function(b){this.sendAgentMsg({requestvisitorscreenshare:1,
screensharesurfaces:b});n.visitorScreenshareStatus="pending"},startAgentScreenshare:function(){if("started"==n.visitorScreenshareStatus){let b=document.getElementById("glance_screenshare_viewer");document.getElementById("glance_screenshare_viewer").remove();let f=document.getElementById("glance_ssview");f.parentNode.insertBefore(b,f)}},stopVisitorsScreenshare:function(){this.sendAgentMsg({stopvisitorscreenshare:1})},visitorVideoState:function(){return n.info.state.visitorvideo},setVideoPreviewElement:function(){if(n&&
n.agentVideoPreview)return n.agentVideoPreview.checkPreview(!0)},navigate:function(b){var f=b.url;switch(f){case "back":case "forward":case "refresh":f.charAt(0)}n.post("AgentMsg",{nav:b})},requestRemoteControl:function(b){u.requestRC(b)},requestRC:function(b){u.requestRC(b)},requestCE:function(b){u.requestCE(b)},requestDocShare:function(b){u.requestDocShare(b)},navigationAssist:function(b){n.post("AgentMsg",{navigationassist:b,priv:"NAVASSIST"})},agentDownloaded:function(b){n.post("AgentMsg",{downloaded:b});
n.fireEvent("docDownloaded",{sharedBy:"visitor",downloadedBy:"agent",name:b})},remoteControlEnabled:function(){return u.rcenabled},rcEnabled:function(){return u.rcenabled},enableAgentAccessibility:function(b){u.enableAgentAccessibility(b)},agentAccessibilityEnabled:function(){return u.agentaccessibility},enableAccessibility:function(b){n.post("AgentMsg",{accessibility:b,priv:"ACCESSIBILITY"})},accessibilityEnabled:function(){return n.accessibilityEnabled},sendAgentMsg:function(b){n?n.post("AgentMsg",
b):console.error("ERR_SENDAGENTMSG "+JSON.stringify(b))},leaveSession:function(b){O=!0;b&&b.url&&(z.agentlefturl=b.url);k()},setStateAttribute:function(b,f){document.body.setAttribute(b,f)},mouseLeave:function(b){n&&(b.page.x=b.client.x+n.pageScroll.x,b.page.y=b.client.y+n.pageScroll.y,u.onMouseLeave(b),n.hscrollBar.onMouseUp(b),n.vscrollBar.onMouseUp(b))},getWinDims:function(){return n?n.windims:void 0},getFrames:function(){return n.frames},processElementAtPoint:function(b,f){return n?u.processElementAtPoint(b,
f):void 0},clickOverlay:function(b){u.click(b)},notifyScaleFactor:function(b){R=b}}}();

/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function() {'use strict';var n=void 0,u=!0,aa=this;function ba(e,d){var c=e.split("."),f=aa;!(c[0]in f)&&f.execScript&&f.execScript("var "+c[0]);for(var a;c.length&&(a=c.shift());)!c.length&&d!==n?f[a]=d:f=f[a]?f[a]:f[a]={}};var C="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==typeof DataView;function K(e,d){this.index="number"===typeof d?d:0;this.d=0;this.buffer=e instanceof(C?Uint8Array:Array)?e:new (C?Uint8Array:Array)(32768);if(2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&ca(this)}function ca(e){var d=e.buffer,c,f=d.length,a=new (C?Uint8Array:Array)(f<<1);if(C)a.set(d);else for(c=0;c<f;++c)a[c]=d[c];return e.buffer=a}
K.prototype.a=function(e,d,c){var f=this.buffer,a=this.index,b=this.d,k=f[a],m;c&&1<d&&(e=8<d?(L[e&255]<<24|L[e>>>8&255]<<16|L[e>>>16&255]<<8|L[e>>>24&255])>>32-d:L[e]>>8-d);if(8>d+b)k=k<<d|e,b+=d;else for(m=0;m<d;++m)k=k<<1|e>>d-m-1&1,8===++b&&(b=0,f[a++]=L[k],k=0,a===f.length&&(f=ca(this)));f[a]=k;this.buffer=f;this.d=b;this.index=a};K.prototype.finish=function(){var e=this.buffer,d=this.index,c;0<this.d&&(e[d]<<=8-this.d,e[d]=L[e[d]],d++);C?c=e.subarray(0,d):(e.length=d,c=e);return c};
var ga=new (C?Uint8Array:Array)(256),M;for(M=0;256>M;++M){for(var R=M,S=R,ha=7,R=R>>>1;R;R>>>=1)S<<=1,S|=R&1,--ha;ga[M]=(S<<ha&255)>>>0}var L=ga;function ja(e){this.buffer=new (C?Uint16Array:Array)(2*e);this.length=0}ja.prototype.getParent=function(e){return 2*((e-2)/4|0)};ja.prototype.push=function(e,d){var c,f,a=this.buffer,b;c=this.length;a[this.length++]=d;for(a[this.length++]=e;0<c;)if(f=this.getParent(c),a[c]>a[f])b=a[c],a[c]=a[f],a[f]=b,b=a[c+1],a[c+1]=a[f+1],a[f+1]=b,c=f;else break;return this.length};
ja.prototype.pop=function(){var e,d,c=this.buffer,f,a,b;d=c[0];e=c[1];this.length-=2;c[0]=c[this.length];c[1]=c[this.length+1];for(b=0;;){a=2*b+2;if(a>=this.length)break;a+2<this.length&&c[a+2]>c[a]&&(a+=2);if(c[a]>c[b])f=c[b],c[b]=c[a],c[a]=f,f=c[b+1],c[b+1]=c[a+1],c[a+1]=f;else break;b=a}return{index:e,value:d,length:this.length}};function ka(e,d){this.e=ma;this.f=0;this.input=C&&e instanceof Array?new Uint8Array(e):e;this.c=0;d&&(d.lazy&&(this.f=d.lazy),"number"===typeof d.compressionType&&(this.e=d.compressionType),d.outputBuffer&&(this.b=C&&d.outputBuffer instanceof Array?new Uint8Array(d.outputBuffer):d.outputBuffer),"number"===typeof d.outputIndex&&(this.c=d.outputIndex));this.b||(this.b=new (C?Uint8Array:Array)(32768))}var ma=2,T=[],U;
for(U=0;288>U;U++)switch(u){case 143>=U:T.push([U+48,8]);break;case 255>=U:T.push([U-144+400,9]);break;case 279>=U:T.push([U-256+0,7]);break;case 287>=U:T.push([U-280+192,8]);break;default:throw"invalid literal: "+U;}
ka.prototype.h=function(){var e,d,c,f,a=this.input;switch(this.e){case 0:c=0;for(f=a.length;c<f;){d=C?a.subarray(c,c+65535):a.slice(c,c+65535);c+=d.length;var b=d,k=c===f,m=n,g=n,p=n,v=n,x=n,l=this.b,h=this.c;if(C){for(l=new Uint8Array(this.b.buffer);l.length<=h+b.length+5;)l=new Uint8Array(l.length<<1);l.set(this.b)}m=k?1:0;l[h++]=m|0;g=b.length;p=~g+65536&65535;l[h++]=g&255;l[h++]=g>>>8&255;l[h++]=p&255;l[h++]=p>>>8&255;if(C)l.set(b,h),h+=b.length,l=l.subarray(0,h);else{v=0;for(x=b.length;v<x;++v)l[h++]=
b[v];l.length=h}this.c=h;this.b=l}break;case 1:var q=new K(C?new Uint8Array(this.b.buffer):this.b,this.c);q.a(1,1,u);q.a(1,2,u);var t=na(this,a),w,da,z;w=0;for(da=t.length;w<da;w++)if(z=t[w],K.prototype.a.apply(q,T[z]),256<z)q.a(t[++w],t[++w],u),q.a(t[++w],5),q.a(t[++w],t[++w],u);else if(256===z)break;this.b=q.finish();this.c=this.b.length;break;case ma:var B=new K(C?new Uint8Array(this.b.buffer):this.b,this.c),ra,J,N,O,P,Ia=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W,sa,X,ta,ea,ia=Array(19),
ua,Q,fa,y,va;ra=ma;B.a(1,1,u);B.a(ra,2,u);J=na(this,a);W=oa(this.j,15);sa=pa(W);X=oa(this.i,7);ta=pa(X);for(N=286;257<N&&0===W[N-1];N--);for(O=30;1<O&&0===X[O-1];O--);var wa=N,xa=O,F=new (C?Uint32Array:Array)(wa+xa),r,G,s,Y,E=new (C?Uint32Array:Array)(316),D,A,H=new (C?Uint8Array:Array)(19);for(r=G=0;r<wa;r++)F[G++]=W[r];for(r=0;r<xa;r++)F[G++]=X[r];if(!C){r=0;for(Y=H.length;r<Y;++r)H[r]=0}r=D=0;for(Y=F.length;r<Y;r+=G){for(G=1;r+G<Y&&F[r+G]===F[r];++G);s=G;if(0===F[r])if(3>s)for(;0<s--;)E[D++]=0,
H[0]++;else for(;0<s;)A=138>s?s:138,A>s-3&&A<s&&(A=s-3),10>=A?(E[D++]=17,E[D++]=A-3,H[17]++):(E[D++]=18,E[D++]=A-11,H[18]++),s-=A;else if(E[D++]=F[r],H[F[r]]++,s--,3>s)for(;0<s--;)E[D++]=F[r],H[F[r]]++;else for(;0<s;)A=6>s?s:6,A>s-3&&A<s&&(A=s-3),E[D++]=16,E[D++]=A-3,H[16]++,s-=A}e=C?E.subarray(0,D):E.slice(0,D);ea=oa(H,7);for(y=0;19>y;y++)ia[y]=ea[Ia[y]];for(P=19;4<P&&0===ia[P-1];P--);ua=pa(ea);B.a(N-257,5,u);B.a(O-1,5,u);B.a(P-4,4,u);for(y=0;y<P;y++)B.a(ia[y],3,u);y=0;for(va=e.length;y<va;y++)if(Q=
e[y],B.a(ua[Q],ea[Q],u),16<=Q){y++;switch(Q){case 16:fa=2;break;case 17:fa=3;break;case 18:fa=7;break;default:throw"invalid code: "+Q;}B.a(e[y],fa,u)}var ya=[sa,W],za=[ta,X],I,Aa,Z,la,Ba,Ca,Da,Ea;Ba=ya[0];Ca=ya[1];Da=za[0];Ea=za[1];I=0;for(Aa=J.length;I<Aa;++I)if(Z=J[I],B.a(Ba[Z],Ca[Z],u),256<Z)B.a(J[++I],J[++I],u),la=J[++I],B.a(Da[la],Ea[la],u),B.a(J[++I],J[++I],u);else if(256===Z)break;this.b=B.finish();this.c=this.b.length;break;default:throw"invalid compression type";}return this.b};
function qa(e,d){this.length=e;this.g=d}
var Fa=function(){function e(a){switch(u){case 3===a:return[257,a-3,0];case 4===a:return[258,a-4,0];case 5===a:return[259,a-5,0];case 6===a:return[260,a-6,0];case 7===a:return[261,a-7,0];case 8===a:return[262,a-8,0];case 9===a:return[263,a-9,0];case 10===a:return[264,a-10,0];case 12>=a:return[265,a-11,1];case 14>=a:return[266,a-13,1];case 16>=a:return[267,a-15,1];case 18>=a:return[268,a-17,1];case 22>=a:return[269,a-19,2];case 26>=a:return[270,a-23,2];case 30>=a:return[271,a-27,2];case 34>=a:return[272,
a-31,2];case 42>=a:return[273,a-35,3];case 50>=a:return[274,a-43,3];case 58>=a:return[275,a-51,3];case 66>=a:return[276,a-59,3];case 82>=a:return[277,a-67,4];case 98>=a:return[278,a-83,4];case 114>=a:return[279,a-99,4];case 130>=a:return[280,a-115,4];case 162>=a:return[281,a-131,5];case 194>=a:return[282,a-163,5];case 226>=a:return[283,a-195,5];case 257>=a:return[284,a-227,5];case 258===a:return[285,a-258,0];default:throw"invalid length: "+a;}}var d=[],c,f;for(c=3;258>=c;c++)f=e(c),d[c]=f[2]<<24|
f[1]<<16|f[0];return d}(),Ga=C?new Uint32Array(Fa):Fa;
function na(e,d){function c(a,c){var b=a.g,d=[],f=0,e;e=Ga[a.length];d[f++]=e&65535;d[f++]=e>>16&255;d[f++]=e>>24;var g;switch(u){case 1===b:g=[0,b-1,0];break;case 2===b:g=[1,b-2,0];break;case 3===b:g=[2,b-3,0];break;case 4===b:g=[3,b-4,0];break;case 6>=b:g=[4,b-5,1];break;case 8>=b:g=[5,b-7,1];break;case 12>=b:g=[6,b-9,2];break;case 16>=b:g=[7,b-13,2];break;case 24>=b:g=[8,b-17,3];break;case 32>=b:g=[9,b-25,3];break;case 48>=b:g=[10,b-33,4];break;case 64>=b:g=[11,b-49,4];break;case 96>=b:g=[12,b-
65,5];break;case 128>=b:g=[13,b-97,5];break;case 192>=b:g=[14,b-129,6];break;case 256>=b:g=[15,b-193,6];break;case 384>=b:g=[16,b-257,7];break;case 512>=b:g=[17,b-385,7];break;case 768>=b:g=[18,b-513,8];break;case 1024>=b:g=[19,b-769,8];break;case 1536>=b:g=[20,b-1025,9];break;case 2048>=b:g=[21,b-1537,9];break;case 3072>=b:g=[22,b-2049,10];break;case 4096>=b:g=[23,b-3073,10];break;case 6144>=b:g=[24,b-4097,11];break;case 8192>=b:g=[25,b-6145,11];break;case 12288>=b:g=[26,b-8193,12];break;case 16384>=
b:g=[27,b-12289,12];break;case 24576>=b:g=[28,b-16385,13];break;case 32768>=b:g=[29,b-24577,13];break;default:throw"invalid distance";}e=g;d[f++]=e[0];d[f++]=e[1];d[f++]=e[2];var k,m;k=0;for(m=d.length;k<m;++k)l[h++]=d[k];t[d[0]]++;w[d[3]]++;q=a.length+c-1;x=null}var f,a,b,k,m,g={},p,v,x,l=C?new Uint16Array(2*d.length):[],h=0,q=0,t=new (C?Uint32Array:Array)(286),w=new (C?Uint32Array:Array)(30),da=e.f,z;if(!C){for(b=0;285>=b;)t[b++]=0;for(b=0;29>=b;)w[b++]=0}t[256]=1;f=0;for(a=d.length;f<a;++f){b=
m=0;for(k=3;b<k&&f+b!==a;++b)m=m<<8|d[f+b];g[m]===n&&(g[m]=[]);p=g[m];if(!(0<q--)){for(;0<p.length&&32768<f-p[0];)p.shift();if(f+3>=a){x&&c(x,-1);b=0;for(k=a-f;b<k;++b)z=d[f+b],l[h++]=z,++t[z];break}0<p.length?(v=Ha(d,f,p),x?x.length<v.length?(z=d[f-1],l[h++]=z,++t[z],c(v,0)):c(x,-1):v.length<da?x=v:c(v,0)):x?c(x,-1):(z=d[f],l[h++]=z,++t[z])}p.push(f)}l[h++]=256;t[256]++;e.j=t;e.i=w;return C?l.subarray(0,h):l}
function Ha(e,d,c){var f,a,b=0,k,m,g,p,v=e.length;m=0;p=c.length;a:for(;m<p;m++){f=c[p-m-1];k=3;if(3<b){for(g=b;3<g;g--)if(e[f+g-1]!==e[d+g-1])continue a;k=b}for(;258>k&&d+k<v&&e[f+k]===e[d+k];)++k;k>b&&(a=f,b=k);if(258===k)break}return new qa(b,d-a)}
function oa(e,d){var c=e.length,f=new ja(572),a=new (C?Uint8Array:Array)(c),b,k,m,g,p;if(!C)for(g=0;g<c;g++)a[g]=0;for(g=0;g<c;++g)0<e[g]&&f.push(g,e[g]);b=Array(f.length/2);k=new (C?Uint32Array:Array)(f.length/2);if(1===b.length)return a[f.pop().index]=1,a;g=0;for(p=f.length/2;g<p;++g)b[g]=f.pop(),k[g]=b[g].value;m=Ja(k,k.length,d);g=0;for(p=b.length;g<p;++g)a[b[g].index]=m[g];return a}
function Ja(e,d,c){function f(a){var b=g[a][p[a]];b===d?(f(a+1),f(a+1)):--k[b];++p[a]}var a=new (C?Uint16Array:Array)(c),b=new (C?Uint8Array:Array)(c),k=new (C?Uint8Array:Array)(d),m=Array(c),g=Array(c),p=Array(c),v=(1<<c)-d,x=1<<c-1,l,h,q,t,w;a[c-1]=d;for(h=0;h<c;++h)v<x?b[h]=0:(b[h]=1,v-=x),v<<=1,a[c-2-h]=(a[c-1-h]/2|0)+d;a[0]=b[0];m[0]=Array(a[0]);g[0]=Array(a[0]);for(h=1;h<c;++h)a[h]>2*a[h-1]+b[h]&&(a[h]=2*a[h-1]+b[h]),m[h]=Array(a[h]),g[h]=Array(a[h]);for(l=0;l<d;++l)k[l]=c;for(q=0;q<a[c-1];++q)m[c-
1][q]=e[q],g[c-1][q]=q;for(l=0;l<c;++l)p[l]=0;1===b[c-1]&&(--k[0],++p[c-1]);for(h=c-2;0<=h;--h){t=l=0;w=p[h+1];for(q=0;q<a[h];q++)t=m[h+1][w]+m[h+1][w+1],t>e[l]?(m[h][q]=t,g[h][q]=d,w+=2):(m[h][q]=e[l],g[h][q]=l,++l);p[h]=0;1===b[h]&&f(h)}return k}
function pa(e){var d=new (C?Uint16Array:Array)(e.length),c=[],f=[],a=0,b,k,m,g;b=0;for(k=e.length;b<k;b++)c[e[b]]=(c[e[b]]|0)+1;b=1;for(k=16;b<=k;b++)f[b]=a,a+=c[b]|0,a<<=1;b=0;for(k=e.length;b<k;b++){a=f[e[b]];f[e[b]]+=1;m=d[b]=0;for(g=e[b];m<g;m++)d[b]=d[b]<<1|a&1,a>>>=1}return d};ba("GLANCE.Lib.Zlib.RawDeflate",ka);ba("GLANCE.Lib.Zlib.RawDeflate.prototype.compress",ka.prototype.h);var Ka={NONE:0,FIXED:1,DYNAMIC:ma},V,La,$,Ma;if(Object.keys)V=Object.keys(Ka);else for(La in V=[],$=0,Ka)V[$++]=La;$=0;for(Ma=V.length;$<Ma;++$)La=V[$],ba("GLANCE.Lib.Zlib.RawDeflate.CompressionType."+La,Ka[La]);}).call(this);

/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function() {'use strict';var k=void 0,aa=this;function r(c,d){var a=c.split("."),b=aa;!(a[0]in b)&&b.execScript&&b.execScript("var "+a[0]);for(var e;a.length&&(e=a.shift());)!a.length&&d!==k?b[e]=d:b=b[e]?b[e]:b[e]={}};var t="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==typeof DataView;function u(c){var d=c.length,a=0,b=Number.POSITIVE_INFINITY,e,f,g,h,l,n,m,p,s,x;for(p=0;p<d;++p)c[p]>a&&(a=c[p]),c[p]<b&&(b=c[p]);e=1<<a;f=new (t?Uint32Array:Array)(e);g=1;h=0;for(l=2;g<=a;){for(p=0;p<d;++p)if(c[p]===g){n=0;m=h;for(s=0;s<g;++s)n=n<<1|m&1,m>>=1;x=g<<16|p;for(s=n;s<e;s+=l)f[s]=x;++h}++g;h<<=1;l<<=1}return[f,a,b]};function w(c,d){this.g=[];this.h=32768;this.c=this.f=this.d=this.k=0;this.input=t?new Uint8Array(c):c;this.l=!1;this.i=y;this.p=!1;if(d||!(d={}))d.index&&(this.d=d.index),d.bufferSize&&(this.h=d.bufferSize),d.bufferType&&(this.i=d.bufferType),d.resize&&(this.p=d.resize);switch(this.i){case A:this.a=32768;this.b=new (t?Uint8Array:Array)(32768+this.h+258);break;case y:this.a=0;this.b=new (t?Uint8Array:Array)(this.h);this.e=this.u;this.m=this.r;this.j=this.s;break;default:throw Error("invalid inflate mode");
}}var A=0,y=1;
w.prototype.t=function(){for(;!this.l;){var c=B(this,3);c&1&&(this.l=!0);c>>>=1;switch(c){case 0:var d=this.input,a=this.d,b=this.b,e=this.a,f=d.length,g=k,h=k,l=b.length,n=k;this.c=this.f=0;if(a+1>=f)throw Error("invalid uncompressed block header: LEN");g=d[a++]|d[a++]<<8;if(a+1>=f)throw Error("invalid uncompressed block header: NLEN");h=d[a++]|d[a++]<<8;if(g===~h)throw Error("invalid uncompressed block header: length verify");if(a+g>d.length)throw Error("input buffer is broken");switch(this.i){case A:for(;e+g>
b.length;){n=l-e;g-=n;if(t)b.set(d.subarray(a,a+n),e),e+=n,a+=n;else for(;n--;)b[e++]=d[a++];this.a=e;b=this.e();e=this.a}break;case y:for(;e+g>b.length;)b=this.e({o:2});break;default:throw Error("invalid inflate mode");}if(t)b.set(d.subarray(a,a+g),e),e+=g,a+=g;else for(;g--;)b[e++]=d[a++];this.d=a;this.a=e;this.b=b;break;case 1:this.j(ba,ca);break;case 2:for(var m=B(this,5)+257,p=B(this,5)+1,s=B(this,4)+4,x=new (t?Uint8Array:Array)(C.length),Q=k,R=k,S=k,v=k,M=k,F=k,z=k,q=k,T=k,q=0;q<s;++q)x[C[q]]=
B(this,3);if(!t){q=s;for(s=x.length;q<s;++q)x[C[q]]=0}Q=u(x);v=new (t?Uint8Array:Array)(m+p);q=0;for(T=m+p;q<T;)switch(M=D(this,Q),M){case 16:for(z=3+B(this,2);z--;)v[q++]=F;break;case 17:for(z=3+B(this,3);z--;)v[q++]=0;F=0;break;case 18:for(z=11+B(this,7);z--;)v[q++]=0;F=0;break;default:F=v[q++]=M}R=t?u(v.subarray(0,m)):u(v.slice(0,m));S=t?u(v.subarray(m)):u(v.slice(m));this.j(R,S);break;default:throw Error("unknown BTYPE: "+c);}}return this.m()};
var E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=t?new Uint16Array(E):E,G=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],H=t?new Uint16Array(G):G,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],J=t?new Uint8Array(I):I,K=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],L=t?new Uint16Array(K):K,N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,
13],O=t?new Uint8Array(N):N,P=new (t?Uint8Array:Array)(288),U,da;U=0;for(da=P.length;U<da;++U)P[U]=143>=U?8:255>=U?9:279>=U?7:8;var ba=u(P),V=new (t?Uint8Array:Array)(30),W,ea;W=0;for(ea=V.length;W<ea;++W)V[W]=5;var ca=u(V);function B(c,d){for(var a=c.f,b=c.c,e=c.input,f=c.d,g=e.length,h;b<d;){if(f>=g)throw Error("input buffer is broken");a|=e[f++]<<b;b+=8}h=a&(1<<d)-1;c.f=a>>>d;c.c=b-d;c.d=f;return h}
function D(c,d){for(var a=c.f,b=c.c,e=c.input,f=c.d,g=e.length,h=d[0],l=d[1],n,m;b<l&&!(f>=g);)a|=e[f++]<<b,b+=8;n=h[a&(1<<l)-1];m=n>>>16;if(m>b)throw Error("invalid code length: "+m);c.f=a>>m;c.c=b-m;c.d=f;return n&65535}
w.prototype.j=function(c,d){var a=this.b,b=this.a;this.n=c;for(var e=a.length-258,f,g,h,l;256!==(f=D(this,c));)if(256>f)b>=e&&(this.a=b,a=this.e(),b=this.a),a[b++]=f;else{g=f-257;l=H[g];0<J[g]&&(l+=B(this,J[g]));f=D(this,d);h=L[f];0<O[f]&&(h+=B(this,O[f]));b>=e&&(this.a=b,a=this.e(),b=this.a);for(;l--;)a[b]=a[b++-h]}for(;8<=this.c;)this.c-=8,this.d--;this.a=b};
w.prototype.s=function(c,d){var a=this.b,b=this.a;this.n=c;for(var e=a.length,f,g,h,l;256!==(f=D(this,c));)if(256>f)b>=e&&(a=this.e(),e=a.length),a[b++]=f;else{g=f-257;l=H[g];0<J[g]&&(l+=B(this,J[g]));f=D(this,d);h=L[f];0<O[f]&&(h+=B(this,O[f]));b+l>e&&(a=this.e(),e=a.length);for(;l--;)a[b]=a[b++-h]}for(;8<=this.c;)this.c-=8,this.d--;this.a=b};
w.prototype.e=function(){var c=new (t?Uint8Array:Array)(this.a-32768),d=this.a-32768,a,b,e=this.b;if(t)c.set(e.subarray(32768,c.length));else{a=0;for(b=c.length;a<b;++a)c[a]=e[a+32768]}this.g.push(c);this.k+=c.length;if(t)e.set(e.subarray(d,d+32768));else for(a=0;32768>a;++a)e[a]=e[d+a];this.a=32768;return e};
w.prototype.u=function(c){var d,a=this.input.length/this.d+1|0,b,e,f,g=this.input,h=this.b;c&&("number"===typeof c.o&&(a=c.o),"number"===typeof c.q&&(a+=c.q));2>a?(b=(g.length-this.d)/this.n[2],f=258*(b/2)|0,e=f<h.length?h.length+f:h.length<<1):e=h.length*a;t?(d=new Uint8Array(e),d.set(h)):d=h;return this.b=d};
w.prototype.m=function(){var c=0,d=this.b,a=this.g,b,e=new (t?Uint8Array:Array)(this.k+(this.a-32768)),f,g,h,l;if(0===a.length)return t?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);f=0;for(g=a.length;f<g;++f){b=a[f];h=0;for(l=b.length;h<l;++h)e[c++]=b[h]}f=32768;for(g=this.a;f<g;++f)e[c++]=d[f];this.g=[];return this.buffer=e};
w.prototype.r=function(){var c,d=this.a;t?this.p?(c=new Uint8Array(d),c.set(this.b.subarray(0,d))):c=this.b.subarray(0,d):(this.b.length>d&&(this.b.length=d),c=this.b);return this.buffer=c};r("GLANCE.Lib.Zlib.RawInflate",w);r("GLANCE.Lib.Zlib.RawInflate.prototype.decompress",w.prototype.t);var X={ADAPTIVE:y,BLOCK:A},Y,Z,$,fa;if(Object.keys)Y=Object.keys(X);else for(Z in Y=[],$=0,X)Y[$++]=Z;$=0;for(fa=Y.length;$<fa;++$)Z=Y[$],r("GLANCE.Lib.Zlib.RawInflate.BufferType."+Z,X[Z]);}).call(this);
